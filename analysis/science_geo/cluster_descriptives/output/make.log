--------------------------------------------------------------------------------
Makelog started: 2024-01-05 12:30:30
Working directory: /export/home/dor/cxu/innovation_projs/analysis/science_geo/cluster_descriptives/code
--------------------------------------------------------------------------------
External links successfully created!

  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      17.0
___/   /   /___/   /   /___/       MP—Parallel Edition

 Statistics and Data Science       Copyright 1985-2021 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-STATA-PC        https://www.stata.com
                                   979-696-4600        stata@stata.com

Stata license: Unlimited-user 4-core network, expiring 17 Nov 2024
Serial number: 501809301897
  Licensed to: Harvard Business School
               Research Computing

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. More than 2 billion observations are allowed; see help obs_advice.
      4. Maximum number of variables is set to 120,000; see help set_maxvar.

. do "/export/home/dor/cxu/innovation_projs/analysis/science_geo/cluster_descri
> ptives/code/analysis.do" 

. set more off 

. clear all

. capture log close

. program drop _all

. set scheme modern

. graph set window fontface "Arial Narrow"
not available in non-GUI version

. pause on

. set seed 8975

. global cite_affl_wt_name "Productivity"

. global impact_cite_affl_wt_name "Productivity"

. global body_adj_wt_name "Paper-to-Patent Citations"

. global ln_y_name "Log Productivity"

. global ln_pat_name "Log Paper-to-Patent Citations"

. global msa_size_name "Cluster Size"

. global ln_x_name "Log Cluster Size"

. global time year

. 
. program main
  1.     foreach s in year_firstlast {
  2.         sample_desc, samp(`s')
  3.         maps, samp(`s')
  4.         raw_bs, samp(`s')
  5.         regression, samp(`s')
  6.         output_tables, samp(`s')
  7.     }
  8. end

. 
. program sample_desc
  1.     syntax, samp(str) 
  2.     use if !mi(msa_comb) & inrange(year, 1945,2022) using ../external/samp
> /athr_panel_full_comb_`samp', clear 
  3.     count
  4.     gunique athr_id
  5.     gen ln_y = ln(impact_cite_affl_wt)
  6.     gen ln_x = ln(msa_size)
  7.     gen ln_pat = ln(body_adj_wt)
  8.     foreach var in impact_cite_affl_wt msa_size ln_y ln_x body_adj_wt ln_p
> at {
  9.         qui sum `var', d
 10.         local N = r(N)
 11.         local mean : dis %3.2f r(mean)
 12.         local sd : dis %3.2f r(sd)
 13.         local p5 :  dis %3.2f r(p5)
 14.         local p25 :  dis %3.2f r(p25)
 15.         local p50 :  dis %3.2f r(p50)
 16.         local p75 :  dis %3.2f r(p75)
 17.         local p95 :  dis %3.2f r(p95)
 18.         tw hist `var', frac ytitle("Share of author-years", size(vsmall)) 
> xtitle("${`var'_name}", size(vsmall)) color(edkblue) xlab(, labsize(vsmall)) 
> ylab(, labsize(vsmall)) legend(on order(- "N = `N'" ///
>                                                                 "Mean = `mean
> '" ///
>                                                                 "            
> (`sd')" ///
>                                                                 "p5 = `p5'" /
> //
>                                                                 "p25 = `p25'"
>  ///
>                                                                 "p50 = `p50'"
>  ///
>                                                                 "p75 = `p75'"
>  ///
>                                                                 "p95 = `p95'"
> ) pos(1) ring(0) size(vsmall) region(fcolor(none)))
 19.         *graph export ../output/figures/`var'_dist`samp'.pdf, replace
.     }
 20.     preserve
 21.     keep if inrange(year, 2015,2022)
 22.     gcollapse (mean) msa_size cluster_shr, by(msa_comb)
 23.     gsort -msa_size
 24.     mkmat msa_size in 1/30, mat(top_30clus_`samp')
 25.     li in 1/30
 26.     mkmat msa_size in 1/10, mat(top_10clus_`samp')
 27.     restore
 28.     preserve
 29.     gen has_patent_cite = pat_wt > 0
 30.     bys athr_id msa_comb: gen athr_cnt = _n == 1
 31.     gcollapse  (sum) athr_cnt body_adj_wt cite_affl_wt pat_wt affl_wt impa
> ct_cite_affl_wt impact_affl_wt (mean) msa_size has_patent_cite, by(msa_comb)
 32. 
.     qui reg body_adj_wt impact_cite_affl_wt 
 33.     local coef : dis %3.2f _b[impact_cite_affl_wt]
 34.     local N = e(N)
 35.     binscatter2 body_adj_wt impact_cite_affl_wt , xtitle("Productivity", s
> ize(vsmall)) ytitle("Paper-to-Patent Citations", size(vsmall)) lcolor(ebblue)
>  mcolor(gs3) xlab(, labsize(vsmall)) ylab(, labsize(vsmall)) legend(on order(
> - "N (MSAs) = `N'" ///
>                                                                              
>                                          "Slope = `coef'") pos(5) ring(0) reg
> ion(fcolor(none)) size(vsmall))
 36.     *graph export ../output/figures/msa_pat_prod_`samp'.pdf, replace
.     gen ln_pat = ln(body_adj_wt)
 37.     gen ln_y = ln(impact_cite_affl_wt)
 38.     qui reg ln_pat ln_y 
 39.     local coef : dis %3.2f _b[ln_y]
 40.     local N = e(N)
 41.     binscatter2 ln_pat ln_y , xtitle("Log Productivity", size(vsmall)) yti
> tle("Log Paper-to-Patent Citations", size(vsmall)) lcolor(ebblue) mcolor(gs3)
>   xlab(, labsize(vsmall)) ylab(, labsize(vsmall)) legend(on order(- "N (MSAs)
>  = `N'" ///
>                                                                              
>                                          "Slope = `coef'") pos(5) ring(0) reg
> ion(fcolor(none)) size(vsmall))
 42.     *graph export ../output/figures/msa_log_pat_prod_`samp'.pdf, replace
.     
.     xtile p  = msa_size, nq(20)
 43.     gen msa_lab = "" 
 44.     replace msa_lab =  msa_comb  if msa_comb == "Great Falls, MT" 
 45.     replace msa_lab =  msa_comb  if msa_comb == "San Diego-Carlsbad, CA" 
 46.     replace msa_lab =  msa_comb  if msa_comb == "Trenton, NJ" 
 47.     replace msa_lab =  msa_comb  if msa_comb == "New Haven-Milford , CT" 
 48.     replace msa_lab =  msa_comb  if msa_comb == "New York-Newark-Jersey Ci
> ty, NY-NJ-PA" 
 49.     replace msa_lab =  msa_comb  if msa_comb == "Bay Area, CA" 
 50.     replace msa_lab =  msa_comb  if msa_comb == "Boston-Cambridge-Newton, 
> MA-NH" 
 51. 
. /*    replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "G
> reat Falls, MT" & year == 2015
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "San
>  Diego-Carlsbad, CA" & year == 1973
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "San
>  Diego-Carlsbad, CA" & year == 19
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Tre
> nton, NJ" & year == 2019
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "New
>  Haven-Milford , CT" & year == 2012
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "New
>  York-Newark-Jersey City, NY-NJ-PA" & year == 1996
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bay
>  Area, CA" & year == 1997 
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bay
>  Area, CA" & year == 2015 
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bos
> ton-Cambridge-Newton, MA-NH" & year == 1997 
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bos
> ton-Cambridge-Newton, MA-NH" & year == 2012 */
.     tw scatter impact_cite_affl_wt msa_size , mcolor(gs7%50) msize(vsmall) xl
> abel(#10, labsize(vsmall)) ylab(#10, labsize(vsmall)) || scatter impact_cite_
> affl_wt msa_size if !mi(msa_lab) , mcolor(ebblue) msize(vsmall)  mlabel(msa_l
> ab) mlabcolor(black) mlabsize(tiny) xtitle("MSA Cluster Size", size(vsmall)) 
> ytitle("MSA Productivity", size(vsmall))  jitter(5) legend(off)
 52.    *graph export ../output/figures/cluster_prod_scatter_`samp'.pdf, replac
> e
.    
.    xtile p_prod = impact_cite_affl_wt, nq(20)
 53.    replace msa_lab = ""
 54.    replace msa_lab =  msa_comb if msa_comb == "San Diego-Carlsbad, CA" 
 55.    replace msa_lab =  msa_comb if msa_comb == "Bay Area, CA" 
 56.    replace msa_lab =  msa_comb if msa_comb == "St. Louis, MO-IL" 
 57.    replace msa_lab =  msa_comb if msa_comb == "Minneapolis-St. Paul-Bloomi
> ngton, MN-WI" 
 58.    replace msa_lab =  msa_comb if msa_comb == "Washington-Arlington-Alexan
> dria, DC-VA-MD-WV" 
 59.    replace msa_lab =  msa_comb if msa_comb == "Los Angeles-Long Beach-Anah
> eim, CA" 
 60.    replace msa_lab =  msa_comb if msa_comb == "Boston-Cambridge-Newton, MA
> -NH" 
 61.    replace msa_lab =  msa_comb if msa_comb == "New York-Newark-Jersey City
> , NY-NJ-PA" 
 62.    egen clock = mlabvpos(impact_cite_affl_wt body_adj_wt)
 63.    replace clock = 9 if inlist(msa_lab , "New York-Newark-Jersey City, NY-
> NJ-PA","Boston-Cambridge-Newton, MA-NH")
 64.    replace clock = 3 if inlist(msa_lab , "Minneapolis-St. Paul-Bloomington
> , MN-WI", "Washington-Arlington-Alexandria, DC-VA-MD-WV", "San Diego-Carlsbad
> , CA", "St. Louis, MO-IL", "Bay Area, CA")
 65.    /*replace msa_lab =  msa_comb + " " + string(${time})  if msa_comb == "
> Flint, MI" & year == 2006
>    replace msa_lab =  msa_comb + " " + string(${time})  if msa_comb == "Linco
> ln, NE" & year == 2005 
>    replace msa_lab =  msa_comb + " " + string(${time})  if msa_comb == "Worce
> ster, MA-CT" & year == 2000
>    replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "San 
> Diego-Carlsbad, CA" & year == 1989 
>    replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bay 
> Area, CA" & year == 1997 
>    replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bay 
> Area, CA" & year == 2015 
>    replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bost
> on-Cambridge-Newton, MA-NH" & year == 2015 
>    replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bost
> on-Cambridge-Newton, MA-NH" & year == 2000 */
.    qui reg body_adj_wt impact_cite_affl_wt 
 66.    local coef : dis %3.2f _b[impact_cite_affl_wt]
 67.    local cons : dis %3.2f _b[_cons]
 68.    local N = e(N)
 69.    tw scatter body_adj_wt impact_cite_affl_wt , mcolor(gs13%50) msize(vsma
> ll) xlabel(0(5000)60000, labsize(vsmall)) ylab(0(5000)60000, labsize(vsmall))
>  || ///
>       scatter body_adj_wt impact_cite_affl_wt if !mi(msa_lab) , mlabvp(clock)
>  mcolor(ebblue) msize(vsmall)  mlabel(msa_lab) mlabcolor(black) mlabsize(tiny
> ) || ///
>       (function y=_b[impact_cite_affl_wt]*x+_b[_cons] , range(0 60000) lpatte
> rn(dash) lcolor(lavender)), xtitle("MSA Productivity", size(vsmall)) ytitle("
> MSA Paper-to-Patent Citations", size(vsmall)) legend(on order(- "N (MSAs) = `
> N'" ///
>                                                                              
>                                          "Slope = `coef'") pos(5) ring(0) reg
> ion(fcolor(none)) size(vsmall))
 70.    graph export ../output/figures/pat_prod_scatter_`samp'.pdf, replace
 71.    /*hashsort p -cite_affl_wt 
>    by p: egen mean_msa = mean(msa_size)
>    by p: egen mean_cite = mean(cite_affl_wt)
>    hashsort p -cite_affl_wt  
>    gduplicates drop p mean_msa mean_cite, force
>    drop msa_lab
>    gen msa_lab = msa_comb + " " + string(${time})  + "p"+string(p)
>    qui reg mean_cite mean_msa
>    local coef : dis %3.2f _b[mean_msa]
>    tw scatter mean_cite mean_msa, mcolor(ebblue) msize(vsmall) xlabel(#10, la
> bsize(vsmall)) ylab(#10, labsize(vsmall))  mlabel(msa_lab) mlabcolor(black) m
> labsize(tiny) xtitle("MSA Size in Year", size(vsmall)) ytitle("Average Effect
> ive Output", size(vsmall)) legend(on order(- "Slope = `coef'") pos(5) ring(0)
>  size(vsmall))
>    *graph export ../output/figures/binscatter_`samp'.pdf, replace
>    restore*/
.     
. /*    preserve
>     keep if inrange(year , 2015,2022)
>     gcollapse (mean) msa_size cluster_shr, by(msa_comb)
>     gsort - msa_size
>     mkmat msa_size in 1/30, mat(top_30clus_`samp')
>     li in 1/30
>     mkmat msa_size in 1/10, mat(top_10clus_`samp')
>     restore*/
. /*    gcollapse (mean) msa_size_field field_cluster_shr, by(msa_comb field)
>     forval i = 0/4 {
>         preserve
>         keep if field ==`i'
>         gsort -msa_size_field
>         li in 1/10
>         restore
>     }*/
. 
. end

. 
. program  maps
  1.     syntax, samp(str) 
  2.     spshape2dta ../external/geo/cb_2018_us_state_500k.shp, replace saving(
> usa_state)
  3.     use usa_state_shp, clear
  4.     merge m:1 _ID using usa_state
  5.     destring STATEFP, replace
  6.     drop if STATEFP > 56
  7.     // alaska
.     drop if _X > 0 & !mi(_X) & STATEFP == 2  
  8.     geo2xy _Y _X if STATEFP ==2, proj(mercator) replace
  9.     replace _Y = _Y / 5 +1200000 if STATEFP == 2 
 10.     replace _X = _X / 5 - 2000000  if STATEFP == 2 
 11.     drop if _X < -160 & !mi(_X) & _ID == 43  // small islands to the west
 12.     geo2xy _Y _X if _ID == 43, proj(mercator) replace
 13.     replace _Y = _Y  + 800000 if _ID == 43
 14.     replace _X = _X  - 1200000 if _ID == 43
 15.     geo2xy _Y _X if !inlist(_ID, 28,43), replace proj(mercator)
 16.     replace _X = _X + 53500 if !inlist(_ID, 28,43)
 17.     replace _Y = _Y - 3100 if !inlist(_ID, 28,43)
 18.     drop _CX- _merge
 19.     sort _ID shape_order
 20.     save usa_state_shp_clean.dta, replace
 21.     
.     spshape2dta ../external/geo/cb_2018_us_cbsa_500k.shp, replace saving(usa_
> msa)
 22.     use usa_msa_shp, clear
 23.     merge m:1 _ID using usa_msa, nogen
 24.     destring CBSAFP, replace
 25.     gen state = strtrim(substr(NAME, strpos(NAME, ",")+1, 3))
 26.     drop if inlist(state, "PR")
 27.     // alaska
.     drop if _X > 0 & !mi(_X) & state == "AK" 
 28.     geo2xy _Y _X if state == "AK" , proj(mercator) replace
 29.    replace _Y = _Y / 5 + 1200000 if state == "AK"
 30.     replace _X = _X / 5 - 1705000 if state == "AK" 
 31.     drop if _X < -160 & !mi(_X) & state == "HI"  // small islands to the w
> est
 32.     geo2xy _Y _X if state == "HI", proj(mercator) replace
 33.     replace _Y = _Y + 800000 if state == "HI" 
 34.     replace _X = _X  - 1200000 if state == "HI" 
 35.     geo2xy _Y _X if !inlist(state, "AK", "HI"), replace proj(mercator)
 36.     sort _ID shape_order
 37.     save usa_msa_shp_clean.dta, replace
 38. 
.     use if !mi(msa_comb) & inrange(year, 1945, 2022) using ../external/samp/a
> thr_panel_full_`samp', clear
 39. *    bys msa_comb: egen mode = mode(msacode)
. *    replace msacode = mode
.     merge m:1 msacode using ../external/geo/msas, assert(1 2 3) keep(1 3) nog
> en
 40.     replace msa_comb = msatitle if !mi(msatitle)
 41.     replace msa_comb = "San Francisco-Oakland-Hayward, CA" if msa_comb == 
> "San Francisco-Oakland-Haywerd, CA"
 42.     replace msa_comb = "Macon-Bibb County, GA" if msa_comb == "Macon, GA"
 43.     bys athr_id msa_comb ${time} : gen count = _n == 1
 44.     gcollapse (sum) affl_wt impact_cite_affl_wt body_adj_wt (mean) msa_siz
> e , by(msa_comb)
 45.     save ../temp/map_samp, replace
 46.     
.     use usa_msa, clear
 47.     rename NAME msa_comb
 48.     merge 1:m msa_comb using ../temp/map_samp, assert(1 2 3) keep(1 3) nog
> en
 49.     foreach var in impact_cite_affl_wt {
 50.         xtile `var'_5 = `var', nq(5)
 51.         qui sum `var' 
 52.         local min : dis %3.2f r(min)
 53.         local max : dis %3.2f r(max)
 54.         _pctile `var',percentiles(20 40 60 80)
 55.         local p20: dis %3.2f r(r1)
 56.         local p40: dis %3.2f r(r2)
 57.         local p60: dis %3.2f r(r3)
 58.         local p80: dis %3.2f r(r4)
 59.         colorpalette carto Teal, n(5) nograph 
 60.         spmap  `var'_5 using usa_msa_shp_clean,  id(_ID)  fcolor(`r(p)'%50
> ) clnumber(5) ///
>           ocolor(white ..) osize(0.15 ..) ndfcolor(gs13) ndocolor(white ..) n
> dsize(0.15 ..) ndlabel("No data") ///
>           polygon(data("usa_state_shp_clean") ocolor(gs2) osize(0.2) fcolor(e
> ggshell%20)) ///
>           legend(label(2 "Min-p20: `min'-`p20'") label(3 "p20-p40: `p20'-`p40
> '") label(4 "p40-p60: `p40'-`p60'") label(5 "p60-p80: `p60'-`p80'") label(6 "
> p80-Max: `p80'-`max'") pos(4) size(2)) legtitle("${`var'_name}")
 61.         graph export ../output/figures/`var'_map_`samp'.pdf, replace
 62.     }
 63. end

. 
. program raw_bs
  1.     syntax, samp(str) 
  2.     use if !mi(msa_comb) & inrange(year, 1945, 2022) using ../external/sam
> p/athr_panel_full_comb_`samp', clear
  3.     drop if mi(msa_comb) 
  4.     gegen msa = group(msa_comb)
  5.     gen ln_y = ln(impact_cite_affl_wt)
  6.     gen ln_x = ln(msa_size)
  7.     gen ln_pat = ln(body_adj_wt)
  8. 
.     // patented vs productivity
.     qui reg body_adj_wt impact_cite_affl_wt 
  9.     local coef : dis %3.2f _b[impact_cite_affl_wt]
 10.     local N = e(N)
 11.     binscatter2 body_adj_wt impact_cite_affl_wt, xtitle("Productivity", si
> ze(vsmall)) ytitle("Paper-to-Patent Citations", size(vsmall)) xlab(, labsize(
> vsmall)) ylab(, labsize(vsmall)) mcolor(gs5) lcolor(ebblue) legend(on order(-
>  "N (Author-years) = `N'" ///
>                                                                              
>                                          "Slope = `coef'") pos(5) ring(0) reg
> ion(fcolor(none)) size(vsmall))
 12.     *graph export ../output/figures/pat_prod_`samp'.pdf, replace
.     qui reg ln_pat ln_y 
 13.     local coef : dis %3.2f _b[ln_y]
 14.     local N = e(N)
 15.     binscatter2 ln_pat ln_y , xtitle("Log Productivity", size(vsmall)) yti
> tle("Log Paper-to-Patent Citations", size(vsmall)) xlab(, labsize(vsmall)) yl
> ab(, labsize(vsmall)) mcolor(gs5) lcolor(ebblue) legend(on order(- "N (Author
> -years) = `N'" ///
>                                                                              
>                                          "Slope = `coef'") pos(5) ring(0) reg
> ion(fcolor(none)) size(vsmall))
 16.     *graph export ../output/figures/log_pat_prod_`samp'.pdf, replace
. end

. 
. 
. program regression 
  1.     syntax, samp(str) 
  2.     use if !mi(msa_comb) & inrange(year, 1945, 2022) using ../external/sam
> p/athr_panel_full_comb_`samp', clear 
  3.     local reg_eq = cond("`samp'"=="year","ln_y ln_x avg_team_size","ln_y l
> n_x") 
  4.     local mat_est  = cond("`samp'"=="year","_b[ln_x] \ _se[ln_x] \ _b[avg_
> team_size] \ _se[ln_x]", "_b[ln_x] \ _se[ln_x]") 
  5.     bys athr_id msa_comb ${time} : gen count = _n == 1
  6.     replace msa_size = 0.0000000000001 if msa_size == 0
  7.     gegen msa = group(msa_comb)
  8.     rename inst inst_name
  9.     gegen inst = group(inst_id)
 10.     gegen msa_field = group(msa field)
 11.     gegen year_field = group(year field)
 12.     gen ln_y = ln(impact_cite_affl_wt)
 13.     gen ln_x = ln(msa_size)
 14.     gen ln_x_cluster = ln(cluster_shr)
 15.     preserve
 16.     keep if inrange(year, 2015, 2022)
 17.     keep if inlist(msa_comb, "Ann Arbor, MI", "San Diego-Carlsbad, CA", "B
> oston-Cambridge-Newton, MA-NH", "Bay Area, CA", "Gainesville, FL")
 18.     foreach m in "Gainesville, FL" "Ann Arbor, MI" "San Diego-Carlsbad, CA
> " "Bay Area, CA" "Boston-Cambridge-Newton, MA-NH" {
 19.         sum impact_cite_affl_wt if msa_comb == "`m'", d
 20.         mat row = (r(min) , r(p5) , r(p10), r(p25), r(p50) , r(p75), r(p90
> ) , r(p95), r(max), r(mean) , r(sd))
 21.         sum msa_size if msa_comb == "`m'" 
 22.         mat row = row , r(mean)
 23.         mat city_stats_`samp' = nullmat(city_stats_`samp') \ (row)
 24.     }
 25.     restore
 26.     reghdfe `reg_eq', noabsorb
 27.     local slope = _b[ln_x]
 28.     if "`samp'" == "year" {
 29.         binscatter2  ln_y ln_x ,controls(avg_team_size) ytitle("Log Output
> ") xtitle("Log Cluster Size") legend(on order(- "Slope = `slope'") pos(5) rin
> g(0) lwidth(none))
 30.         *graph export ../output/figures/bs_`samp'.pdf, replace
.     }
 31.     if "`samp'" == "year_firstlast" {
 32.         binscatter2  ln_y ln_x , ytitle("Log Output") xtitle("Log Cluster 
> Size") legend(on order(- "Slope = `slope'") pos(5) ring(0) lwidth(none))
 33.         *graph export ../output/figures/bs_`samp'.pdf, replace
.     }
 34.     foreach fe in "${time} msa field" "${time} msa field field#${time}" "$
> {time} msa field field#${time} msa#field" "${time} msa field field#${time} ms
> a#field inst" "${time} msa field field#${time} msa#field inst athr_id" {
 35.         reghdfe `reg_eq', absorb(`fe') vce(cluster msa)
 36.         mat coef_`samp' = nullmat(coef_`samp'), (`mat_est' \ e(N))
 37.         local slope : dis %3.2f _b[ln_x]
 38.         if "`samp'" == "year" {
 39.             binscatter2  ln_y ln_x ,controls(avg_team_size) absorb(year ms
> a field year_field msa_field athr_id) ytitle("Log Output") xtitle("Log Cluste
> r Size") legend(on order(- "Slope = `slope'") pos(5) ring(0) lwidth(none))
 40.             *graph export ../output/figures/final_bs_`samp'.pdf, replace
.         }
 41.         if "`samp'" == "year_firstlast" {
 42.             binscatter2  ln_y ln_x , absorb(year msa field year_field msa_
> field athr_id) ytitle("Log Output") xtitle("Log Cluster Size") legend(on orde
> r(- "Slope = `slope'") pos(5) ring(0) lwidth(none))
 43.             *graph export ../output/figures/final_bs_`samp'.pdf, replace
.         }
 44.     }
 45. /*    reghdfe `reg_eq', absorb(${time} field field#${time} field#msa inst#
> year inst athr_id) vce(cluster msa)
>     mat instyr_`samp' = nullmat(instyr_`samp'), (`mat_est' \ e(N))
>     mat coef_`samp' = nullmat(coef_`samp') , instyr_`samp'*/
.     reghdfe `reg_eq', absorb(year msa athr_id field inst) vce(cluster msa)
 46.     mat field_`samp' = nullmat(field_`samp'), (`mat_est' \ e(N))
 47.     reghdfe `reg_eq', absorb(year msa athr_id gen_mesh1 gen_mesh2 inst) vc
> e(cluster msa)
 48.     mat field_`samp' = nullmat(field_`samp'), (`mat_est' \ e(N))
 49. *    mat alt_spec_`samp' = instyr_`samp' , field_`samp'
. /*    reghdfe `reg_eq', absorb(year msa athr_id qualifier_name1 qualifier_nam
> e2 inst) vce(cluster msa)
>     mat field_`samp' = nullmat(field_`samp'), (`mat_est' \ e(N))
>     reghdfe `reg_eq', absorb(year msa athr_id term1 term2 inst) vce(cluster m
> sa)
>     mat field_`samp' = nullmat(field_`samp'), (`mat_est' \ e(N))*/
.         
. end

. 
. program output_tables
  1.     syntax, samp(str) 
  2.     foreach file in top_10clus top_30clus coef field city_stats { 
  3.          qui matrix_to_txt, saving("../output/tables/`file'_`samp'.txt") m
> atrix(`file'_`samp') ///
>            title(<tab:`file'_`samp'>) format(%20.4f) replace
  4.     }
  5. 
. end

. ** 
. main
  367,533
N = 367,533; 185,374 unbalanced groups of sizes 1 to 48
(2,295 missing values generated)
(8 missing values generated)
(281,639 missing values generated)
(294,794 observations deleted)

     +-----------------------------------------------------------------------+
     |                                       msa_comb    msa_size   cluste~r |
     |-----------------------------------------------------------------------|
  1. |          New York-Newark-Jersey City, NY-NJ-PA   21968.068   .0233035 |
  2. |                 Boston-Cambridge-Newton, MA-NH   20632.938      .0219 |
  3. |   Washington-Arlington-Alexandria, DC-VA-MD-WV   18064.152   .0191008 |
  4. |                                   Bay Area, CA   15358.969   .0163546 |
  5. |             Los Angeles-Long Beach-Anaheim, CA   8992.8233   .0095379 |
     |-----------------------------------------------------------------------|
  6. |    Philadelphia-Camden-Wilmington, PA-NJ-DE-MD   8007.6526   .0085019 |
  7. |             Chicago-Naperville-Elgin, IL-IN-WI   7290.9537   .0077198 |
  8. |                         San Diego-Carlsbad, CA   6881.7731   .0072714 |
  9. |                     Research Triangle Park, NC   6832.3899    .007235 |
 10. |           Houston-The Woodlands-Sugar Land, TX   6536.6355   .0068962 |
     |-----------------------------------------------------------------------|
 11. |                    Seattle-Tacoma-Bellevue, WA   6045.2998   .0064479 |
 12. |                  Baltimore-Columbia-Towson, MD   5617.6017   .0059401 |
 13. |              Atlanta-Sandy Springs-Roswell, GA     5141.96   .0054418 |
 14. |                                  Ann Arbor, MI    3666.932   .0038987 |
 15. |                                 Pittsburgh, PA   3499.1498   .0037015 |
     |-----------------------------------------------------------------------|
 16. |                               St. Louis, MO-IL   3339.6528    .003559 |
 17. |                          New Haven-Milford, CT    3248.456   .0034725 |
 18. |                                    Madison, WI    2872.369   .0030414 |
 19. |                                     Ithaca, NY   2786.1415   .0029634 |
 20. |        Minneapolis-St. Paul-Bloomington, MN-WI   2761.1962   .0029262 |
     |-----------------------------------------------------------------------|
 21. |        Sacramento--Roseville--Arden-Arcade, CA   2640.6106   .0027964 |
 22. |                           Cleveland-Elyria, OH   2563.2336   .0026967 |
 23. | Nashville-Davidson--Murfreesboro--Franklin, TN   2485.5318   .0026277 |
 24. |                Dallas-Fort Worth-Arlington, TX   2468.1792    .002627 |
 25. |                                   Columbus, OH   2349.8801   .0025054 |
     |-----------------------------------------------------------------------|
 26. |                     Denver-Aurora-Lakewood, CO   2238.6043    .002381 |
 27. |                                Gainesville, FL   2159.0266   .0022887 |
 28. |                           Cincinnati, OH-KY-IN   1942.4211   .0020495 |
 29. |      Miami-Fort Lauderdale-West Palm Beach, FL   1907.4023   .0020176 |
 30. |            Portland-Vancouver-Hillsboro, OR-WA   1753.3502   .0018468 |
     +-----------------------------------------------------------------------+
(83 missing values generated)
(305 missing values generated)
variable msa_lab was str1 now str15
(1 real change made)
variable msa_lab was str15 now str22
(1 real change made)
(1 real change made)
(0 real changes made)
variable msa_lab was str22 now str37
(1 real change made)
(1 real change made)
(1 real change made)
(6 real changes made)
(1 real change made)
(1 real change made)
(1 real change made)
variable msa_lab was str37 now str39
(1 real change made)
variable msa_lab was str39 now str44
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(2 real changes made)
(4 real changes made)
file ../output/figures/pat_prod_scatter_year_firstlast.pdf saved as PDF
    format
  (importing .shp file)
  (importing .dbf file)
  (creating _ID spatial-unit id)
  (creating _CX coordinate)
  (creating _CY coordinate)

  file usa_state_shp.dta created
  file usa_state.dta     created

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           296,043  (_merge==3)
    -----------------------------------------
STATEFP: all characters numeric; replaced as byte
(9,030 observations deleted)
(344 observations deleted)
(116,302 real changes made)
(116,302 real changes made)
(310 observations deleted)
(2,373 real changes made)
(2,373 real changes made)
(166,263 real changes made)
(166,263 real changes made)
file usa_state_shp_clean.dta saved
  (importing .shp file)
  (importing .dbf file)
  (creating _ID spatial-unit id)
  (creating _CX coordinate)
  (creating _CY coordinate)

  file usa_msa_shp.dta created
  file usa_msa.dta     created

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           408,279  
    -----------------------------------------
CBSAFP: all characters numeric; replaced as long
(5,831 observations deleted)
(0 observations deleted)
(7,520 real changes made)
(7,520 real changes made)
(310 observations deleted)
(2,373 real changes made)
(2,373 real changes made)
file usa_msa_shp_clean.dta saved
(variable msatitle was str46, now str50 to accommodate using data's values)
(variable city was str35, now str42 to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                         5,364
        from master                     5,364  
        from using                          0  

    Matched                           362,169  
    -----------------------------------------
(33,938 real changes made)
(0 real changes made)
(26 real changes made)
(file ../temp/map_samp.dta not found)
file ../temp/map_samp.dta saved

    Result                      Number of obs
    -----------------------------------------
    Not matched                           638
        from master                       638  
        from using                          0  

    Matched                               307  
    -----------------------------------------
file ../output/figures/impact_cite_affl_wt_map_year_firstlast.pdf saved as
    PDF format
(0 observations deleted)
(2,295 missing values generated)
(8 missing values generated)
(281,639 missing values generated)
(8 real changes made)
(2,295 missing values generated)
(8 missing values generated)
(294,794 observations deleted)
(57,442 observations deleted)

                  (sum) impact_cite_affl_wt
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%     .0009203              0
10%     .0018406              0       Obs                 676
25%     .0036812              0       Sum of wgt.         676

50%     .0073625                      Mean           .1656336
                        Largest       Std. dev.      .9641591
75%     .0161974       3.637744
90%     .0657363       4.156103       Variance       .9296028
95%     .4999015       6.721949       Skewness       14.20298
99%     3.616452       19.99029       Kurtosis       271.1231

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
    msa_size |        676    2159.027     139.369       1786       2263

                  (sum) impact_cite_affl_wt
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%     .0012271              0
10%     .0022087              0       Obs                 985
25%     .0049587              0       Sum of wgt.         985

50%      .012751                      Mean           .9853974
                        Largest       Std. dev.      4.249258
75%      .153178       40.60669
90%     1.861172       44.89216       Variance       18.05619
95%     4.526474       51.73371       Skewness       8.168456
99%     19.68128         57.016       Kurtosis       83.87337

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
    msa_size |        985    3666.932    273.6121       3004       3915

                  (sum) impact_cite_affl_wt
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%     .0016529              0
10%     .0033058              0       Obs               2,168
25%     .0081816              0       Sum of wgt.       2,168

50%     .0548504                      Mean           1.891496
                        Largest       Std. dev.      5.874408
75%     1.560341        59.0652
90%     4.436334        59.0652       Variance       34.50866
95%     8.508016       64.35387       Skewness       10.23855
99%     28.63573       141.9804       Kurtosis       179.2067

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
    msa_size |      2,168    6881.773    658.5043       5337       7464

                  (sum) impact_cite_affl_wt
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%     .0018406              0
10%     .0036812              0       Obs               5,044
25%     .0089401              0       Sum of wgt.       5,044

50%     .3983848                      Mean           2.851947
                        Largest       Std. dev.      11.01276
75%     2.308903       181.6684
90%     6.980129       202.2141       Variance        121.281
95%     12.07677        368.757       Skewness       19.37246
99%     32.98954        368.757       Kurtosis       548.6113

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
    msa_size |      5,044    15358.97    792.5829      13210      15943

                  (sum) impact_cite_affl_wt
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%     .0018406              0
10%     .0033131              0       Obs               6,424
25%     .0087429              0       Sum of wgt.       6,424

50%     .3537764                      Mean           2.793774
                        Largest       Std. dev.      7.768215
75%     2.544687        126.395
90%      6.94017       167.0986       Variance       60.34517
95%     12.69272       167.0986       Skewness        10.1064
99%     32.46129       202.1652       Kurtosis       177.0758

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
    msa_size |      6,424    20632.94    1462.599      16880      21662
(MWFE estimator converged in 1 iterations)

HDFE Linear regression                            Number of obs   =    365,238
Absorbing 1 HDFE group                            F(   1, 365236) =   19919.31
                                                  Prob > F        =     0.0000
                                                  R-squared       =     0.0517
                                                  Adj R-squared   =     0.0517
                                                  Within R-sq.    =     0.0517
                                                  Root MSE        =     2.2927

------------------------------------------------------------------------------
        ln_y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .3759362   .0026636   141.14   0.000     .3707156    .3811569
       _cons |  -6.113987   .0216509  -282.39   0.000    -6.156422   -6.071552
------------------------------------------------------------------------------
(dropped 22 singleton observations)
(MWFE estimator converged in 7 iterations)

HDFE Linear regression                            Number of obs   =    365,216
Absorbing 3 HDFE groups                           F(   1,    282) =       3.60
Statistics robust to heteroskedasticity           Prob > F        =     0.0588
                                                  R-squared       =     0.1642
                                                  Adj R-squared   =     0.1634
                                                  Within R-sq.    =     0.0003
Number of clusters (msa)     =        283         Root MSE        =     2.1535

                                  (Std. err. adjusted for 283 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |    .203591   .1073019     1.90   0.059    -.0076234    .4148054
       _cons |  -4.734805   .8587325    -5.51   0.000    -6.425145   -3.044466
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |        78           0          78     |
         msa |       283         283           0    *|
       field |         5           1           4     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 31 singleton observations)
(MWFE estimator converged in 5 iterations)

HDFE Linear regression                            Number of obs   =    365,207
Absorbing 4 HDFE groups                           F(   1,    282) =       3.96
Statistics robust to heteroskedasticity           Prob > F        =     0.0477
                                                  R-squared       =     0.2110
                                                  Adj R-squared   =     0.2096
                                                  Within R-sq.    =     0.0004
Number of clusters (msa)     =        283         Root MSE        =     2.0932

                                  (Std. err. adjusted for 283 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .2030614   .1021019     1.99   0.048     .0020829    .4040399
       _cons |  -4.730563   .8171239    -5.79   0.000    -6.338999   -3.122126
------------------------------------------------------------------------------

Absorbed degrees of freedom:
------------------------------------------------------+
  Absorbed FE | Categories  - Redundant  = Num. Coefs |
--------------+---------------------------------------|
         year |        78           0          78     |
          msa |       283         283           0    *|
        field |         5           1           4     |
   field#year |       369          78         291    ?|
------------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 144 singleton observations)
(MWFE estimator converged in 6 iterations)

HDFE Linear regression                            Number of obs   =    365,094
Absorbing 5 HDFE groups                           F(   1,    275) =       3.74
Statistics robust to heteroskedasticity           Prob > F        =     0.0541
                                                  R-squared       =     0.2175
                                                  Adj R-squared   =     0.2140
                                                  Within R-sq.    =     0.0003
Number of clusters (msa)     =        276         Root MSE        =     2.0873

                                  (Std. err. adjusted for 276 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .1930417   .0998109     1.93   0.054    -.0034487    .3895322
       _cons |  -4.650462   .7989506    -5.82   0.000    -6.223298   -3.077626
------------------------------------------------------------------------------

Absorbed degrees of freedom:
------------------------------------------------------+
  Absorbed FE | Categories  - Redundant  = Num. Coefs |
--------------+---------------------------------------|
         year |        78           0          78     |
          msa |       276         276           0    *|
        field |         5           1           4     |
   field#year |       369          78         291    ?|
    msa#field |       987         987           0    *|
------------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 1537 singleton observations)
(MWFE estimator converged in 17 iterations)

HDFE Linear regression                            Number of obs   =    363,701
Absorbing 6 HDFE groups                           F(   1,    267) =       4.14
Statistics robust to heteroskedasticity           Prob > F        =     0.0430
                                                  R-squared       =     0.2656
                                                  Adj R-squared   =     0.2566
                                                  Within R-sq.    =     0.0004
Number of clusters (msa)     =        268         Root MSE        =     2.0302

                                  (Std. err. adjusted for 268 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .2634749   .1295506     2.03   0.043     .0084043    .5185456
       _cons |  -5.211988   1.037182    -5.03   0.000    -7.254085   -3.169892
------------------------------------------------------------------------------

Absorbed degrees of freedom:
------------------------------------------------------+
  Absorbed FE | Categories  - Redundant  = Num. Coefs |
--------------+---------------------------------------|
         year |        78           0          78     |
          msa |       268         268           0    *|
        field |         5           1           4     |
   field#year |       369          78         291    ?|
    msa#field |       969         969           0    *|
         inst |      2796        2796           0    *|
------------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 124323 singleton observations)
(MWFE estimator converged in 47 iterations)

HDFE Linear regression                            Number of obs   =    240,915
Absorbing 7 HDFE groups                           F(   1,    227) =       7.79
Statistics robust to heteroskedasticity           Prob > F        =     0.0057
                                                  R-squared       =     0.6564
                                                  Adj R-squared   =     0.5325
                                                  Within R-sq.    =     0.0002
Number of clusters (msa)     =        228         Root MSE        =     1.6140

                                  (Std. err. adjusted for 228 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .1909783   .0684169     2.79   0.006     .0561649    .3257916
       _cons |  -4.502701   .5492415    -8.20   0.000    -5.584965   -3.420438
------------------------------------------------------------------------------

Absorbed degrees of freedom:
------------------------------------------------------+
  Absorbed FE | Categories  - Redundant  = Num. Coefs |
--------------+---------------------------------------|
         year |        78           0          78     |
          msa |       228         228           0    *|
        field |         5           1           4     |
   field#year |       363          78         285    ?|
    msa#field |       852         852           0    *|
         inst |      1861        1861           0    *|
      athr_id |     60510           1       60509    ?|
------------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 124172 singleton observations)
(MWFE estimator converged in 45 iterations)

HDFE Linear regression                            Number of obs   =    241,066
Absorbing 5 HDFE groups                           F(   1,    240) =       7.86
Statistics robust to heteroskedasticity           Prob > F        =     0.0055
                                                  R-squared       =     0.6451
                                                  Adj R-squared   =     0.5202
                                                  Within R-sq.    =     0.0002
Number of clusters (msa)     =        241         Root MSE        =     1.6351

                                  (Std. err. adjusted for 241 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .1915042    .068316     2.80   0.005     .0569287    .3260798
       _cons |  -4.506848   .5482764    -8.22   0.000    -5.586896     -3.4268
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |        78           0          78     |
         msa |       241         241           0    *|
     athr_id |     60555           1       60554     |
       field |         5           1           4    ?|
        inst |      1881        1881           0    *|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 82420 singleton observations)
(MWFE estimator converged in 69 iterations)

HDFE Linear regression                            Number of obs   =    156,058
Absorbing 6 HDFE groups                           F(   1,    212) =       3.49
Statistics robust to heteroskedasticity           Prob > F        =     0.0630
                                                  R-squared       =     0.6822
                                                  Adj R-squared   =     0.5171
                                                  Within R-sq.    =     0.0001
Number of clusters (msa)     =        213         Root MSE        =     1.7081

                                  (Std. err. adjusted for 213 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .2246656   .1202111     1.87   0.063    -.0122966    .4616278
       _cons |  -4.229132   .9889292    -4.28   0.000    -6.178526   -2.279738
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |        78           0          78     |
         msa |       213         213           0    *|
     athr_id |     39134           1       39133     |
   gen_mesh1 |      6032         182        5850    ?|
   gen_mesh2 |      6878         273        6605    ?|
        inst |      1480        1480           0    *|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. 
end of do-file

--------------------------------------------------------------------------------
Makelog ended: 2024-01-05 12:34:10
Working directory: /export/home/dor/cxu/innovation_projs/analysis/science_geo/cluster_descriptives/code
--------------------------------------------------------------------------------
