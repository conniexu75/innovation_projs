--------------------------------------------------------------------------------
Makelog started: 2025-08-12 19:49:05
Working directory: /export/projects4/achandra_basicscience/analysis/science_geo/cluster_descriptives/code
--------------------------------------------------------------------------------
External links successfully created!

  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      18.0
___/   /   /___/   /   /___/       MP—Parallel Edition

 Statistics and Data Science       Copyright 1985-2023 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-STATA-PC        https://www.stata.com
                                   979-696-4600        stata@stata.com

Stata license: Unlimited-user 4-core network, expiring 17 Nov 2025
Serial number: 501809301897
  Licensed to: Harvard Business School
               Research Computing

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. More than 2 billion observations are allowed; see help obs_advice.
      4. Maximum number of variables is set to 5,000 but can be increased;
          see help set_maxvar.

. do "/export/projects4/achandra_basicscience/analysis/science_geo/cluster_desc
> riptives/code/analysis.do" 

. set more off 

. clear all

. capture log close

. program drop _all

. set scheme modern

. graph set window fontface "Arial Narrow"
not available in non-GUI version

. pause on

. set seed 8975

. global cite_affl_wt_name "Output"

. global impact_cite_affl_wt_name "Output"

. global body_adj_wt_name "Paper-to-Patent Citations"

. global body_affl_wt_name "Paper-to-Patent Citations"

. global ln_y_name "Log Output"

. global ln_pat_name "Log Paper-to-Patent Citations"

. global msa_size_name "Cluster Size"

. global ln_x_name "Log Cluster Size"

. global time year

. global year_insts "/export/home/dor/cxu/derived/openalex/15jrnls/clean_athr_i
> nst_hist_15jrnls/output"

. 
. program main
  1.     foreach s in year_second {
  2.         inst_desc, samp(`s')
  3.         msa_desc, samp(`s')
  4.         maps, samp(`s')
  5.         raw_bs, samp(`s')
  6.         *econ_regression, samp(`s')
.         regression, samp(`s')
  7.         *firm_externalities, samp(`s')
.         output_tables, samp(`s')
  8.     }
  9. end

. 
. program inst_desc
  1.     syntax, samp(str) 
  2.     use if !mi(inst_id) & inrange(year, 1945,2023) using ../external/samp/
> athr_panel_full_comb_`samp', clear 
  3.     keep if inrange(year, 2015,2023)
  4.     keep if country_code == "US"
  5.     collapse (sum) patent_count pat_affl_wt impact_cite_affl_wt (firstnm) 
> inst, by(inst_id)
  6.     gen lab = "" 
  7.     replace lab =  inst if inst == "Harvard University"
  8.     replace lab =  inst if inst == "Massachusetts Institute of Technology"
  9.     replace lab =  inst if inst == "Stanford University"
 10.     replace lab =  inst if inst == "National Institutes of Health"
 11.     replace lab =  inst if inst == "Washington University in St. Louis"
 12.     replace lab =  inst if inst == "University of California, Berkeley"
 13.     replace lab =  inst if inst == "University of California, San Francisc
> o"
 14.     replace lab =  inst if inst == "California Institute of Technology"
 15. 
.     egen clock = mlabvpos(impact_cite_affl_wt pat_affl_wt)
 16.     replace clock = 9 if inlist(inst, "Massachusetts Institute of Technolo
> gy")
 17.     qui reg impact_cite_affl_wt pat_affl_wt
 18.     local coef : dis %3.2f _b[pat_affl_wt]
 19.     local cons : dis %3.2f _b[_cons]
 20.     local N = e(N)
 21.     qui corr impact_cite_affl_wt pat_affl_wt 
 22.     local corr : dis %3.2f r(rho)
 23.     qui reg impact_cite_affl_wt pat_affl_wt
 24.     local coef : dis %3.2f _b[pat_affl_wt]
 25.     local cons : dis %3.2f _b[_cons]
 26.     tw scatter impact_cite_affl_wt pat_affl_wt if pat_affl_wt > 0, mcolor(
> gs13%50) msize(vsmall) xlabel(0(1000)5000, labsize(vsmall)) ylab(0(1000)8000,
>  labsize(vsmall)) || ///
>        scatter impact_cite_affl_wt pat_affl_wt if !mi(lab)& pat_affl_wt > 0 ,
>  mlabvp(clock) mcolor(ebblue) msize(vsmall)  mlabel(lab) mlabcolor(black) mla
> bsize(tiny) || ///
>       (function y=_b[pat_affl_wt]*x+_b[_cons] , range(0 5000) lpattern(dash) 
> lcolor(lavender)), ytitle("Institutional Output", size(vsmall)) xtitle("Insti
> tutional Paper-to-Patent Citations", size(vsmall)) legend(on order(- "N = `N'
> " ///
>       "Correlation = `corr'") pos(5) ring(0) region(fcolor(none)) size(vsmall
> ) lwidth(none))
 27.     graph export ../output/figures/inst_pat_output_scatter_`samp'.pdf, rep
> lace
 28. end

. 
. program msa_desc
  1.     syntax, samp(str) 
  2.     use ../external/econs_samp/athr_panel_full_comb_year.dta, clear
  3.     gcollapse (mean) msa_size, by(msa_comb)
  4.     rename msa_size econ_msa_size
  5.     save ../temp/econs_cluster, replace
  6.     use if !mi(msa_comb) & inrange(year, 1945,2023) using ../external/samp
> /athr_panel_full_comb_`samp', clear 
  7.     count
  8.     gunique athr_id
  9.     gen ln_y = ln(impact_cite_affl_wt)
 10.     gen ln_x = ln(msa_size)
 11.     gen ln_pat = ln(body_adj_wt)
 12.     foreach var in impact_cite_affl_wt msa_size ln_y ln_x body_adj_wt ln_p
> at {
 13.         qui sum `var', d
 14.         local N = r(N)
 15.         local mean : dis %3.2f r(mean)
 16.         local sd : dis %3.2f r(sd)
 17.         local p5 :  dis %3.2f r(p5)
 18.         local p25 :  dis %3.2f r(p25)
 19.         local p50 :  dis %3.2f r(p50)
 20.         local p75 :  dis %3.2f r(p75)
 21.         local p95 :  dis %3.2f r(p95)
 22.         tw hist `var', frac ytitle("Share of author-years", size(vsmall)) 
> xtitle("${`var'_name}", size(vsmall)) color(edkblue) xlab(, labsize(vsmall)) 
> ylab(, labsize(vsmall)) legend(on order(- "N = `N'" ///
>                                                                 "Mean = `mean
> '" ///
>                                                                 "            
> (`sd')" ///
>                                                                 "p5 = `p5'" /
> //
>                                                                 "p25 = `p25'"
>  ///
>                                                                 "p50 = `p50'"
>  ///
>                                                                 "p75 = `p75'"
>  ///
>                                                                 "p95 = `p95'"
> ) pos(1) ring(0) size(vsmall) region(fcolor(none)))
 23.         *graph export ../output/figures/`var'_dist`samp'.pdf, replace
.     }
 24.     preserve
 25.     keep if inrange(year, 2015,2023)
 26.     gcollapse (mean) msa_size cluster_shr, by(msa_comb)
 27.     gsort -msa_size
 28.     mkmat msa_size in 1/30, mat(top_30clus_`samp')
 29.     li in 1/30
 30.     mkmat msa_size in 1/10, mat(top_10clus_`samp')
 31.     restore
 32.     preserve
 33.     gen has_patent_cite = pat_wt > 0
 34.     bys athr_id msa_comb: gen athr_cnt = _n == 1
 35.     keep if year >= 2015
 36.     gcollapse  (sum) athr_cnt body_affl_wt pat_affl_wt front_affl_wt body_
> adj_wt cite_affl_wt pat_wt affl_wt impact_cite_affl_wt impact_affl_wt (mean) 
> msa_size has_patent_cite, by(msa_comb)
 37.     merge 1:1 msa_comb using ../temp/econs_cluster, assert(1 2 3) keep(1 3
> ) nogen
 38. 
.     qui reg body_adj_wt impact_cite_affl_wt 
 39.     local coef : dis %3.2f _b[impact_cite_affl_wt]
 40.     local N = e(N)
 41.     binscatter2 body_adj_wt impact_cite_affl_wt , xtitle("Output", size(vs
> mall)) ytitle("Paper-to-Patent Citations", size(vsmall)) lcolor(ebblue) mcolo
> r(gs3) xlab(, labsize(vsmall)) ylab(, labsize(vsmall)) legend(on order(- "N (
> MSAs) = `N'" ///
>                                                                              
>                                          "Corr. = `corr'") pos(5) ring(0) reg
> ion(fcolor(none)) size(vsmall))
 42.     *graph export ../output/figures/msa_pat_prod_`samp'.pdf, replace
.     gen ln_pat = ln(body_adj_wt)
 43.     gen ln_y = ln(impact_cite_affl_wt)
 44.     qui reg ln_pat ln_y 
 45.     local coef : dis %3.2f _b[ln_y]
 46.     local N = e(N)
 47.     binscatter2 ln_pat ln_y , xtitle("Log Output", size(vsmall)) ytitle("L
> og Paper-to-Patent Citations", size(vsmall)) lcolor(ebblue) mcolor(gs3)  xlab
> (, labsize(vsmall)) ylab(, labsize(vsmall)) legend(on order(- "N (MSAs) = `N'
> " ///
>                                                                              
>                                          "Slope = `coef'") pos(5) ring(0) reg
> ion(fcolor(none)) size(vsmall))
 48.     *graph export ../output/figures/msa_log_pat_prod_`samp'.pdf, replace
.     
.     xtile p  = msa_size, nq(20)
 49.     gen msa_lab = "" 
 50.    replace msa_lab =  msa_comb if msa_comb == "San Diego-Carlsbad, CA" 
 51.    replace msa_lab =  msa_comb if msa_comb == "Bay Area, CA" 
 52.    replace msa_lab =  msa_comb if msa_comb == "St. Louis, MO-IL" 
 53.    replace msa_lab =  msa_comb if msa_comb == "Seattle-Tacoma-Bellevue, WA
> " 
 54.    replace msa_lab =  msa_comb if msa_comb == "Minneapolis-St. Paul-Bloomi
> ngton, MN-WI" 
 55.    replace msa_lab =  msa_comb if msa_comb == "Washington-Arlington-Alexan
> dria, DC-VA-MD-WV" 
 56.    replace msa_lab =  msa_comb if msa_comb == "Los Angeles-Long Beach-Anah
> eim, CA" 
 57.    replace msa_lab =  msa_comb if msa_comb == "Boston-Cambridge-Newton, MA
> -NH" 
 58.    replace msa_lab =  msa_comb if msa_comb == "New York-Newark-Jersey City
> , NY-NJ-PA" 
 59.    replace msa_lab =  msa_comb  if msa_comb == "New Haven-Milford , CT" 
 60.    egen clock = mlabvpos(msa_size econ_msa_size)
 61.    replace clock = 9 if inlist(msa_lab , "New York-Newark-Jersey City, NY-
> NJ-PA","Boston-Cambridge-Newton, MA-NH")
 62.    replace clock = 3 if inlist(msa_lab , "Minneapolis-St. Paul-Bloomington
> , MN-WI", "San Diego-Carlsbad, CA", "St. Louis, MO-IL", "Bay Area, CA", "Seat
> tle-Tacoma-Bellevue, WA", "Washington-Arlington-Alexandria, DC-VA-MD-WV")
 63.     tw scatter impact_cite_affl_wt msa_size , mcolor(gs7%50) msize(vsmall)
>  xlabel(#10, labsize(vsmall)) ylab(#10, labsize(vsmall)) || scatter impact_ci
> te_affl_wt msa_size if !mi(msa_lab) , mcolor(ebblue) msize(vsmall)  mlabel(ms
> a_lab) mlabcolor(black) mlabsize(tiny) xtitle("MSA Cluster Size", size(vsmall
> )) ytitle("MSA Output", size(vsmall))  jitter(5) legend(off)
 64.    *graph export ../output/figures/cluster_prod_scatter_`samp'.pdf, replac
> e
.     corr msa_size econ_msa_size 
 65.     local slope : dis %3.2f r(rho) 
 66.     reg msa_size econ_msa_size
 67.     local N = e(N)
 68.     tw scatter msa_size econ_msa_size, mcolor(gs7%50) msize(vsmall) xlabel
> (#10, labsize(vsmall)) ylab(#10, labsize(vsmall)) || ///
>        scatter msa_size econ_msa_size if !mi(msa_lab) , mcolor(ebblue) mlabvp
> (clock) msize(vsmall)  mlabel(msa_lab) mlabcolor(black) mlabsize(tiny) || ///
>        (function y = _b[econ_msa_size]*x + _b[_cons], range(0 900) lpattern(d
> ash) lcolor(lavender)), ytitle("Fundamental Science Cluster Size", size(vsmal
> l)) xtitle("Economics Research Cluster Size", size(vsmall))  legend(on order 
> (- "N (MSAs) = `N'" ///
>                                                                              
>                                                                              
>                     "Correlation = `slope'") pos(5) ring(0) region(fcolor(non
> e)) size(vsmall) lwidth(none))
 69.     graph export ../output/figures/econ_v_ls_`samp'.pdf, replace
 70.     drop clock
 71.    xtile p_prod = impact_cite_affl_wt, nq(20)
 72.    replace msa_lab = ""
 73.    replace msa_lab =  msa_comb if msa_comb == "San Diego-Carlsbad, CA" 
 74.    replace msa_lab =  msa_comb if msa_comb == "Bay Area, CA" 
 75.    replace msa_lab =  msa_comb if msa_comb == "St. Louis, MO-IL" 
 76.    replace msa_lab =  msa_comb if msa_comb == "Minneapolis-St. Paul-Bloomi
> ngton, MN-WI" 
 77.    replace msa_lab =  msa_comb if msa_comb == "Washington-Arlington-Alexan
> dria, DC-VA-MD-WV" 
 78.    replace msa_lab =  msa_comb if msa_comb == "Los Angeles-Long Beach-Anah
> eim, CA" 
 79.    replace msa_lab =  msa_comb if msa_comb == "Boston-Cambridge-Newton, MA
> -NH" 
 80.    replace msa_lab =  msa_comb if msa_comb == "New York-Newark-Jersey City
> , NY-NJ-PA" 
 81.    replace msa_lab =  msa_comb if msa_comb == "Seattle-Tacoma-Bellevue, WA
> " 
 82.    replace msa_lab =  msa_comb if msa_comb == "Ithaca, NY" 
 83.    egen clock = mlabvpos(impact_cite_affl_wt body_adj_wt)
 84.    replace clock = 9 if inlist(msa_lab , "New York-Newark-Jersey City, NY-
> NJ-PA","Boston-Cambridge-Newton, MA-NH", "San Diego-Carlsbad, CA", "Washingto
> n-Arlington-Alexandria, DC-VA-MD-WV", "Ithaca, NY")  
 85.    replace clock = 3 if inlist(msa_lab , "Minneapolis-St. Paul-Bloomington
> , MN-WI", "St. Louis, MO-IL", "Bay Area, CA", "Los Angeles-Long Beach-Anaheim
> , CA",  "Washington-Arlington-Alexandria, DC-VA-MD-WV", "Seattle-Tacoma-Belle
> vue, WA")
 86.    qui reg body_adj_wt impact_cite_affl_wt 
 87.    local coef : dis %3.2f _b[impact_cite_affl_wt]
 88.    local cons : dis %3.2f _b[_cons]
 89.    local N = e(N)
 90.    qui corr body_adj_wt impact_cite_affl_wt if body_adj_wt > 0
 91.    local corr : dis %3.2f r(rho)
 92.    tw scatter body_adj_wt impact_cite_affl_wt  if body_adj_wt > 0, mcolor(
> gs13%50) msize(vsmall) xlabel(0(5000)25000, labsize(vsmall)) ylab(0(500)2500,
>  labsize(vsmall)) || ///
>       scatter body_adj_wt impact_cite_affl_wt if !mi(msa_lab)& body_adj_wt > 
> 0 , mlabvp(clock) mcolor(ebblue) msize(vsmall)  mlabel(msa_lab) mlabcolor(bla
> ck) mlabsize(tiny) || ///
>       (function y=_b[impact_cite_affl_wt]*x+_b[_cons] , range(0 25000) lpatte
> rn(dash) lcolor(lavender)), xtitle("MSA Output", size(vsmall)) ytitle("MSA Pa
> per-to-Patent Citations", size(vsmall)) legend(on order(- "N (MSAs) = `N'" //
> /
>                                                                              
>                                          "Corr. = `corr'") pos(5) ring(0) reg
> ion(fcolor(none)) size(vsmall))
 93.    graph export ../output/figures/pat_prod_scatter_`samp'.pdf, replace
 94.    qui reg body_affl_wt impact_cite_affl_wt 
 95.    local coef : dis %3.2f _b[impact_cite_affl_wt]
 96.    local cons : dis %3.2f _b[_cons]
 97.    local N = e(N)
 98.    qui corr body_affl_wt impact_cite_affl_wt if body_adj_wt > 0
 99. 
.    local corr : dis %3.2f r(rho)
100. 
.    tw scatter body_affl_wt impact_cite_affl_wt if body_affl_wt > 0 , mcolor(g
> s13%50) msize(vsmall) xlabel(0(3000)24000, labsize(vsmall)) ylab(0(300)1500, 
> labsize(vsmall)) || ///
>       scatter body_affl_wt impact_cite_affl_wt if !mi(msa_lab) & body_affl_wt
>  > 0 , mlabvp(clock) mcolor(ebblue) msize(vsmall)  mlabel(msa_lab) mlabcolor(
> black) mlabsize(tiny) || ///
>       (function y=_b[impact_cite_affl_wt]*x+_b[_cons] , range(0 24000) lpatte
> rn(dash) lcolor(lavender)), xtitle("MSA Output", size(vsmall)) ytitle("MSA Pa
> per-to-Patent Citations", size(vsmall)) legend(on order(- "N (MSAs) = `N'" //
> /
>                                                                              
>                                          "Corr. = `corr'") pos(5) ring(0) reg
> ion(fcolor(none)) size(vsmall))
101.    graph export ../output/figures/pat_cnt_prod_scatter_`samp'.pdf, replace
102. end

. 
. program  maps
  1.     syntax, samp(str) 
  2.     spshape2dta ../external/geo/cb_2018_us_state_500k.shp, replace saving(
> usa_state)
  3.     use usa_state_shp, clear
  4.     merge m:1 _ID using usa_state
  5.     destring STATEFP, replace
  6.     drop if STATEFP > 56
  7.     // alaska
.     drop if _X > 0 & !mi(_X) & STATEFP == 2  
  8.     geo2xy _Y _X if STATEFP ==2, proj(mercator) replace
  9.     replace _Y = _Y / 5 +1200000 if STATEFP == 2 
 10.     replace _X = _X / 5 - 2000000  if STATEFP == 2 
 11.     drop if _X < -160 & !mi(_X) & _ID == 43  // small islands to the west
 12.     geo2xy _Y _X if _ID == 43, proj(mercator) replace
 13.     replace _Y = _Y  + 800000 if _ID == 43
 14.     replace _X = _X  - 1200000 if _ID == 43
 15.     geo2xy _Y _X if !inlist(_ID, 28,43), replace proj(mercator)
 16.     replace _X = _X + 53500 if !inlist(_ID, 28,43)
 17.     replace _Y = _Y - 3100 if !inlist(_ID, 28,43)
 18.     drop _CX- _merge
 19.     sort _ID shape_order
 20.     save usa_state_shp_clean.dta, replace
 21.     
.     spshape2dta ../external/geo/cb_2018_us_cbsa_500k.shp, replace saving(usa_
> msa)
 22.     use usa_msa_shp, clear
 23.     merge m:1 _ID using usa_msa, nogen
 24.     destring CBSAFP, replace
 25.     gen state = strtrim(substr(NAME, strpos(NAME, ",")+1, 3))
 26.     drop if inlist(state, "PR")
 27.     // alaska
.     drop if _X > 0 & !mi(_X) & state == "AK" 
 28.     geo2xy _Y _X if state == "AK" , proj(mercator) replace
 29.    replace _Y = _Y / 5 + 1200000 if state == "AK"
 30.     replace _X = _X / 5 - 1705000 if state == "AK" 
 31.     drop if _X < -160 & !mi(_X) & state == "HI"  // small islands to the w
> est
 32.     geo2xy _Y _X if state == "HI", proj(mercator) replace
 33.     replace _Y = _Y + 800000 if state == "HI" 
 34.     replace _X = _X  - 1200000 if state == "HI" 
 35.     geo2xy _Y _X if !inlist(state, "AK", "HI"), replace proj(mercator)
 36.     sort _ID shape_order
 37.     save usa_msa_shp_clean.dta, replace
 38. 
.     use if !mi(msa_comb) & inrange(year, 1945, 2023) using ../external/samp/a
> thr_panel_full_`samp', clear
 39. *    bys msa_comb: egen mode = mode(msacode)
. *    replace msacode = mode
.     merge m:1 msacode using ../external/geo/msas, assert(1 2 3) keep(1 3) nog
> en
 40.     replace msa_comb = msatitle if !mi(msatitle)
 41.     replace msa_comb = "San Francisco-Oakland-Hayward, CA" if msa_comb == 
> "San Francisco-Oakland-Haywerd, CA"
 42.     replace msa_comb = "Macon-Bibb County, GA" if msa_comb == "Macon, GA"
 43.     bys athr_id msa_comb ${time} : gen count = _n == 1
 44.     gcollapse (sum) affl_wt impact_cite_affl_wt body_adj_wt (mean) msa_siz
> e , by(msa_comb)
 45.     save ../temp/map_samp, replace
 46.     
.     use usa_msa, clear
 47.     rename NAME msa_comb
 48.     merge 1:m msa_comb using ../temp/map_samp, assert(1 2 3) keep(1 3) nog
> en
 49.     foreach var in impact_cite_affl_wt {
 50.         xtile `var'_5 = `var', nq(5)
 51.         qui sum `var' 
 52.         local min : dis %3.2f r(min)
 53.         local max : dis %3.2f r(max)
 54.         _pctile `var',percentiles(20 40 60 80)
 55.         local p20: dis %3.2f r(r1)
 56.         local p40: dis %3.2f r(r2)
 57.         local p60: dis %3.2f r(r3)
 58.         local p80: dis %3.2f r(r4)
 59.         colorpalette carto Teal, n(5) nograph 
 60.         spmap  `var'_5 using usa_msa_shp_clean,  id(_ID)  fcolor(`r(p)'%50
> ) clnumber(5) ///
>           ocolor(white ..) osize(0.15 ..) ndfcolor(gs13) ndocolor(white ..) n
> dsize(0.15 ..) ndlabel("No data") ///
>           polygon(data("usa_state_shp_clean") ocolor(gs2) osize(0.2) fcolor(e
> ggshell%20)) ///
>           legend(label(2 "Min-p20: `min'-`p20'") label(3 "p20-p40: `p20'-`p40
> '") label(4 "p40-p60: `p40'-`p60'") label(5 "p60-p80: `p60'-`p80'") label(6 "
> p80-Max: `p80'-`max'") pos(4) size(2)) legtitle("${`var'_name}")
 61.         graph export ../output/figures/`var'_map_`samp'.pdf, replace
 62.     }
 63. end

. 
. program raw_bs
  1.     syntax, samp(str) 
  2.     use if !mi(msa_comb) & inrange(year, 1945, 2023) using ../external/sam
> p/athr_panel_full_comb_`samp', clear
  3.     drop if mi(msa_comb) 
  4.     gegen msa = group(msa_comb)
  5.     gen ln_y = ln(impact_cite_affl_wt)
  6.     gen ln_x = ln(msa_size)
  7.     gen ln_pat = ln(body_adj_wt)
  8. 
.     // patented vs Output
.     qui reg body_adj_wt impact_cite_affl_wt 
  9.     local coef : dis %3.2f _b[impact_cite_affl_wt]
 10.     local N = e(N)
 11.     binscatter2 body_adj_wt impact_cite_affl_wt, xtitle("Output", size(vsm
> all)) ytitle("Paper-to-Patent Citations", size(vsmall)) xlab(, labsize(vsmall
> )) ylab(, labsize(vsmall)) mcolor(gs5) lcolor(ebblue) legend(on order(- "N (A
> uthor-years) = `N'" ///
>                                                                              
>                                          "Slope = `coef'") pos(5) ring(0) reg
> ion(fcolor(none)) size(vsmall))
 12.     *graph export ../output/figures/pat_prod_`samp'.pdf, replace
.     qui reg ln_pat ln_y 
 13.     local coef : dis %3.2f _b[ln_y]
 14.     local N = e(N)
 15.     binscatter2 ln_pat ln_y , xtitle("Log Output", size(vsmall)) ytitle("L
> og Paper-to-Patent Citations", size(vsmall)) xlab(, labsize(vsmall)) ylab(, l
> absize(vsmall)) mcolor(gs5) lcolor(ebblue) legend(on order(- "N (Author-years
> ) = `N'" ///
>                                                                              
>                                          "Slope = `coef'") pos(5) ring(0) reg
> ion(fcolor(none)) size(vsmall))
 16.     *graph export ../output/figures/log_pat_prod_`samp'.pdf, replace
. end

. 
. program econ_regression 
  1.     syntax, samp(str) 
  2.     use if !mi(msa_comb) & inrange(year, 1945, 2023) using ../external/sam
> p/athr_panel_full_comb_`samp', clear 
  3.     gcollapse (mean) msa_size, by(msa_comb year)
  4.     rename msa_size ls_msa_size
  5.     save ../temp/ls_yr_cluster, replace
  6.     
.     use if !mi(msa_comb) & inrange(year, 1945, 2023) using ../external/econs_
> samp/athr_panel_full_comb_year.dta, clear
  7.     merge m:1 msa_comb year using  ../temp/ls_yr_cluster, assert(1 2 3) ke
> ep(1 3) nogen
  8.     local reg_eq "ln_y ln_x"
  9.     local mat_est "_b[ln_x] \ _se[ln_x]"
 10.     bys athr_id msa_comb ${time} : gen count = _n == 1
 11.     replace msa_size = 0.0000000000001 if msa_size == 0
 12.     replace ls_msa_size = 0.0000000000001 if ls_msa_size == 0
 13.     gegen msa = group(msa_comb)
 14.     rename inst inst_name
 15.     gegen inst = group(inst_id)
 16.     gen ln_y = ln(cite_affl_wt)
 17.     gen ln_x = ln(ls_msa_size)
 18.     gen ln_x_econ = ln(msa_size)
 19.     reghdfe `reg_eq', noabsorb
 20.     local slope = _b[ln_x]
 21.     foreach fe in "${time} msa" "${time} msa inst" "${time} msa inst athr_
> id" {
 22.         reghdfe `reg_eq', absorb(`fe') vce(cluster msa)
 23.         mat econ_coef_`samp' = nullmat(econ_coef_`samp'), (`mat_est' \ . \
>  . \e(N))
 24.         local slope : dis %3.2f _b[ln_x]
 25.     }
 26.     reghdfe ln_y ln_x_econ, absorb(${time} msa inst athr_id) vce(cluster m
> sa)
 27.     mat econ_`samp' = nullmat(econ_`samp'), (. \ . \ _b[ln_x_econ] \ _se[l
> n_x_econ] \ e(N))
 28.     mat econ_coef_`samp' = nullmat(econ_coef_`samp') , econ_`samp'
 29.     mat drop econ_`samp'
 30. end

. 
. program regression 
  1.     syntax, samp(str) 
  2.     use ../external/econs_samp/athr_panel_full_comb_year.dta, clear
  3.     gcollapse (mean) msa_size, by(msa_comb year)
  4.     rename msa_size econ_msa_size
  5.     save ../temp/econ_yr_cluster, replace
  6. 
.     use if !mi(msa_comb) & inrange(year, 1945, 2023) using ../external/samp/a
> thr_panel_full_comb_`samp', clear 
  7.     gcollapse (mean) msa_size, by(msa_comb year)
  8.     merge 1:1 msa_comb year using ../temp/econ_yr_cluster, keep(3) nogen
  9.     corr msa_size econ_msa_size 
 10.     local slope : dis %3.2f r(rho) 
 11.     reg msa_size econ_msa_size
 12.     local N = e(N)
 13.     gen msa_lab = "" 
 14.     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "
> San Diego-Carlsbad, CA" & year == 1973
 15.     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "
> San Diego-Carlsbad, CA" & year == 19
 16.     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "
> Trenton, NJ" & year == 2019
 17.     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "
> New Haven-Milford , CT" & year == 2012
 18.     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "
> New York-Newark-Jersey City, NY-NJ-PA" & year == 1996
 19.     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "
> Bay Area, CA" & year == 1997 
 20.     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "
> Bay Area, CA" & year == 2015 
 21.     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "
> Boston-Cambridge-Newton, MA-NH" & year == 1997 
 22.     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "
> Boston-Cambridge-Newton, MA-NH" & year == 2012 
 23.     tw scatter msa_size econ_msa_size, mcolor(gs7%50) msize(vsmall) xlabel
> (#10, labsize(vsmall)) ylab(#10, labsize(vsmall)) || ///
>        scatter msa_size econ_msa_size if !mi(msa_lab) , mcolor(ebblue) msize(
> vsmall)  mlabel(msa_lab) mlabcolor(black) mlabsize(tiny) || ///
>        (function y = _b[econ_msa_size]*x + _b[_cons], range(0 1250) lpattern(
> dash) lcolor(lavender)), ytitle("Fundamental Science Cluster Size", size(vsma
> ll)) xtitle("Economics Research Cluster Size", size(vsmall))  legend(on order
>  (- "N (MSAs) = `N'" ///
>                                                                              
>                                                                              
>                     "Correlation = `slope'") pos(5) ring(0) region(fcolor(non
> e)) size(vsmall) lwidth(none))
 24.     
.     use if !mi(msa_comb) & inrange(year, 1945, 2023) using ../external/samp/a
> thr_panel_full_comb_`samp', clear 
 25.     merge m:1 msa_comb year using  ../temp/econ_yr_cluster, assert(1 2 3) 
> keep(1 3) nogen
 26. /*    corr msa_size econ_msa_size 
>     local slope : dis %3.2f r(rho) 
>     binscatter2 msa_size econ_msa_size, mcolor(gs5) lcolor(ebblue) xlab(, lab
> size(vsmall)) ylab(, labsize(vsmall)) ytitle("Fundamental Science Research Cl
> uster Size", size(vsmall)) xtitle("Economics Research Cluster Size", size(vsm
> all)) legend(on order(- "Correlation = `slope'") pos(5) ring(0) lwidth(none) 
> size(vsmall) region(fcolor(none)))
>     graph export ../output/figures/econ_v_ls.pdf, replace*/
.     local reg_eq "ln_y ln_x"
 27.     local mat_est "_b[ln_x] \ _se[ln_x]"
 28. *    local reg_eq = cond("`samp'"=="year","ln_y ln_x avg_team_size","ln_y 
> ln_x") 
. *    local mat_est  = cond("`samp'"=="year","_b[ln_x] \ _se[ln_x] \ _b[avg_te
> am_size] \ _se[ln_x]", "_b[ln_x] \ _se[ln_x]") 
.     bys athr_id msa_comb ${time} : gen count = _n == 1
 29.     replace msa_size = 0.0000000000001 if msa_size == 0
 30.     replace econ_msa_size = 0.0000000000001 if econ_msa_size == 0
 31.     gegen msa = group(msa_comb)
 32.     rename inst inst_name
 33.     gegen inst = group(inst_id)
 34.     gegen msa_field = group(msa field)
 35.     gegen year_field = group(year field)
 36.     gen ln_y = ln(impact_cite_affl_wt)
 37.     gen ln_x = ln(msa_size)
 38.     gen ln_x_econ = ln(econ_msa_size)
 39.     preserve
 40.     keep if inrange(year, 2015, 2023)
 41.     keep if inlist(msa_comb, "Ann Arbor, MI", "San Diego-Carlsbad, CA", "B
> oston-Cambridge-Newton, MA-NH", "Bay Area, CA", "Gainesville, FL")
 42.     foreach m in "Gainesville, FL" "Ann Arbor, MI" "San Diego-Carlsbad, CA
> " "Bay Area, CA" "Boston-Cambridge-Newton, MA-NH" {
 43.         sum impact_cite_affl_wt if msa_comb == "`m'", d
 44.         mat row = (r(min) , r(p5) , r(p10), r(p25), r(p50) , r(p75), r(p90
> ) , r(p95), r(max), r(mean) , r(sd))
 45.         sum msa_size if msa_comb == "`m'" 
 46.         mat row = row , r(mean)
 47.         mat city_stats_`samp' = nullmat(city_stats_`samp') \ (row)
 48.     }
 49.     restore
 50.     reghdfe `reg_eq', noabsorb
 51.     local slope = _b[ln_x]
 52.     if "`samp'" == "year" {
 53.         binscatter2  ln_y ln_x ,controls(avg_team_size) ytitle("Log Output
> ") xtitle("Log Cluster Size") legend(on order(- "Slope = `slope'") pos(5) rin
> g(0) lwidth(none))
 54.         *graph export ../output/figures/bs_`samp'.pdf, replace
.     }
 55.     if "`samp'" == "year_firstlast" {
 56.         binscatter2  ln_y ln_x , ytitle("Log Output") xtitle("Log Cluster 
> Size") legend(on order(- "Slope = `slope'") pos(5) ring(0) lwidth(none))
 57.         *graph export ../output/figures/bs_`samp'.pdf, replace
.     }
 58.     foreach fe in "${time} msa field" "${time} msa field field#${time}" "$
> {time} msa field field#${time} msa#field" "${time} msa field field#${time} ms
> a#field inst" "${time} msa field field#${time} msa#field inst athr_id" {
 59.         reghdfe `reg_eq', absorb(`fe') vce(cluster msa)
 60.         mat coef_`samp' = nullmat(coef_`samp'), (`mat_est' \ . \ . \e(N))
 61.         if "`fe'" == "${time} msa field field#${time} msa#field inst athr_
> id" {
 62.             global final_elasticity = _b[ln_x]
 63.         }
 64.         local slope : dis %3.2f _b[ln_x]
 65.         if "`samp'" == "year" {
 66.             binscatter2  ln_y ln_x ,controls(avg_team_size) absorb(year ms
> a field year_field msa_field athr_id) ytitle("Log Output") xtitle("Log Cluste
> r Size") legend(on order(- "Slope = `slope'") pos(5) ring(0) lwidth(none))
 67.             *graph export ../output/figures/final_bs_`samp'.pdf, replace
.         }
 68.         if "`samp'" == "year_firstlast" {
 69.             binscatter2  ln_y ln_x , absorb(year msa field year_field msa_
> field athr_id) ytitle("Log Output") xtitle("Log Cluster Size") legend(on orde
> r(- "Slope = `slope'") pos(5) ring(0) lwidth(none))
 70.             *graph export ../output/figures/final_bs_`samp'.pdf, replace
.         }
 71.     }
 72.     reghdfe ln_y ln_x_econ, absorb(${time} msa field field#${time} field#m
> sa inst athr_id) vce(cluster msa)
 73.     mat econ_`samp' = nullmat(econ_`samp'), (. \ . \ _b[ln_x_econ] \ _se[l
> n_x_econ] \ e(N))
 74.     mat coef_`samp' = nullmat(coef_`samp') , econ_`samp'
 75.     reghdfe `reg_eq', absorb(year msa athr_id field inst) vce(cluster msa)
 76.     mat field_`samp' = nullmat(field_`samp'), (`mat_est' \ e(N))
 77.     reghdfe `reg_eq', absorb(year msa athr_id gen_mesh1 gen_mesh2 inst) vc
> e(cluster msa)
 78.     mat field_`samp' = nullmat(field_`samp'), (`mat_est' \ e(N))
 79. *    mat alt_spec_`samp' = instyr_`samp' , field_`samp'
. /*    reghdfe `reg_eq', absorb(year msa athr_id qualifier_name1 qualifier_nam
> e2 inst) vce(cluster msa)
>     mat field_`samp' = nullmat(field_`samp'), (`mat_est' \ e(N))
>     reghdfe `reg_eq', absorb(year msa athr_id term1 term2 inst) vce(cluster m
> sa)
>     mat field_`samp' = nullmat(field_`samp'), (`mat_est' \ e(N))*/
. end

. 
. program firm_externalities
  1.     syntax, samp(str)
  2.     // create clusters 
.     use if !mi(msa_comb) & !mi(inst_id) using ${year_insts}/filled_in_panel_y
> ear, clear
  3.     bys inst_id msa_comb year athr_id: gen count = _n == 1
  4.     bys inst_id msa_comb year : egen inst_athrs = total(count) 
  5.     drop count 
  6.     bys msa_comb year athr_id: gen count = _n == 1
  7.     bys msa_comb year : egen msa_size = total(count) 
  8.     drop count
  9.     bys inst_id msa_comb year: gen count = _n == 1
 10.     bys msa_comb year: gegen num_insts = total(count)
 11.     contract msa_comb inst_id inst year inst_athrs msa_size
 12.     bys msa_comb year: egen sum_insts = total(inst_athrs)
 13.     assert sum_insts == msa_size
 14.     drop sum_insts _freq
 15.     save ../temp/inst_cluster_size, replace
 16. 
.     use if !mi(msa_comb) & inrange(year, 1945, 2023) using ../external/samp/a
> thr_panel_full_comb_`samp', clear 
 17.     drop msa_size
 18.     merge m:1 inst_id msa_comb year  using ../temp/inst_cluster_size , ass
> ert(2 3) keep(3) nogen
 19.     contract inst_id inst msa_comb year msa_size inst_athrs 
 20.     gisid inst_id msa_comb year
 21.     drop _freq
 22.     gen wo_inst_cluster = msa_size - inst_athrs
 23.     gen ln_wo_inst = ln(wo_inst_cluster)
 24.     gen ln_cluster_diff = ln(msa_size) - ln_wo_inst 
 25.     gen firm_elasticity = ln_cluster_diff * ${final_elasticity}
 26.     drop if mi(firm_elasticity)
 27.     bys msa_comb year: gen num_insts = _N
 28.     drop if num_insts == 1 
 29.     // pick a year and report some top ones . t = 2018
.     preserve
 30.     keep if year == 2018
 31.     gsort -inst_athrs
 32.     li msa_comb inst inst_athrs msa_size firm_elasticity in 1/10
 33.     mkmat firm_elasticity in 1/10, mat(inst_elasticities_`samp')
 34.     sum firm_elasticity
 35.     restore
 36.     bys msa_comb year: egen tot_firm_elasticity = total(firm_elasticity)
 37.     gen perc = firm_elasticity/tot_firm_elasticity*100
 38.     bys msa_comb year: egen tot = sum(perc)
 39.     assert round(tot) == 100
 40.     drop tot
 41.     keep if inlist(msa_comb, "Boston-Cambridge-Newton, MA-NH", "Bay Area, 
> CA", "Washington-Arlington-Alexandria, DC-VA-MD-WV", "Baltimore-Columbia-Tows
> on, MD")
 42.     glevelsof msa_comb, local(city)
 43.     hashsort msa_comb year -perc
 44.     gen group = 1 if msa_comb == "Baltimore-Columbia-Towson, MD" & inst ==
>  "Johns Hopkins University"
 45.     replace group = 2 if msa_comb == "Baltimore-Columbia-Towson, MD" & ins
> t == "University of Maryland, Baltimore"
 46.     replace group = 3 if msa_comb == "Baltimore-Columbia-Towson, MD" & mi(
> group)
 47.     replace group = 1 if msa_comb == "Boston-Cambridge-Newton, MA-NH" & in
> st == "Harvard University"
 48.     replace group = 2 if msa_comb == "Boston-Cambridge-Newton, MA-NH" & in
> st == "Mass General Brigham"
 49.     replace group = 3 if msa_comb == "Boston-Cambridge-Newton, MA-NH" & in
> st == "Massachusetts Institute of Technology"
 50.     replace group = 4 if msa_comb == "Boston-Cambridge-Newton, MA-NH" & mi
> (group)
 51.     replace group = 1 if msa_comb == "Bay Area, CA" & inst == "Stanford Un
> iversity"
 52.     replace group = 2 if msa_comb == "Bay Area, CA" & inst == "University 
> of California, San Francisco"
 53.     replace group = 3 if msa_comb == "Bay Area, CA" & inst == "University 
> of California, Berkeley"
 54.     replace group = 4 if msa_comb == "Bay Area, CA" & mi(group)
 55.     replace group = 1 if msa_comb == "Washington-Arlington-Alexandria, DC-
> VA-MD-WV" & inst == "National Institutes of Health"
 56.     replace group = 2 if msa_comb == "Washington-Arlington-Alexandria, DC-
> VA-MD-WV" & inst == "National Aeronautics and Space Administration"
 57.     replace group = 3 if msa_comb == "Washington-Arlington-Alexandria, DC-
> VA-MD-WV" & mi(group)
 58.     replace inst = "UCSF" if inst == "University of California, San Franci
> sco"
 59.     replace inst = "UC Berkeley" if inst == "University of California, Ber
> keley"
 60.     replace inst = "MIT" if inst == "Massachusetts Institute of Technology
> "
 61.     foreach c in `city' {
 62.         if "`c'" == "Boston-Cambridge-Newton, MA-NH" local suf "bos"
 63.         if "`c'" == "Bay Area, CA" local suf "bay"
 64.         if "`c'" == "Washington-Arlington-Alexandria, DC-VA-MD-WV" local s
> uf "dc"
 65.         if "`c'" == "Baltimore-Columbia-Towson, MD" local suf "balt"
 66.         preserve
 67.         keep if msa_comb == "`c'"
 68.         collapse (sum) perc (firstnm) inst inst_id, by(msa_comb year group
> )
 69.         hashsort msa_comb year -group
 70.         bys year: gen stack_perc = sum(perc)
 71.         local stacklines
 72.         qui xtset group year
 73.         sum group
 74.         local max_grp = r(max)
 75.         qui levelsof group, local(rank_grps)
 76.         local items = `r(r)'
 77.         foreach x of local rank_grps {
 78.             colorpalette carto Teal, intensify(0.85)  n(`items') nograph
 79.             local stacklines `stacklines' area stack_perc year if group ==
>  `x', fcolor("`r(p`x')'") lcolor(white) lwidth(*0.3) ||
 80.         }
 81.         gen labely = . 
 82.         gen rev_group = -group
 83.         if `max_grp' == 4 {
 84.              qui bys year (rev_group): replace labely = perc/2 if group ==
>  4
 85.              qui bys year (rev_group): replace labely = perc/2 + perc[_n-1
> ] if group == 3
 86.              qui bys year (rev_group): replace labely = perc/2 + perc[_n-1
> ] + perc[_n-2] if group == 2
 87.              qui bys year (rev_group): replace labely = perc/2 + perc[_n-1
> ] + perc[_n-2] + perc[_n-3] if group == 1
 88.         }
 89.         if `max_grp' == 3 {
 90.              qui bys year (rev_group): replace labely = perc/2 if group ==
>  3
 91.              qui bys year (rev_group): replace labely = perc/2 + perc[_n-1
> ] if group == 2
 92.              qui bys year (rev_group): replace labely = perc/2 + perc[_n-1
> ] + perc[_n-2] if group == 1
 93.         }
 94.         gen labely_lab = "Everywhere else" if group == `max_grp'
 95.         replace labely_lab = inst if mi(labely_lab)
 96.         local w = 27
 97.         graph tw `stacklines' (scatter labely year if year == 2023, ms(smc
> ircle) ///
>           msize(0.2) mcolor(black%40) mlabsize(vsmall) mlabcolor(black) mlabe
> l(labely_lab)), ///
>           ytitle("Relative Output Spillover Effect in Cluster", size(vsmall))
>  xtitle("Year", size(vsmall)) xlabel(1945(2)2023, angle(45) labsize(vsmall)) 
> ylabel(0(10)100, labsize(vsmall)) ///
>           graphregion(margin(r+27)) plotregion(margin(zero)) ///
>           legend(off)
 98.         qui graph export ../output/figures/elasticity_trend_`suf'.pdf , re
> place
 99.         restore
100.     }
101.     hashsort inst_id year
102.     tw line firm_elasticity year if inst == "Harvard University", xlab(194
> 5(5)2023, angle(45) labsize(vsmall)) ylab(0.04(0.02)0.16, labsize(vsmall)) xt
> itle("Year", size(vsmall)) ytitle("Harvard University Output Externality", si
> ze(vsmall))
103.     graph export ../output/figures/harvard_elasticity_trend.pdf, replace 
104.     tw line firm_elasticity year if inst == "Massachusetts Institute of Te
> chnology", xlab(1945(5)2023, angle(45) labsize(vsmall)) ylab(0.01(0.01)0.05, 
> labsize(vsmall)) xtitle("Year", size(vsmall)) ytitle("MIT Output Externality"
> , size(vsmall))
105.     graph export ../output/figures/mit_elasticity_trend.pdf, replace 
106.     tw line firm_elasticity year if inst == "Mass General Brigham", xlab(1
> 945(5)2023, angle(45) labsize(vsmall)) ylab(0.01(0.01)0.05, labsize(vsmall)) 
> xtitle("Year", size(vsmall)) ytitle("MGH Output Externality", size(vsmall))
107.     graph export ../output/figures/mgh_elasticity_trend.pdf, replace 
108.     
.     hashsort inst_id year
109.     tw line firm_elasticity year if inst == "Stanford University", xlab(19
> 45(5)2023, angle(45) labsize(vsmall)) ylab(0.04(0.01)0.08, labsize(vsmall)) x
> title("Year", size(vsmall)) ytitle("Stanford University Output Externality", 
> size(vsmall))
110.     graph export ../output/figures/stanford_elasticity_trend.pdf, replace 
111. 
.     hashsort inst_id year
112.     tw line firm_elasticity year if inst == "National Institutes of Health
> ", xlab(1945(5)2023, angle(45) labsize(vsmall)) ylab(0.02(0.02)0.12, labsize(
> vsmall)) xtitle("Year", size(vsmall)) ytitle("NIH Output Externality", size(v
> small))
113.     graph export ../output/figures/nih_elasticity_trend.pdf, replace 
114. 
.     hashsort inst_id year
115.     tw line firm_elasticity year if inst == "Johns Hopkins University", xl
> ab(1945(5)2023, angle(45) labsize(vsmall)) ylab(0.20(0.02)0.30, labsize(vsmal
> l)) xtitle("Year", size(vsmall)) ytitle("Johns Hopkins University Output Exte
> rnality", size(vsmall))
116.     graph export ../output/figures/jhu_elasticity_trend.pdf, replace 
117. 
.     hashsort inst_id year
118.     tw line firm_elasticity year if inst == "University of Michigan–Ann Ar
> bor", xlab(1945(5)2023, angle(45) labsize(vsmall)) ylab(0.50(0.05)0.80, labsi
> ze(vsmall)) xtitle("Year", size(vsmall)) ytitle("University of Michigan-Ann A
> rbor Output Externality", size(vsmall))
119.     graph export ../output/figures/umich_elasticity_trend.pdf, replace 
120. end

. 
. program output_tables
  1.     syntax, samp(str) 
  2.     foreach file in top_10clus top_30clus { //coef field city_stats inst_e
> lasticities econ_coef { 
  3.          qui matrix_to_txt, saving("../output/tables/`file'_`samp'.txt") m
> atrix(`file'_`samp') ///
>            title(<tab:`file'_`samp'>) format(%20.4f) replace
  4.     }
  5. end

. ** 
. main
(496,069 observations deleted)
(0 observations deleted)
(3,433 missing values generated)
variable lab was str1 now str18
(1 real change made)
variable lab was str18 now str37
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
variable lab was str37 now str39
(1 real change made)
(1 real change made)
(1 real change made)
file ../output/figures/inst_pat_output_scatter_year_second.pdf saved as PDF
    format
(file ../temp/econs_cluster.dta not found)
file ../temp/econs_cluster.dta saved
  644,701
N = 644,701; 310,649 unbalanced groups of sizes 1 to 55
(13 missing values generated)
(490,605 missing values generated)
(496,069 observations deleted)

     +-----------------------------------------------------------------------+
     |                                       msa_comb    msa_size   cluste~r |
     |-----------------------------------------------------------------------|
  1. |          New York-Newark-Jersey City, NY-NJ-PA   24036.897   .0216312 |
  2. |                 Boston-Cambridge-Newton, MA-NH   23098.565   .0208089 |
  3. |   Washington-Arlington-Alexandria, DC-VA-MD-WV   20365.984   .0182967 |
  4. |                                   Bay Area, CA   17205.768   .0155573 |
  5. |             Los Angeles-Long Beach-Anaheim, CA   10701.596   .0096315 |
     |-----------------------------------------------------------------------|
  6. |    Philadelphia-Camden-Wilmington, PA-NJ-DE-MD    9094.591   .0081879 |
  7. |             Chicago-Naperville-Elgin, IL-IN-WI     8517.64    .007657 |
  8. |                     Research Triangle Park, NC   7741.3603   .0069783 |
  9. |           Houston-The Woodlands-Sugar Land, TX    7697.717   .0069047 |
 10. |                         San Diego-Carlsbad, CA   7522.6288   .0067599 |
     |-----------------------------------------------------------------------|
 11. |                  Baltimore-Columbia-Towson, MD   7330.9625    .006576 |
 12. |                    Seattle-Tacoma-Bellevue, WA   6722.1279   .0060876 |
 13. |              Atlanta-Sandy Springs-Roswell, GA   5987.3644   .0053866 |
 14. |                                  Ann Arbor, MI   4263.2402   .0038486 |
 15. |                                 Pittsburgh, PA   3887.6381    .003491 |
     |-----------------------------------------------------------------------|
 16. |                               St. Louis, MO-IL   3884.6211   .0035114 |
 17. |                          New Haven-Milford, CT   3763.8731   .0034164 |
 18. |                                    Madison, WI   3277.0929   .0029382 |
 19. |        Minneapolis-St. Paul-Bloomington, MN-WI   3192.1925   .0028693 |
 20. |                                     Ithaca, NY   3168.6609   .0028614 |
     |-----------------------------------------------------------------------|
 21. |                Dallas-Fort Worth-Arlington, TX   2996.3544   .0027049 |
 22. |        Sacramento--Roseville--Arden-Arcade, CA   2927.3606   .0026322 |
 23. |                           Cleveland-Elyria, OH   2904.3407   .0025967 |
 24. | Nashville-Davidson--Murfreesboro--Franklin, TN   2814.6991   .0025316 |
 25. |                                Gainesville, FL   2580.6167   .0023209 |
     |-----------------------------------------------------------------------|
 26. |                     Denver-Aurora-Lakewood, CO    2501.098   .0022629 |
 27. |                                   Columbus, OH   2371.2224   .0021443 |
 28. |      Miami-Fort Lauderdale-West Palm Beach, FL   2253.1002   .0020386 |
 29. |                           Cincinnati, OH-KY-IN   2180.6833   .0019539 |
 30. |                    Phoenix-Mesa-Scottsdale, AZ    2010.023   .0018104 |
     +-----------------------------------------------------------------------+
(496,069 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            89
        from master                        89  
        from using                          0  

    Matched                               202  
    -----------------------------------------
(169 missing values generated)
(291 missing values generated)
variable msa_lab was str1 now str22
(1 real change made)
(1 real change made)
(1 real change made)
variable msa_lab was str22 now str27
(1 real change made)
variable msa_lab was str27 now str39
(1 real change made)
variable msa_lab was str39 now str44
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(0 real changes made)
(89 missing values generated)
(2 real changes made)
(6 real changes made)
(obs=202)

             | msa_size econ_m~e
-------------+------------------
    msa_size |   1.0000
econ_msa_s~e |   0.9367   1.0000


      Source |       SS           df       MS      Number of obs   =       202
-------------+----------------------------------   F(1, 200)       =   1430.91
       Model |  1.9687e+09         1  1.9687e+09   Prob > F        =    0.0000
    Residual |   275170069       200  1375850.35   R-squared       =    0.8774
-------------+----------------------------------   Adj R-squared   =    0.8768
       Total |  2.2439e+09       201  11163589.6   Root MSE        =      1173

------------------------------------------------------------------------------
    msa_size | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
econ_msa_s~e |   33.26753    .879458    37.83   0.000     31.53333    35.00173
       _cons |   243.6134    88.0024     2.77   0.006     70.08183     417.145
------------------------------------------------------------------------------
file ../output/figures/econ_v_ls_year_second.pdf saved as PDF format
(9 real changes made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(5 real changes made)
(6 real changes made)
file ../output/figures/pat_prod_scatter_year_second.pdf saved as PDF format
file ../output/figures/pat_cnt_prod_scatter_year_second.pdf saved as PDF
    format
  (importing .shp file)
  (importing .dbf file)
  (creating _ID spatial-unit id)
  (creating _CX coordinate)
  (creating _CY coordinate)

  file usa_state_shp.dta created
  file usa_state.dta     created

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           296,043  (_merge==3)
    -----------------------------------------
STATEFP: all characters numeric; replaced as byte
(9,030 observations deleted)
(344 observations deleted)
(116,302 real changes made)
(116,302 real changes made)
(310 observations deleted)
(2,373 real changes made)
(2,373 real changes made)
(166,263 real changes made)
(166,263 real changes made)
file usa_state_shp_clean.dta saved
  (importing .shp file)
  (importing .dbf file)
  (creating _ID spatial-unit id)
  (creating _CX coordinate)
  (creating _CY coordinate)

  file usa_msa_shp.dta created
  file usa_msa.dta     created

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           408,279  
    -----------------------------------------
CBSAFP: all characters numeric; replaced as long
(5,831 observations deleted)
(0 observations deleted)
(7,520 real changes made)
(7,520 real changes made)
(310 observations deleted)
(2,373 real changes made)
(2,373 real changes made)
file usa_msa_shp_clean.dta saved
(variable msatitle was str46, now str50 to accommodate using data's values)
(variable city was str35, now str42 to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                         7,062
        from master                     7,062  
        from using                          0  

    Matched                           637,639  
    -----------------------------------------
(59,826 real changes made)
(0 real changes made)
(55 real changes made)
(file ../temp/map_samp.dta not found)
file ../temp/map_samp.dta saved

    Result                      Number of obs
    -----------------------------------------
    Not matched                           620
        from master                       620  
        from using                          0  

    Matched                               325  
    -----------------------------------------
file ../output/figures/impact_cite_affl_wt_map_year_second.pdf saved as PDF
    format
(0 observations deleted)
(13 missing values generated)
(490,605 missing values generated)
(file ../temp/econ_yr_cluster.dta not found)
file ../temp/econ_yr_cluster.dta saved

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             4,716  
    -----------------------------------------
(obs=4,716)

             | msa_size econ_m~e
-------------+------------------
    msa_size |   1.0000
econ_msa_s~e |   0.9214   1.0000


      Source |       SS           df       MS      Number of obs   =     4,716
-------------+----------------------------------   F(1, 4714)      =  26489.45
       Model |  4.5052e+10         1  4.5052e+10   Prob > F        =    0.0000
    Residual |  8.0174e+09     4,714  1700760.81   R-squared       =    0.8489
-------------+----------------------------------   Adj R-squared   =    0.8489
       Total |  5.3070e+10     4,715  11255482.1   Root MSE        =    1304.1

------------------------------------------------------------------------------
    msa_size | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
econ_msa_s~e |   21.87274   .1343899   162.76   0.000     21.60927    22.13621
       _cons |   138.5968   21.70749     6.38   0.000     96.03998    181.1536
------------------------------------------------------------------------------
(4,716 missing values generated)
variable msa_lab was str1 now str27
(1 real change made)
(0 real changes made)
(1 real change made)
(0 real changes made)
variable msa_lab was str27 now str42
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        82,169
        from master                    82,169  
        from using                          0  

    Matched                           562,532  
    -----------------------------------------
(13 real changes made)
(18 real changes made)
(82,169 missing values generated)
(496,069 observations deleted)
(117,215 observations deleted)

                  (sum) impact_cite_affl_wt
-------------------------------------------------------------
      Percentiles      Smallest
 1%     .0005438       .0001813
 5%     .0008899       .0004079
10%     .0013596       .0004079       Obs               1,461
25%     .0024472       .0004079       Sum of wgt.       1,461

50%     .0046614                      Mean           .1300291
                        Largest       Std. dev.      .9320944
75%     .0102709       10.43335
90%     .0631028       10.43335       Variance          .8688
95%     .3365006       16.54907       Skewness       13.29968
99%     1.975391       17.74074       Kurtosis       205.6043

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
    msa_size |      1,461    2580.617    170.3165       2146       2721

                  (sum) impact_cite_affl_wt
-------------------------------------------------------------
      Percentiles      Smallest
 1%     .0004661       .0001813
 5%     .0008899       .0001813
10%     .0016315       .0001813       Obs               2,223
25%     .0029911       .0003263       Sum of wgt.       2,223

50%     .0068885                      Mean           .5325795
                        Largest       Std. dev.      2.438588
75%     .0892453       28.86176
90%     1.023769       32.47921       Variance        5.94671
95%     2.224927       35.48068       Skewness       9.855561
99%     10.52044       48.17633       Kurtosis       131.8597

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
    msa_size |      2,223     4263.24     339.497       3407       4538

                  (sum) impact_cite_affl_wt
-------------------------------------------------------------
      Percentiles      Smallest
 1%     .0005438       .0001483
 5%     .0013773       .0001483
10%     .0021753       .0001483       Obs               4,410
25%     .0045076       .0002479       Sum of wgt.       4,410

50%     .0313308                      Mean           1.056371
                        Largest       Std. dev.      3.280749
75%     .8509254       47.84555
90%     2.481481       48.11256       Variance       10.76331
95%     4.637267       71.02438       Skewness       9.342563
99%     14.50818       71.02438       Kurtosis       139.0677

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
    msa_size |      4,410    7522.629    675.5555       5727       8047

                  (sum) impact_cite_affl_wt
-------------------------------------------------------------
      Percentiles      Smallest
 1%     .0005438       .0001483
 5%     .0011865       .0002175
10%     .0020394       .0002175       Obs              10,131
25%     .0048945       .0002331       Sum of wgt.      10,131

50%     .2670956                      Mean           1.582719
                        Largest       Std. dev.      6.016652
75%     1.330872       182.6955
90%     3.790583       182.6955       Variance        36.2001
95%     6.746601       182.6955       Skewness       20.80952
99%     17.09252        266.751       Kurtosis       668.9092

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
    msa_size |     10,131    17205.77    900.0444      14629      17920

                  (sum) impact_cite_affl_wt
-------------------------------------------------------------
      Percentiles      Smallest
 1%     .0005438       .0001483
 5%     .0012236       .0001483
10%     .0019578       .0001631       Obs              13,192
25%     .0047132       .0001813       Sum of wgt.      13,192

50%     .2100904                      Mean             1.5276
                        Largest       Std. dev.      4.369236
75%     1.381655       82.43987
90%     3.821083       100.9765       Variance       19.09022
95%     6.803393       100.9818       Skewness       10.75707
99%     17.93187       138.9332       Kurtosis       201.4555

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
    msa_size |     13,192    23098.56    1601.004      18513      24011
(MWFE estimator converged in 1 iterations)

HDFE Linear regression                            Number of obs   =    644,701
Absorbing 1 HDFE group                            F(   1, 644699) =   26023.27
                                                  Prob > F        =     0.0000
                                                  R-squared       =     0.0388
                                                  Adj R-squared   =     0.0388
                                                  Within R-sq.    =     0.0388
                                                  Root MSE        =     2.3366

------------------------------------------------------------------------------
        ln_y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .3413281   .0021159   161.32   0.000     .3371811    .3454752
       _cons |  -6.400538    .017648  -362.68   0.000    -6.435128   -6.365949
------------------------------------------------------------------------------
(dropped 26 singleton observations)
(MWFE estimator converged in 7 iterations)

HDFE Linear regression                            Number of obs   =    644,675
Absorbing 3 HDFE groups                           F(   1,    296) =       2.67
Statistics robust to heteroskedasticity           Prob > F        =     0.1033
                                                  R-squared       =     0.1398
                                                  Adj R-squared   =     0.1393
                                                  Within R-sq.    =     0.0002
Number of clusters (msa)     =        297         Root MSE        =     2.2110

                                  (Std. err. adjusted for 297 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .1887104   .1154759     1.63   0.103    -.0385475    .4159683
       _cons |  -5.145014   .9500035    -5.42   0.000    -7.014631   -3.275397
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |        79           1          78     |
         msa |       297         297           0    *|
       field |        15           1          14     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 33 singleton observations)
(MWFE estimator converged in 6 iterations)

HDFE Linear regression                            Number of obs   =    644,668
Absorbing 4 HDFE groups                           F(   1,    296) =       3.80
Statistics robust to heteroskedasticity           Prob > F        =     0.0522
                                                  R-squared       =     0.2281
                                                  Adj R-squared   =     0.2263
                                                  Within R-sq.    =     0.0003
Number of clusters (msa)     =        297         Root MSE        =     2.0963

                                  (Std. err. adjusted for 297 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .2202654   .1130142     1.95   0.052    -.0021478    .4426785
       _cons |  -5.404614   .9297534    -5.81   0.000    -7.234379    -3.57485
------------------------------------------------------------------------------

Absorbed degrees of freedom:
------------------------------------------------------+
  Absorbed FE | Categories  - Redundant  = Num. Coefs |
--------------+---------------------------------------|
         year |        79           1          78     |
          msa |       297         297           0    *|
        field |        15           1          14     |
   field#year |      1156          79        1077    ?|
------------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 465 singleton observations)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =    644,236
Absorbing 5 HDFE groups                           F(   1,    274) =       4.22
Statistics robust to heteroskedasticity           Prob > F        =     0.0410
                                                  R-squared       =     0.2396
                                                  Adj R-squared   =     0.2348
                                                  Within R-sq.    =     0.0004
Number of clusters (msa)     =        275         Root MSE        =     2.0848

                                  (Std. err. adjusted for 275 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .2985433   .1454003     2.05   0.041     .0122996     .584787
       _cons |  -6.049236   1.196715    -5.05   0.000    -8.405161   -3.693311
------------------------------------------------------------------------------

Absorbed degrees of freedom:
------------------------------------------------------+
  Absorbed FE | Categories  - Redundant  = Num. Coefs |
--------------+---------------------------------------|
         year |        79           1          78     |
          msa |       275         275           0    *|
        field |        15           1          14     |
   field#year |      1156          79        1077    ?|
    msa#field |      2620        2620           0    *|
------------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 2132 singleton observations)
(MWFE estimator converged in 54 iterations)

HDFE Linear regression                            Number of obs   =    642,569
Absorbing 6 HDFE groups                           F(   1,    273) =       3.47
Statistics robust to heteroskedasticity           Prob > F        =     0.0636
                                                  R-squared       =     0.2791
                                                  Adj R-squared   =     0.2706
                                                  Within R-sq.    =     0.0003
Number of clusters (msa)     =        274         Root MSE        =     2.0356

                                  (Std. err. adjusted for 274 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .2854598    .153266     1.86   0.064    -.0162737    .5871933
       _cons |  -5.940019     1.2616    -4.71   0.000     -8.42372   -3.456318
------------------------------------------------------------------------------

Absorbed degrees of freedom:
------------------------------------------------------+
  Absorbed FE | Categories  - Redundant  = Num. Coefs |
--------------+---------------------------------------|
         year |        79           1          78     |
          msa |       274         274           0    *|
        field |        15           1          14     |
   field#year |      1156          79        1077    ?|
    msa#field |      2586        2586           0    *|
         inst |      3446           1        3445    ?|
------------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 200725 singleton observations)
(MWFE estimator converged in 109 iterations)

HDFE Linear regression                            Number of obs   =    443,976
Absorbing 7 HDFE groups                           F(   1,    233) =       4.48
Statistics robust to heteroskedasticity           Prob > F        =     0.0354
                                                  R-squared       =     0.6248
                                                  Adj R-squared   =     0.4907
                                                  Within R-sq.    =     0.0001
Number of clusters (msa)     =        234         Root MSE        =     1.7064

                                  (Std. err. adjusted for 234 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .1958675   .0925602     2.12   0.035     .0135055    .3782294
       _cons |  -5.042183   .7651811    -6.59   0.000    -6.549741   -3.534625
------------------------------------------------------------------------------

Absorbed degrees of freedom:
------------------------------------------------------+
  Absorbed FE | Categories  - Redundant  = Num. Coefs |
--------------+---------------------------------------|
         year |        79           1          78     |
          msa |       234         234           0    *|
        field |        15           1          14     |
   field#year |      1144          79        1065    ?|
    msa#field |      2259        2259           0    *|
         inst |      2326           1        2325    ?|
      athr_id |    111213         280      110933    ?|
------------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 179109 singleton observations)
(MWFE estimator converged in 107 iterations)

HDFE Linear regression                            Number of obs   =    383,423
Absorbing 7 HDFE groups                           F(   1,    126) =       2.43
Statistics robust to heteroskedasticity           Prob > F        =     0.1217
                                                  R-squared       =     0.6236
                                                  Adj R-squared   =     0.4882
                                                  Within R-sq.    =     0.0000
Number of clusters (msa)     =        127         Root MSE        =     1.7257

                                  (Std. err. adjusted for 127 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
   ln_x_econ |   .0609359   .0391072     1.56   0.122    -.0164561    .1383279
       _cons |  -3.631291   .2028084   -17.91   0.000    -4.032643   -3.229939
------------------------------------------------------------------------------

Absorbed degrees of freedom:
------------------------------------------------------+
  Absorbed FE | Categories  - Redundant  = Num. Coefs |
--------------+---------------------------------------|
         year |        77           1          76     |
          msa |       127         127           0    *|
        field |        15           1          14     |
   field#year |      1117          77        1040    ?|
    field#msa |      1542        1542           0    *|
         inst |      1913           1        1912    ?|
      athr_id |     96980         216       96764    ?|
------------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 200229 singleton observations)
(MWFE estimator converged in 110 iterations)

HDFE Linear regression                            Number of obs   =    444,472
Absorbing 5 HDFE groups                           F(   1,    252) =       3.10
Statistics robust to heteroskedasticity           Prob > F        =     0.0794
                                                  R-squared       =     0.6040
                                                  Adj R-squared   =     0.4677
                                                  Within R-sq.    =     0.0001
Number of clusters (msa)     =        253         Root MSE        =     1.7444

                                  (Std. err. adjusted for 253 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .1525368   .0865914     1.76   0.079    -.0179982    .3230719
       _cons |  -4.684094     .71545    -6.55   0.000    -6.093117   -3.275071
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |        79           1          78     |
         msa |       253         253           0    *|
     athr_id |    111355           1      111354     |
       field |        15           1          14    ?|
        inst |      2375         279        2096    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 146820 singleton observations)
(MWFE estimator converged in 152 iterations)

HDFE Linear regression                            Number of obs   =    350,851
Absorbing 6 HDFE groups                           F(   1,    236) =       1.49
Statistics robust to heteroskedasticity           Prob > F        =     0.2233
                                                  R-squared       =     0.6492
                                                  Adj R-squared   =     0.4935
                                                  Within R-sq.    =     0.0000
Number of clusters (msa)     =        237         Root MSE        =     1.7384

                                  (Std. err. adjusted for 237 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .1341495   .1098717     1.22   0.223    -.0823051     .350604
       _cons |  -4.269167   .9226881    -4.63   0.000    -6.086924    -2.45141
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |        79           1          78     |
         msa |       237         237           0    *|
     athr_id |     88133           1       88132     |
   gen_mesh1 |      8419          95        8324    ?|
   gen_mesh2 |      9491         184        9307    ?|
        inst |      2063         253        1810    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. 
end of do-file

--------------------------------------------------------------------------------
Makelog ended: 2025-08-12 19:52:35
Working directory: /export/projects4/achandra_basicscience/analysis/science_geo/cluster_descriptives/code
--------------------------------------------------------------------------------
