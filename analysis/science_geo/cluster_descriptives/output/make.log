--------------------------------------------------------------------------------
Makelog started: 2024-01-01 23:19:49
Working directory: /export/home/dor/cxu/innovation_projs/analysis/science_geo/cluster_descriptives/code
--------------------------------------------------------------------------------
External links successfully created!

  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      17.0
___/   /   /___/   /   /___/       MP—Parallel Edition

 Statistics and Data Science       Copyright 1985-2021 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-STATA-PC        https://www.stata.com
                                   979-696-4600        stata@stata.com

Stata license: Unlimited-user 4-core network, expiring 17 Nov 2024
Serial number: 501809301897
  Licensed to: Harvard Business School
               Research Computing

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. More than 2 billion observations are allowed; see help obs_advice.
      4. Maximum number of variables is set to 120,000; see help set_maxvar.

. do "/export/home/dor/cxu/innovation_projs/analysis/science_geo/cluster_descri
> ptives/code/analysis.do" 

. set more off 

. clear all

. capture log close

. program drop _all

. set scheme modern

. graph set window fontface "Arial Narrow"
not available in non-GUI version

. pause on

. set seed 8975

. global cite_affl_wt_name "Productivity"

. global impact_cite_affl_wt_name "Productivity"

. global body_adj_wt_name "Paper-to-Patent Citations"

. global ln_y_name "Log Productivity"

. global ln_pat_name "Log Paper-to-Patent Citations"

. global msa_size_name "Cluster Size"

. global ln_x_name "Log Cluster Size"

. global time year

. 
. program main
  1.     foreach s in year_firstlast {
  2.         sample_desc, samp(`s')
  3.         maps, samp(`s')
  4.         raw_bs, samp(`s')
  5.         regression, samp(`s')
  6.         output_tables, samp(`s')
  7.     }
  8. end

. 
. program sample_desc
  1.     syntax, samp(str) 
  2.     use if !mi(msa_comb) & inrange(year, 1945,2022) using ../external/samp
> /athr_panel_full_comb_`samp', clear 
  3.     count
  4.     gunique athr_id
  5.     gen ln_y = ln(impact_cite_affl_wt)
  6.     gen ln_x = ln(msa_size)
  7.     gen ln_pat = ln(body_adj_wt)
  8.     foreach var in impact_cite_affl_wt msa_size ln_y ln_x body_adj_wt ln_p
> at {
  9.         qui sum `var', d
 10.         local N = r(N)
 11.         local mean : dis %3.2f r(mean)
 12.         local sd : dis %3.2f r(sd)
 13.         local p5 :  dis %3.2f r(p5)
 14.         local p25 :  dis %3.2f r(p25)
 15.         local p50 :  dis %3.2f r(p50)
 16.         local p75 :  dis %3.2f r(p75)
 17.         local p95 :  dis %3.2f r(p95)
 18.         tw hist `var', frac ytitle("Share of author-years", size(vsmall)) 
> xtitle("${`var'_name}", size(vsmall)) color(edkblue) xlab(, labsize(vsmall)) 
> ylab(, labsize(vsmall)) legend(on order(- "N = `N'" ///
>                                                                 "Mean = `mean
> '" ///
>                                                                 "            
> (`sd')" ///
>                                                                 "p5 = `p5'" /
> //
>                                                                 "p25 = `p25'"
>  ///
>                                                                 "p50 = `p50'"
>  ///
>                                                                 "p75 = `p75'"
>  ///
>                                                                 "p95 = `p95'"
> ) pos(1) ring(0) size(vsmall) region(fcolor(none)))
 19.         *graph export ../output/figures/`var'_dist`samp'.pdf, replace
.     }
 20.     preserve
 21.     keep if inrange(year, 2015,2022)
 22.     gcollapse (mean) msa_size cluster_shr, by(msa_comb)
 23.     gsort -msa_size
 24.     mkmat msa_size in 1/30, mat(top_30clus_`samp')
 25.     li in 1/30
 26.     mkmat msa_size in 1/10, mat(top_10clus_`samp')
 27.     restore
 28.     preserve
 29.     gen has_patent_cite = pat_wt > 0
 30.     bys athr_id msa_comb: gen athr_cnt = _n == 1
 31.     gcollapse  (sum) athr_cnt body_adj_wt cite_affl_wt pat_wt affl_wt impa
> ct_cite_affl_wt impact_affl_wt (mean) msa_size has_patent_cite, by(msa_comb)
 32. 
.     qui reg body_adj_wt impact_cite_affl_wt 
 33.     local coef : dis %3.2f _b[impact_cite_affl_wt]
 34.     local N = e(N)
 35.     binscatter2 body_adj_wt impact_cite_affl_wt , xtitle("Productivity", s
> ize(vsmall)) ytitle("Paper-to-Patent Citations", size(vsmall)) lcolor(ebblue)
>  mcolor(gs3) xlab(, labsize(vsmall)) ylab(, labsize(vsmall)) legend(on order(
> - "N (MSAs) = `N'" ///
>                                                                              
>                                          "Slope = `coef'") pos(5) ring(0) reg
> ion(fcolor(none)) size(vsmall))
 36.     *graph export ../output/figures/msa_pat_prod_`samp'.pdf, replace
.     gen ln_pat = ln(body_adj_wt)
 37.     gen ln_y = ln(impact_cite_affl_wt)
 38.     qui reg ln_pat ln_y 
 39.     local coef : dis %3.2f _b[ln_y]
 40.     local N = e(N)
 41.     binscatter2 ln_pat ln_y , xtitle("Log Productivity", size(vsmall)) yti
> tle("Log Paper-to-Patent Citations", size(vsmall)) lcolor(ebblue) mcolor(gs3)
>   xlab(, labsize(vsmall)) ylab(, labsize(vsmall)) legend(on order(- "N (MSAs)
>  = `N'" ///
>                                                                              
>                                          "Slope = `coef'") pos(5) ring(0) reg
> ion(fcolor(none)) size(vsmall))
 42.     *graph export ../output/figures/msa_log_pat_prod_`samp'.pdf, replace
.     
.     xtile p  = msa_size, nq(20)
 43.     gen msa_lab = "" 
 44.     replace msa_lab =  msa_comb  if msa_comb == "Great Falls, MT" 
 45.     replace msa_lab =  msa_comb  if msa_comb == "San Diego-Carlsbad, CA" 
 46.     replace msa_lab =  msa_comb  if msa_comb == "Trenton, NJ" 
 47.     replace msa_lab =  msa_comb  if msa_comb == "New Haven-Milford , CT" 
 48.     replace msa_lab =  msa_comb  if msa_comb == "New York-Newark-Jersey Ci
> ty, NY-NJ-PA" 
 49.     replace msa_lab =  msa_comb  if msa_comb == "Bay Area, CA" 
 50.     replace msa_lab =  msa_comb  if msa_comb == "Boston-Cambridge-Newton, 
> MA-NH" 
 51. 
. /*    replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "G
> reat Falls, MT" & year == 2015
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "San
>  Diego-Carlsbad, CA" & year == 1973
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "San
>  Diego-Carlsbad, CA" & year == 19
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Tre
> nton, NJ" & year == 2019
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "New
>  Haven-Milford , CT" & year == 2012
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "New
>  York-Newark-Jersey City, NY-NJ-PA" & year == 1996
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bay
>  Area, CA" & year == 1997 
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bay
>  Area, CA" & year == 2015 
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bos
> ton-Cambridge-Newton, MA-NH" & year == 1997 
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bos
> ton-Cambridge-Newton, MA-NH" & year == 2012 */
.     tw scatter impact_cite_affl_wt msa_size , mcolor(gs7%50) msize(vsmall) xl
> abel(#10, labsize(vsmall)) ylab(#10, labsize(vsmall)) || scatter impact_cite_
> affl_wt msa_size if !mi(msa_lab) , mcolor(ebblue) msize(vsmall)  mlabel(msa_l
> ab) mlabcolor(black) mlabsize(tiny) xtitle("MSA Cluster Size", size(vsmall)) 
> ytitle("MSA Productivity", size(vsmall))  jitter(5) legend(off)
 52.    *graph export ../output/figures/cluster_prod_scatter_`samp'.pdf, replac
> e
.    
.    xtile p_prod = impact_cite_affl_wt, nq(20)
 53.    replace msa_lab = ""
 54.    replace msa_lab =  msa_comb if msa_comb == "San Diego-Carlsbad, CA" 
 55.    replace msa_lab =  msa_comb if msa_comb == "Bay Area, CA" 
 56.    replace msa_lab =  msa_comb if msa_comb == "St. Louis, MO-IL" 
 57.    replace msa_lab =  msa_comb if msa_comb == "Minneapolis-St. Paul-Bloomi
> ngton, MN-WI" 
 58.    replace msa_lab =  msa_comb if msa_comb == "Washington-Arlington-Alexan
> dria, DC-VA-MD-WV" 
 59.    replace msa_lab =  msa_comb if msa_comb == "Los Angeles-Long Beach-Anah
> eim, CA" 
 60.    replace msa_lab =  msa_comb if msa_comb == "Boston-Cambridge-Newton, MA
> -NH" 
 61.    replace msa_lab =  msa_comb if msa_comb == "New York-Newark-Jersey City
> , NY-NJ-PA" 
 62.    egen clock = mlabvpos(impact_cite_affl_wt body_adj_wt)
 63.    replace clock = 9 if inlist(msa_lab , "New York-Newark-Jersey City, NY-
> NJ-PA","Boston-Cambridge-Newton, MA-NH")
 64.    replace clock = 3 if inlist(msa_lab , "Minneapolis-St. Paul-Bloomington
> , MN-WI", "Washington-Arlington-Alexandria, DC-VA-MD-WV", "San Diego-Carlsbad
> , CA", "St. Louis, MO-IL", "Bay Area, CA")
 65.    /*replace msa_lab =  msa_comb + " " + string(${time})  if msa_comb == "
> Flint, MI" & year == 2006
>    replace msa_lab =  msa_comb + " " + string(${time})  if msa_comb == "Linco
> ln, NE" & year == 2005 
>    replace msa_lab =  msa_comb + " " + string(${time})  if msa_comb == "Worce
> ster, MA-CT" & year == 2000
>    replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "San 
> Diego-Carlsbad, CA" & year == 1989 
>    replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bay 
> Area, CA" & year == 1997 
>    replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bay 
> Area, CA" & year == 2015 
>    replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bost
> on-Cambridge-Newton, MA-NH" & year == 2015 
>    replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bost
> on-Cambridge-Newton, MA-NH" & year == 2000 */
.    qui reg body_adj_wt impact_cite_affl_wt 
 66.    local coef : dis %3.2f _b[impact_cite_affl_wt]
 67.    local cons : dis %3.2f _b[_cons]
 68.    local N = e(N)
 69.    tw scatter body_adj_wt impact_cite_affl_wt , mcolor(gs13%50) msize(vsma
> ll) xlabel(0(5000)60000, labsize(vsmall)) ylab(0(5000)60000, labsize(vsmall))
>  || ///
>       scatter body_adj_wt impact_cite_affl_wt if !mi(msa_lab) , mlabvp(clock)
>  mcolor(ebblue) msize(vsmall)  mlabel(msa_lab) mlabcolor(black) mlabsize(tiny
> ) || ///
>       (function y=_b[impact_cite_affl_wt]*x+_b[_cons] , range(0 60000) lpatte
> rn(dash) lcolor(lavender)), xtitle("MSA Productivity", size(vsmall)) ytitle("
> MSA Paper-to-Patent Citations", size(vsmall)) legend(on order(- "N (MSAs) = `
> N'" ///
>                                                                              
>                                          "Slope = `coef'") pos(5) ring(0) reg
> ion(fcolor(none)) size(vsmall))
 70.    graph export ../output/figures/pat_prod_scatter_`samp'.pdf, replace
 71.    /*hashsort p -cite_affl_wt 
>    by p: egen mean_msa = mean(msa_size)
>    by p: egen mean_cite = mean(cite_affl_wt)
>    hashsort p -cite_affl_wt  
>    gduplicates drop p mean_msa mean_cite, force
>    drop msa_lab
>    gen msa_lab = msa_comb + " " + string(${time})  + "p"+string(p)
>    qui reg mean_cite mean_msa
>    local coef : dis %3.2f _b[mean_msa]
>    tw scatter mean_cite mean_msa, mcolor(ebblue) msize(vsmall) xlabel(#10, la
> bsize(vsmall)) ylab(#10, labsize(vsmall))  mlabel(msa_lab) mlabcolor(black) m
> labsize(tiny) xtitle("MSA Size in Year", size(vsmall)) ytitle("Average Effect
> ive Output", size(vsmall)) legend(on order(- "Slope = `coef'") pos(5) ring(0)
>  size(vsmall))
>    *graph export ../output/figures/binscatter_`samp'.pdf, replace
>    restore*/
.     
. /*    preserve
>     keep if inrange(year , 2015,2022)
>     gcollapse (mean) msa_size cluster_shr, by(msa_comb)
>     gsort - msa_size
>     mkmat msa_size in 1/30, mat(top_30clus_`samp')
>     li in 1/30
>     mkmat msa_size in 1/10, mat(top_10clus_`samp')
>     restore*/
. /*    gcollapse (mean) msa_size_field field_cluster_shr, by(msa_comb field)
>     forval i = 0/4 {
>         preserve
>         keep if field ==`i'
>         gsort -msa_size_field
>         li in 1/10
>         restore
>     }*/
. 
. end

. 
. program  maps
  1.     syntax, samp(str) 
  2.     spshape2dta ../external/geo/cb_2018_us_state_500k.shp, replace saving(
> usa_state)
  3.     use usa_state_shp, clear
  4.     merge m:1 _ID using usa_state
  5.     destring STATEFP, replace
  6.     drop if STATEFP > 56
  7.     // alaska
.     drop if _X > 0 & !mi(_X) & STATEFP == 2  
  8.     geo2xy _Y _X if STATEFP ==2, proj(mercator) replace
  9.     replace _Y = _Y / 5 +1200000 if STATEFP == 2 
 10.     replace _X = _X / 5 - 2000000  if STATEFP == 2 
 11.     drop if _X < -160 & !mi(_X) & _ID == 43  // small islands to the west
 12.     geo2xy _Y _X if _ID == 43, proj(mercator) replace
 13.     replace _Y = _Y  + 800000 if _ID == 43
 14.     replace _X = _X  - 1200000 if _ID == 43
 15.     geo2xy _Y _X if !inlist(_ID, 28,43), replace proj(mercator)
 16.     replace _X = _X + 53500 if !inlist(_ID, 28,43)
 17.     replace _Y = _Y - 3100 if !inlist(_ID, 28,43)
 18.     drop _CX- _merge
 19.     sort _ID shape_order
 20.     save usa_state_shp_clean.dta, replace
 21.     
.     spshape2dta ../external/geo/cb_2018_us_cbsa_500k.shp, replace saving(usa_
> msa)
 22.     use usa_msa_shp, clear
 23.     merge m:1 _ID using usa_msa, nogen
 24.     destring CBSAFP, replace
 25.     gen state = strtrim(substr(NAME, strpos(NAME, ",")+1, 3))
 26.     drop if inlist(state, "PR")
 27.     // alaska
.     drop if _X > 0 & !mi(_X) & state == "AK" 
 28.     geo2xy _Y _X if state == "AK" , proj(mercator) replace
 29.    replace _Y = _Y / 5 + 1200000 if state == "AK"
 30.     replace _X = _X / 5 - 1705000 if state == "AK" 
 31.     drop if _X < -160 & !mi(_X) & state == "HI"  // small islands to the w
> est
 32.     geo2xy _Y _X if state == "HI", proj(mercator) replace
 33.     replace _Y = _Y + 800000 if state == "HI" 
 34.     replace _X = _X  - 1200000 if state == "HI" 
 35.     geo2xy _Y _X if !inlist(state, "AK", "HI"), replace proj(mercator)
 36.     sort _ID shape_order
 37.     save usa_msa_shp_clean.dta, replace
 38. 
.     use if !mi(msa_comb) & inrange(year, 1945, 2022) using ../external/samp/a
> thr_panel_full_`samp', clear
 39. *    bys msa_comb: egen mode = mode(msacode)
. *    replace msacode = mode
.     merge m:1 msacode using ../external/geo/msas, assert(1 2 3) keep(1 3) nog
> en
 40.     replace msa_comb = msatitle if !mi(msatitle)
 41.     replace msa_comb = "San Francisco-Oakland-Hayward, CA" if msa_comb == 
> "San Francisco-Oakland-Haywerd, CA"
 42.     replace msa_comb = "Macon-Bibb County, GA" if msa_comb == "Macon, GA"
 43.     bys athr_id msa_comb ${time} : gen count = _n == 1
 44.     gcollapse (sum) affl_wt impact_cite_affl_wt body_adj_wt (mean) msa_siz
> e , by(msa_comb)
 45.     save ../temp/map_samp, replace
 46.     
.     use usa_msa, clear
 47.     rename NAME msa_comb
 48.     merge 1:m msa_comb using ../temp/map_samp, assert(1 2 3) keep(1 3) nog
> en
 49.     foreach var in impact_cite_affl_wt {
 50.         xtile `var'_5 = `var', nq(5)
 51.         qui sum `var' 
 52.         local min : dis %3.2f r(min)
 53.         local max : dis %3.2f r(max)
 54.         _pctile `var',percentiles(20 40 60 80)
 55.         local p20: dis %3.2f r(r1)
 56.         local p40: dis %3.2f r(r2)
 57.         local p60: dis %3.2f r(r3)
 58.         local p80: dis %3.2f r(r4)
 59.         colorpalette carto Teal, n(5) nograph 
 60.         spmap  `var'_5 using usa_msa_shp_clean,  id(_ID)  fcolor(`r(p)'%50
> ) clnumber(5) ///
>           ocolor(white ..) osize(0.15 ..) ndfcolor(gs13) ndocolor(white ..) n
> dsize(0.15 ..) ndlabel("No data") ///
>           polygon(data("usa_state_shp_clean") ocolor(gs2) osize(0.2) fcolor(e
> ggshell%20)) ///
>           legend(label(2 "Min-p20: `min'-`p20'") label(3 "p20-p40: `p20'-`p40
> '") label(4 "p40-p60: `p40'-`p60'") label(5 "p60-p80: `p60'-`p80'") label(6 "
> p80-Max: `p80'-`max'") pos(4) size(2)) legtitle("${`var'_name}")
 61.         graph export ../output/figures/`var'_map_`samp'.pdf, replace
 62.     }
 63. end

. 
. program raw_bs
  1.     syntax, samp(str) 
  2.     use if !mi(msa_comb) & inrange(year, 1945, 2022) using ../external/sam
> p/athr_panel_full_comb_`samp', clear
  3.     drop if mi(msa_comb) 
  4.     gegen msa = group(msa_comb)
  5.     gen ln_y = ln(impact_cite_affl_wt)
  6.     gen ln_x = ln(msa_size)
  7.     gen ln_pat = ln(body_adj_wt)
  8. 
.     // patented vs productivity
.     qui reg body_adj_wt impact_cite_affl_wt 
  9.     local coef : dis %3.2f _b[impact_cite_affl_wt]
 10.     local N = e(N)
 11.     binscatter2 body_adj_wt impact_cite_affl_wt, xtitle("Productivity", si
> ze(vsmall)) ytitle("Paper-to-Patent Citations", size(vsmall)) xlab(, labsize(
> vsmall)) ylab(, labsize(vsmall)) mcolor(gs5) lcolor(ebblue) legend(on order(-
>  "N (Author-years) = `N'" ///
>                                                                              
>                                          "Slope = `coef'") pos(5) ring(0) reg
> ion(fcolor(none)) size(vsmall))
 12.     *graph export ../output/figures/pat_prod_`samp'.pdf, replace
.     qui reg ln_pat ln_y 
 13.     local coef : dis %3.2f _b[ln_y]
 14.     local N = e(N)
 15.     binscatter2 ln_pat ln_y , xtitle("Log Productivity", size(vsmall)) yti
> tle("Log Paper-to-Patent Citations", size(vsmall)) xlab(, labsize(vsmall)) yl
> ab(, labsize(vsmall)) mcolor(gs5) lcolor(ebblue) legend(on order(- "N (Author
> -years) = `N'" ///
>                                                                              
>                                          "Slope = `coef'") pos(5) ring(0) reg
> ion(fcolor(none)) size(vsmall))
 16.     *graph export ../output/figures/log_pat_prod_`samp'.pdf, replace
. end

. 
. 
. program regression 
  1.     syntax, samp(str) 
  2.     use if !mi(msa_comb) & inrange(year, 1945, 2022) using ../external/sam
> p/athr_panel_full_comb_`samp', clear 
  3.     local reg_eq = cond("`samp'"=="year","ln_y ln_x avg_team_size","ln_y l
> n_x") 
  4.     local mat_est  = cond("`samp'"=="year","_b[ln_x] \ _se[ln_x] \ _b[avg_
> team_size] \ _se[ln_x]", "_b[ln_x] \ _se[ln_x]") 
  5.     bys athr_id msa_comb ${time} : gen count = _n == 1
  6.     replace msa_size = 0.0000000000001 if msa_size == 0
  7.     gegen msa = group(msa_comb)
  8.     rename inst inst_name
  9.     gegen inst = group(inst_name)
 10.     gegen msa_field = group(msa field)
 11.     gegen year_field = group(year field)
 12.     gen ln_y = ln(impact_cite_affl_wt)
 13.     gen ln_x = ln(msa_size)
 14.     gen ln_x_cluster = ln(cluster_shr)
 15.     preserve
 16.     keep if inrange(year, 2015, 2022)
 17.     keep if inlist(msa_comb, "Ann Arbor, MI", "San Diego-Carlsbad, CA", "B
> oston-Cambridge-Newton, MA-NH", "Bay Area, CA", "Gainesville, FL")
 18.     foreach m in "Gainesville, FL" "Ann Arbor, MI" "San Diego-Carlsbad, CA
> " "Bay Area, CA" "Boston-Cambridge-Newton, MA-NH" {
 19.         sum impact_cite_affl_wt if msa_comb == "`m'", d
 20.         mat row = (r(min) , r(p5) , r(p10), r(p25), r(p50) , r(p75), r(p90
> ) , r(p95), r(max), r(mean) , r(sd))
 21.         sum msa_size if msa_comb == "`m'" 
 22.         mat row = row , r(mean)
 23.         mat city_stats_`samp' = nullmat(city_stats_`samp') \ (row)
 24.     }
 25.     restore
 26.     reghdfe `reg_eq', noabsorb
 27.     local slope = _b[ln_x]
 28.     if "`samp'" == "year" {
 29.         binscatter2  ln_y ln_x ,controls(avg_team_size) ytitle("Log Output
> ") xtitle("Log Cluster Size") legend(on order(- "Slope = `slope'") pos(5) rin
> g(0) lwidth(none))
 30.         *graph export ../output/figures/bs_`samp'.pdf, replace
.     }
 31.     if "`samp'" == "year_firstlast" {
 32.         binscatter2  ln_y ln_x , ytitle("Log Output") xtitle("Log Cluster 
> Size") legend(on order(- "Slope = `slope'") pos(5) ring(0) lwidth(none))
 33.         *graph export ../output/figures/bs_`samp'.pdf, replace
.     }
 34.     foreach fe in "${time} msa field" "${time} msa field field#${time}" "$
> {time} msa field field#${time} msa#field" "${time} msa field field#${time} ms
> a#field inst" "${time} msa field field#${time} msa#field inst athr_id" {
 35.         reghdfe `reg_eq', absorb(`fe') vce(cluster msa)
 36.         mat coef_`samp' = nullmat(coef_`samp'), (`mat_est' \ e(N))
 37.         local slope : dis %3.2f _b[ln_x]
 38.         if "`samp'" == "year" {
 39.             binscatter2  ln_y ln_x ,controls(avg_team_size) absorb(year ms
> a field year_field msa_field athr_id) ytitle("Log Output") xtitle("Log Cluste
> r Size") legend(on order(- "Slope = `slope'") pos(5) ring(0) lwidth(none))
 40.             *graph export ../output/figures/final_bs_`samp'.pdf, replace
.         }
 41.         if "`samp'" == "year_firstlast" {
 42.             binscatter2  ln_y ln_x , absorb(year msa field year_field msa_
> field athr_id) ytitle("Log Output") xtitle("Log Cluster Size") legend(on orde
> r(- "Slope = `slope'") pos(5) ring(0) lwidth(none))
 43.             *graph export ../output/figures/final_bs_`samp'.pdf, replace
.         }
 44.     }
 45.     reghdfe `reg_eq', absorb(${time} field field#${time} field#msa inst#ye
> ar inst athr_id) vce(cluster msa)
 46.     mat instyr_`samp' = nullmat(instyr_`samp'), (`mat_est' \ e(N))
 47.     mat coef_`samp' = nullmat(coef_`samp') , instyr_`samp'
 48.     reghdfe `reg_eq', absorb(year msa athr_id field inst) vce(cluster msa)
 49.     mat field_`samp' = nullmat(field_`samp'), (`mat_est' \ e(N))
 50.     reghdfe `reg_eq', absorb(year msa athr_id gen_mesh1 gen_mesh2 inst) vc
> e(cluster msa)
 51.     mat field_`samp' = nullmat(field_`samp'), (`mat_est' \ e(N))
 52.     mat alt_spec_`samp' = instyr_`samp' , field_`samp'
 53. /*    reghdfe `reg_eq', absorb(year msa athr_id qualifier_name1 qualifier_
> name2 inst) vce(cluster msa)
>     mat field_`samp' = nullmat(field_`samp'), (`mat_est' \ e(N))
>     reghdfe `reg_eq', absorb(year msa athr_id term1 term2 inst) vce(cluster m
> sa)
>     mat field_`samp' = nullmat(field_`samp'), (`mat_est' \ e(N))*/
.         
. end

. 
. program output_tables
  1.     syntax, samp(str) 
  2.     foreach file in top_10clus top_30clus coef field city_stats { 
  3.          qui matrix_to_txt, saving("../output/tables/`file'_`samp'.txt") m
> atrix(`file'_`samp') ///
>            title(<tab:`file'_`samp'>) format(%20.4f) replace
  4.     }
  5. 
. end

. ** 
. main
  363,730
N = 363,730; 183,645 unbalanced groups of sizes 1 to 48
(2,258 missing values generated)
(6 missing values generated)
(278,868 missing values generated)
(291,478 observations deleted)

     +----------------------------------------------------------------------+
     |                                       msa_comb   msa_size   cluste~r |
     |----------------------------------------------------------------------|
  1. |          New York-Newark-Jersey City, NY-NJ-PA   21978.48   .0233014 |
  2. |                 Boston-Cambridge-Newton, MA-NH    20677.6   .0219426 |
  3. |   Washington-Arlington-Alexandria, DC-VA-MD-WV   18094.24   .0191277 |
  4. |                                   Bay Area, CA   15336.99   .0163301 |
  5. |             Los Angeles-Long Beach-Anaheim, CA   8999.559   .0095403 |
     |----------------------------------------------------------------------|
  6. |    Philadelphia-Camden-Wilmington, PA-NJ-DE-MD   8001.021   .0084934 |
  7. |             Chicago-Naperville-Elgin, IL-IN-WI   7282.532   .0077094 |
  8. |                         San Diego-Carlsbad, CA    6868.58   .0072539 |
  9. |                     Research Triangle Park, NC    6822.15   .0072228 |
 10. |           Houston-The Woodlands-Sugar Land, TX   6557.478   .0069142 |
     |----------------------------------------------------------------------|
 11. |                    Seattle-Tacoma-Bellevue, WA   6038.397   .0064376 |
 12. |                  Baltimore-Columbia-Towson, MD   5619.322   .0059394 |
 13. |              Atlanta-Sandy Springs-Roswell, GA   5147.438   .0054459 |
 14. |                                  Ann Arbor, MI   3672.315   .0039023 |
 15. |                                 Pittsburgh, PA   3461.118   .0036592 |
     |----------------------------------------------------------------------|
 16. |                               St. Louis, MO-IL   3350.698   .0035691 |
 17. |                          New Haven-Milford, CT   3255.014   .0034769 |
 18. |                                    Madison, WI   2869.178   .0030377 |
 19. |                                     Ithaca, NY   2785.237   .0029631 |
 20. |        Minneapolis-St. Paul-Bloomington, MN-WI   2733.615   .0028964 |
     |----------------------------------------------------------------------|
 21. |        Sacramento--Roseville--Arden-Arcade, CA   2642.459    .002796 |
 22. |                           Cleveland-Elyria, OH   2568.178   .0026996 |
 23. |                Dallas-Fort Worth-Arlington, TX   2535.026    .002699 |
 24. | Nashville-Davidson--Murfreesboro--Franklin, TN   2430.863   .0025687 |
 25. |                                   Columbus, OH   2355.738   .0025107 |
     |----------------------------------------------------------------------|
 26. |                                  Rochester, NY   2282.614   .0024178 |
 27. |                     Denver-Aurora-Lakewood, CO    2240.55   .0023823 |
 28. |                                Gainesville, FL   2169.792   .0022994 |
 29. |                           Cincinnati, OH-KY-IN   1916.382   .0020192 |
 30. |      Miami-Fort Lauderdale-West Palm Beach, FL   1908.986    .002018 |
     +----------------------------------------------------------------------+
(91 missing values generated)
(303 missing values generated)
variable msa_lab was str1 now str15
(1 real change made)
variable msa_lab was str15 now str22
(1 real change made)
(1 real change made)
(0 real changes made)
variable msa_lab was str22 now str37
(1 real change made)
(1 real change made)
(1 real change made)
(6 real changes made)
(1 real change made)
(1 real change made)
(1 real change made)
variable msa_lab was str37 now str39
(1 real change made)
variable msa_lab was str39 now str44
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(2 real changes made)
(5 real changes made)
file ../output/figures/pat_prod_scatter_year_firstlast.pdf saved as PDF
    format
  (importing .shp file)
  (importing .dbf file)
  (creating _ID spatial-unit id)
  (creating _CX coordinate)
  (creating _CY coordinate)

  file usa_state_shp.dta created
  file usa_state.dta     created

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           296,043  (_merge==3)
    -----------------------------------------
STATEFP: all characters numeric; replaced as byte
(9,030 observations deleted)
(344 observations deleted)
(116,302 real changes made)
(116,302 real changes made)
(310 observations deleted)
(2,373 real changes made)
(2,373 real changes made)
(166,263 real changes made)
(166,263 real changes made)
file usa_state_shp_clean.dta saved
  (importing .shp file)
  (importing .dbf file)
  (creating _ID spatial-unit id)
  (creating _CX coordinate)
  (creating _CY coordinate)

  file usa_msa_shp.dta created
  file usa_msa.dta     created

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           408,279  
    -----------------------------------------
CBSAFP: all characters numeric; replaced as long
(5,831 observations deleted)
(0 observations deleted)
(7,520 real changes made)
(7,520 real changes made)
(310 observations deleted)
(2,373 real changes made)
(2,373 real changes made)
file usa_msa_shp_clean.dta saved
(variable msatitle was str46, now str50 to accommodate using data's values)
(variable city was str35, now str42 to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                         5,235
        from master                     5,235  
        from using                          0  

    Matched                           358,495  
    -----------------------------------------
(33,532 real changes made)
(0 real changes made)
(27 real changes made)
(file ../temp/map_samp.dta not found)
file ../temp/map_samp.dta saved

    Result                      Number of obs
    -----------------------------------------
    Not matched                           640
        from master                       640  
        from using                          0  

    Matched                               305  
    -----------------------------------------
file ../output/figures/impact_cite_affl_wt_map_year_firstlast.pdf saved as
    PDF format
(0 observations deleted)
(2,258 missing values generated)
(6 missing values generated)
(278,868 missing values generated)
(6 real changes made)
(2,258 missing values generated)
(6 missing values generated)
(291,478 observations deleted)
(57,032 observations deleted)

                  (sum) impact_cite_affl_wt
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%      .001096              0
10%      .002192              0       Obs                 672
25%     .0039821              0       Sum of wgt.         672

50%     .0082199                      Mean            .213139
                        Largest       Std. dev.      1.314297
75%     .0172162       4.807628
90%     .0834915       7.193299       Variance       1.727378
95%     .7348094       21.03561       Skewness       12.70962
99%      3.82883       21.25325       Kurtosis       194.3949

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
    msa_size |        672    2169.792    137.4307       1806       2275

                  (sum) impact_cite_affl_wt
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%      .001096              0
10%     .0023539              0       Obs                 987
25%     .0054799              0       Sum of wgt.         987

50%     .0139739                      Mean            1.06592
                        Largest       Std. dev.      4.532234
75%     .1669829       45.84874
90%     2.146388       48.21935       Variance       20.54114
95%     4.843875       53.38414       Skewness       8.053288
99%     20.23916       58.80437       Kurtosis       80.93846

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
    msa_size |        987    3672.315    273.1247       3002       3916

                  (sum) impact_cite_affl_wt
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%     .0018788              0
10%      .003699              0       Obs               2,161
25%     .0089245              0       Sum of wgt.       2,161

50%     .0695762                      Mean           2.067645
                        Largest       Std. dev.      6.324961
75%     1.743944       67.04995
90%     4.835607        67.3098       Variance       40.00513
95%      9.31208        67.3098       Skewness       9.370194
99%     32.63284         142.74       Kurtosis       146.0445

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
    msa_size |      2,161     6868.58    658.8234       5349       7459

                  (sum) impact_cite_affl_wt
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%      .002192              0
10%     .0037577              0       Obs               4,994
25%     .0098639              0       Sum of wgt.       4,994

50%     .4765732                      Mean           3.085885
                        Largest       Std. dev.      11.56488
75%     2.606517       198.9167
90%     7.505106       225.7791       Variance       133.7466
95%     13.02773       370.7301       Skewness       18.29525
99%     34.09951       370.7301       Kurtosis       487.1776

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
    msa_size |      4,994    15336.99    796.7044      13224      15964

                  (sum) impact_cite_affl_wt
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%     .0018788              0
10%     .0036533              0       Obs               6,406
25%     .0094158              0       Sum of wgt.       6,406

50%       .40294                      Mean           2.984596
                        Largest       Std. dev.      8.111266
75%     2.760162       130.6477
90%     7.304032       167.9927       Variance       65.79264
95%     13.53246       167.9927       Skewness       9.575953
99%     33.89071       200.9847       Kurtosis       157.8431

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
    msa_size |      6,406     20677.6    1462.379      16913      21724
(MWFE estimator converged in 1 iterations)

HDFE Linear regression                            Number of obs   =    361,472
Absorbing 1 HDFE group                            F(   1, 361470) =   20650.59
                                                  Prob > F        =     0.0000
                                                  R-squared       =     0.0540
                                                  Adj R-squared   =     0.0540
                                                  Within R-sq.    =     0.0540
                                                  Root MSE        =     2.2903

------------------------------------------------------------------------------
        ln_y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .3863788   .0026887   143.70   0.000      .381109    .3916486
       _cons |  -6.204955   .0218821  -283.56   0.000    -6.247843   -6.162066
------------------------------------------------------------------------------
(dropped 28 singleton observations)
(MWFE estimator converged in 7 iterations)

HDFE Linear regression                            Number of obs   =    361,444
Absorbing 3 HDFE groups                           F(   1,    274) =       3.54
Statistics robust to heteroskedasticity           Prob > F        =     0.0610
                                                  R-squared       =     0.1653
                                                  Adj R-squared   =     0.1644
                                                  Within R-sq.    =     0.0004
Number of clusters (msa)     =        275         Root MSE        =     2.1525

                                  (Std. err. adjusted for 275 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .2152399   .1144096     1.88   0.061    -.0099936    .4404735
       _cons |  -4.833411   .9169639    -5.27   0.000      -6.6386   -3.028221
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |        78           0          78     |
         msa |       275         275           0    *|
       field |         5           1           4     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 38 singleton observations)
(MWFE estimator converged in 5 iterations)

HDFE Linear regression                            Number of obs   =    361,434
Absorbing 4 HDFE groups                           F(   1,    274) =       3.91
Statistics robust to heteroskedasticity           Prob > F        =     0.0489
                                                  R-squared       =     0.2117
                                                  Adj R-squared   =     0.2103
                                                  Within R-sq.    =     0.0004
Number of clusters (msa)     =        275         Root MSE        =     2.0926

                                  (Std. err. adjusted for 275 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .2157716   .1090638     1.98   0.049      .001062    .4304811
       _cons |   -4.83766   .8741283    -5.53   0.000    -6.558521   -3.116799
------------------------------------------------------------------------------

Absorbed degrees of freedom:
------------------------------------------------------+
  Absorbed FE | Categories  - Redundant  = Num. Coefs |
--------------+---------------------------------------|
         year |        78           0          78     |
          msa |       275         275           0    *|
        field |         5           1           4     |
   field#year |       369          78         291    ?|
------------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 156 singleton observations)
(MWFE estimator converged in 6 iterations)

HDFE Linear regression                            Number of obs   =    361,316
Absorbing 5 HDFE groups                           F(   1,    267) =       3.72
Statistics robust to heteroskedasticity           Prob > F        =     0.0548
                                                  R-squared       =     0.2181
                                                  Adj R-squared   =     0.2146
                                                  Within R-sq.    =     0.0003
Number of clusters (msa)     =        268         Root MSE        =     2.0869

                                  (Std. err. adjusted for 268 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .2075945   .1076185     1.93   0.055    -.0042944    .4194834
       _cons |  -4.772187   .8627281    -5.53   0.000    -6.470803   -3.073571
------------------------------------------------------------------------------

Absorbed degrees of freedom:
------------------------------------------------------+
  Absorbed FE | Categories  - Redundant  = Num. Coefs |
--------------+---------------------------------------|
         year |        78           0          78     |
          msa |       268         268           0    *|
        field |         5           1           4     |
   field#year |       369          78         291    ?|
    msa#field |       975         975           0    *|
------------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 1545 singleton observations)
(MWFE estimator converged in 107 iterations)

HDFE Linear regression                            Number of obs   =    359,927
Absorbing 6 HDFE groups                           F(   1,    263) =       4.32
Statistics robust to heteroskedasticity           Prob > F        =     0.0386
                                                  R-squared       =     0.2669
                                                  Adj R-squared   =     0.2578
                                                  Within R-sq.    =     0.0004
Number of clusters (msa)     =        264         Root MSE        =     2.0289

                                  (Std. err. adjusted for 264 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .2914878   .1402327     2.08   0.039     .0153662    .5676094
       _cons |  -5.442326   1.124351    -4.84   0.000      -7.6562   -3.228452
------------------------------------------------------------------------------

Absorbed degrees of freedom:
------------------------------------------------------+
  Absorbed FE | Categories  - Redundant  = Num. Coefs |
--------------+---------------------------------------|
         year |        78           0          78     |
          msa |       264         264           0    *|
        field |         5           1           4     |
   field#year |       369          78         291    ?|
    msa#field |       961         961           0    *|
         inst |      2786           1        2785    ?|
------------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 123422 singleton observations)
(MWFE estimator converged in 136 iterations)

HDFE Linear regression                            Number of obs   =    238,050
Absorbing 7 HDFE groups                           F(   1,    223) =       7.74
Statistics robust to heteroskedasticity           Prob > F        =     0.0059
                                                  R-squared       =     0.6579
                                                  Adj R-squared   =     0.5353
                                                  Within R-sq.    =     0.0001
Number of clusters (msa)     =        224         Root MSE        =     1.6102

                                  (Std. err. adjusted for 224 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |    .191286   .0687608     2.78   0.006      .055782      .32679
       _cons |  -4.514923   .5529339    -8.17   0.000    -5.604567   -3.425279
------------------------------------------------------------------------------

Absorbed degrees of freedom:
------------------------------------------------------+
  Absorbed FE | Categories  - Redundant  = Num. Coefs |
--------------+---------------------------------------|
         year |        78           0          78     |
          msa |       224         224           0    *|
        field |         5           1           4     |
   field#year |       363          78         285    ?|
    msa#field |       841         841           0    *|
         inst |      1854           1        1853    ?|
      athr_id |     59751         230       59521    ?|
------------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 135759 singleton observations)
(MWFE estimator converged in 145 iterations)

HDFE Linear regression                            Number of obs   =    225,713
Absorbing 7 HDFE groups                           F(   1,    175) =       0.04
Statistics robust to heteroskedasticity           Prob > F        =     0.8467
                                                  R-squared       =     0.6907
                                                  Adj R-squared   =     0.5422
                                                  Within R-sq.    =     0.0000
Number of clusters (msa)     =        176         Root MSE        =     1.6030

                                  (Std. err. adjusted for 176 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .0757704    .391357     0.19   0.847    -.6966167    .8481575
       _cons |  -3.555573    3.16202    -1.12   0.262    -9.796176    2.685029
------------------------------------------------------------------------------

Absorbed degrees of freedom:
------------------------------------------------------+
  Absorbed FE | Categories  - Redundant  = Num. Coefs |
--------------+---------------------------------------|
         year |        78           0          78     |
        field |         5           1           4     |
   field#year |       359          78         281    ?|
    field#msa |       727         727           0    *|
    inst#year |     15849          79       15770    ?|
         inst |       998         998           0    ?|
      athr_id |     56444          75       56369    ?|
------------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 123248 singleton observations)
(MWFE estimator converged in 126 iterations)

HDFE Linear regression                            Number of obs   =    238,224
Absorbing 5 HDFE groups                           F(   1,    237) =       8.75
Statistics robust to heteroskedasticity           Prob > F        =     0.0034
                                                  R-squared       =     0.6469
                                                  Adj R-squared   =     0.5233
                                                  Within R-sq.    =     0.0002
Number of clusters (msa)     =        238         Root MSE        =     1.6308

                                  (Std. err. adjusted for 238 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .1979614   .0669096     2.96   0.003     .0661478     .329775
       _cons |  -4.568566   .5378716    -8.49   0.000    -5.628186   -3.508946
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |        78           0          78     |
         msa |       238         238           0    *|
     athr_id |     59806           1       59805     |
       field |         5           1           4    ?|
        inst |      1880         230        1650    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 82051 singleton observations)
(MWFE estimator converged in 146 iterations)

HDFE Linear regression                            Number of obs   =    154,981
Absorbing 6 HDFE groups                           F(   1,    211) =       3.99
Statistics robust to heteroskedasticity           Prob > F        =     0.0471
                                                  R-squared       =     0.6833
                                                  Adj R-squared   =     0.5194
                                                  Within R-sq.    =     0.0001
Number of clusters (msa)     =        212         Root MSE        =     1.7010

                                  (Std. err. adjusted for 212 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .2223122    .111337     2.00   0.047     .0028368    .4417877
       _cons |  -4.221531   .9171978    -4.60   0.000    -6.029576   -2.413486
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |        78           0          78     |
         msa |       212         212           0    *|
     athr_id |     38870           1       38869     |
   gen_mesh1 |      6023         183        5840    ?|
   gen_mesh2 |      6856         272        6584    ?|
        inst |      1488         214        1274    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. 
end of do-file

--------------------------------------------------------------------------------
Makelog ended: 2024-01-01 23:25:11
Working directory: /export/home/dor/cxu/innovation_projs/analysis/science_geo/cluster_descriptives/code
--------------------------------------------------------------------------------
