--------------------------------------------------------------------------------
Makelog started: 2023-12-20 23:52:22
Working directory: /export/home/dor/cxu/innovation_projs/analysis/science_geo/cluster_descriptives/code
--------------------------------------------------------------------------------
External links successfully created!

  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      17.0
___/   /   /___/   /   /___/       MP—Parallel Edition

 Statistics and Data Science       Copyright 1985-2021 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-STATA-PC        https://www.stata.com
                                   979-696-4600        stata@stata.com

Stata license: Unlimited-user 4-core network, expiring 17 Nov 2024
Serial number: 501809301897
  Licensed to: Harvard Business School
               Research Computing

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. More than 2 billion observations are allowed; see help obs_advice.
      4. Maximum number of variables is set to 120,000; see help set_maxvar.

. do "/export/home/dor/cxu/innovation_projs/analysis/science_geo/cluster_descri
> ptives/code/analysis.do" 

. set more off 

. clear all

. capture log close

. program drop _all

. set scheme modern

. graph set window fontface "Arial Narrow"
not available in non-GUI version

. pause on

. set seed 8975

. global cite_affl_wt_name "Productivity"

. global impact_cite_affl_wt_name "Productivity"

. global body_adj_wt_name "Paper-to-Patent Citations"

. global ln_y_name "Log Productivity"

. global ln_pat_name "Log Paper-to-Patent Citations"

. global msa_size_name "Cluster Size"

. global ln_x_name "Log Cluster Size"

. global time year

. 
. program main
  1.     foreach s in year_firstlast {
  2.         sample_desc, samp(`s')
  3.         maps, samp(`s')
  4.         raw_bs, samp(`s')
  5.         regression, samp(`s')
  6.         output_tables, samp(`s')
  7.     }
  8. end

. 
. program sample_desc
  1.     syntax, samp(str) 
  2.     use if !mi(msa_comb) & inrange(year, 1945,2022) using ../external/samp
> /athr_panel_full_comb_`samp', clear 
  3.     count
  4.     gunique athr_id
  5.     gen ln_y = ln(impact_cite_affl_wt)
  6.     gen ln_x = ln(msa_size)
  7.     gen ln_pat = ln(body_adj_wt)
  8.     foreach var in impact_cite_affl_wt msa_size ln_y ln_x body_adj_wt ln_p
> at {
  9.         qui sum `var', d
 10.         local N = r(N)
 11.         local mean : dis %3.2f r(mean)
 12.         local sd : dis %3.2f r(sd)
 13.         local p5 :  dis %3.2f r(p5)
 14.         local p25 :  dis %3.2f r(p25)
 15.         local p50 :  dis %3.2f r(p50)
 16.         local p75 :  dis %3.2f r(p75)
 17.         local p95 :  dis %3.2f r(p95)
 18.         tw hist `var', frac ytitle("Share of author-years", size(vsmall)) 
> xtitle("${`var'_name}", size(vsmall)) color(edkblue) xlab(, labsize(vsmall)) 
> ylab(, labsize(vsmall)) legend(on order(- "N = `N'" ///
>                                                                 "Mean = `mean
> '" ///
>                                                                 "            
> (`sd')" ///
>                                                                 "p5 = `p5'" /
> //
>                                                                 "p25 = `p25'"
>  ///
>                                                                 "p50 = `p50'"
>  ///
>                                                                 "p75 = `p75'"
>  ///
>                                                                 "p95 = `p95'"
> ) pos(1) ring(0) size(vsmall) region(fcolor(none)))
 19.         *graph export ../output/figures/`var'_dist`samp'.pdf, replace
.     }
 20.     preserve
 21.     keep if inrange(year, 2015,2022)
 22.     gcollapse (mean) msa_size cluster_shr, by(msa_comb)
 23.     gsort - msa_size
 24.     mkmat msa_size in 1/30, mat(top_30clus_`samp')
 25.     li in 1/30
 26.     mkmat msa_size in 1/10, mat(top_10clus_`samp')
 27.     restore
 28.     preserve
 29.     gen has_patent_cite = pat_wt > 0
 30.     bys athr_id msa_comb: gen athr_cnt = _n == 1
 31.     gcollapse  (sum) athr_cnt body_adj_wt cite_affl_wt pat_wt affl_wt impa
> ct_cite_affl_wt impact_affl_wt (mean) msa_size has_patent_cite, by(msa_comb)
 32.     qui reg body_adj_wt impact_cite_affl_wt 
 33.     local coef : dis %3.2f _b[impact_cite_affl_wt]
 34.     local N = e(N)
 35.     binscatter2 body_adj_wt impact_cite_affl_wt , xtitle("Productivity", s
> ize(vsmall)) ytitle("Paper-to-Patent Citations", size(vsmall)) lcolor(ebblue)
>  mcolor(gs3) xlab(, labsize(vsmall)) ylab(, labsize(vsmall)) legend(on order(
> - "N (MSAs) = `N'" ///
>                                                                              
>                                          "Slope = `coef'") pos(5) ring(0) reg
> ion(fcolor(none)) size(vsmall))
 36.     *graph export ../output/figures/msa_pat_prod_`samp'.pdf, replace
.     gen ln_pat = ln(body_adj_wt)
 37.     gen ln_y = ln(impact_cite_affl_wt)
 38.     qui reg ln_pat ln_y 
 39.     local coef : dis %3.2f _b[ln_y]
 40.     local N = e(N)
 41.     binscatter2 ln_pat ln_y , xtitle("Log Productivity", size(vsmall)) yti
> tle("Log Paper-to-Patent Citations", size(vsmall)) lcolor(ebblue) mcolor(gs3)
>   xlab(, labsize(vsmall)) ylab(, labsize(vsmall)) legend(on order(- "N (MSAs)
>  = `N'" ///
>                                                                              
>                                          "Slope = `coef'") pos(5) ring(0) reg
> ion(fcolor(none)) size(vsmall))
 42.     *graph export ../output/figures/msa_log_pat_prod_`samp'.pdf, replace
.     
.     xtile p  = msa_size, nq(20)
 43.     gen msa_lab = "" 
 44.     replace msa_lab =  msa_comb  if msa_comb == "Great Falls, MT" 
 45.     replace msa_lab =  msa_comb  if msa_comb == "San Diego-Carlsbad, CA" 
 46.     replace msa_lab =  msa_comb  if msa_comb == "Trenton, NJ" 
 47.     replace msa_lab =  msa_comb  if msa_comb == "New Haven-Milford , CT" 
 48.     replace msa_lab =  msa_comb  if msa_comb == "New York-Newark-Jersey Ci
> ty, NY-NJ-PA" 
 49.     replace msa_lab =  msa_comb  if msa_comb == "Bay Area, CA" 
 50.     replace msa_lab =  msa_comb  if msa_comb == "Boston-Cambridge-Newton, 
> MA-NH" 
 51. 
. /*    replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "G
> reat Falls, MT" & year == 2015
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "San
>  Diego-Carlsbad, CA" & year == 1973
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "San
>  Diego-Carlsbad, CA" & year == 19
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Tre
> nton, NJ" & year == 2019
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "New
>  Haven-Milford , CT" & year == 2012
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "New
>  York-Newark-Jersey City, NY-NJ-PA" & year == 1996
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bay
>  Area, CA" & year == 1997 
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bay
>  Area, CA" & year == 2015 
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bos
> ton-Cambridge-Newton, MA-NH" & year == 1997 
>     replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bos
> ton-Cambridge-Newton, MA-NH" & year == 2012 */
.     tw scatter impact_cite_affl_wt msa_size , mcolor(gs7%50) msize(vsmall) xl
> abel(#10, labsize(vsmall)) ylab(#10, labsize(vsmall)) || scatter impact_cite_
> affl_wt msa_size if !mi(msa_lab) , mcolor(ebblue) msize(vsmall)  mlabel(msa_l
> ab) mlabcolor(black) mlabsize(tiny) xtitle("MSA Cluster Size", size(vsmall)) 
> ytitle("MSA Productivity", size(vsmall))  jitter(5) legend(off)
 52.    *graph export ../output/figures/cluster_prod_scatter_`samp'.pdf, replac
> e
.    
.    xtile p_prod = impact_cite_affl_wt, nq(20)
 53.    replace msa_lab = ""
 54.    replace msa_lab =  msa_comb if msa_comb == "San Diego-Carlsbad, CA" 
 55.    replace msa_lab =  msa_comb if msa_comb == "Bay Area, CA" 
 56.    replace msa_lab =  msa_comb if msa_comb == "St. Louis, MO-IL" 
 57.    replace msa_lab =  msa_comb if msa_comb == "Minneapolis-St. Paul-Bloomi
> ngton, MN-WI" 
 58.    replace msa_lab =  msa_comb if msa_comb == "Washington-Arlington-Alexan
> dria, DC-VA-MD-WV" 
 59.    replace msa_lab =  msa_comb if msa_comb == "Los Angeles-Long Beach-Anah
> eim, CA" 
 60.    replace msa_lab =  msa_comb if msa_comb == "Boston-Cambridge-Newton, MA
> -NH" 
 61.    replace msa_lab =  msa_comb if msa_comb == "New York-Newark-Jersey City
> , NY-NJ-PA" 
 62.    egen clock = mlabvpos(impact_cite_affl_wt body_adj_wt)
 63.    replace clock = 9 if inlist(msa_lab , "New York-Newark-Jersey City, NY-
> NJ-PA","Boston-Cambridge-Newton, MA-NH")
 64.    replace clock = 3 if inlist(msa_lab , "Minneapolis-St. Paul-Bloomington
> , MN-WI", "Washington-Arlington-Alexandria, DC-VA-MD-WV", "San Diego-Carlsbad
> , CA", "St. Louis, MO-IL", "Bay Area, CA")
 65.    /*replace msa_lab =  msa_comb + " " + string(${time})  if msa_comb == "
> Flint, MI" & year == 2006
>    replace msa_lab =  msa_comb + " " + string(${time})  if msa_comb == "Linco
> ln, NE" & year == 2005 
>    replace msa_lab =  msa_comb + " " + string(${time})  if msa_comb == "Worce
> ster, MA-CT" & year == 2000
>    replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "San 
> Diego-Carlsbad, CA" & year == 1989 
>    replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bay 
> Area, CA" & year == 1997 
>    replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bay 
> Area, CA" & year == 2015 
>    replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bost
> on-Cambridge-Newton, MA-NH" & year == 2015 
>    replace msa_lab =  msa_comb + " " + string(${time})   if msa_comb == "Bost
> on-Cambridge-Newton, MA-NH" & year == 2000 */
.    qui reg body_adj_wt impact_cite_affl_wt 
 66.    local coef : dis %3.2f _b[impact_cite_affl_wt]
 67.    local cons : dis %3.2f _b[_cons]
 68.    local N = e(N)
 69.    tw scatter body_adj_wt impact_cite_affl_wt , mcolor(gs13%50) msize(vsma
> ll) xlabel(0(5000)60000, labsize(vsmall)) ylab(0(5000)60000, labsize(vsmall))
>  || ///
>       scatter body_adj_wt impact_cite_affl_wt if !mi(msa_lab) , mlabvp(clock)
>  mcolor(ebblue) msize(vsmall)  mlabel(msa_lab) mlabcolor(black) mlabsize(tiny
> ) || ///
>       (function y=_b[impact_cite_affl_wt]*x+_b[_cons] , range(0 60000) lpatte
> rn(dash) lcolor(lavender)), xtitle("MSA Productivity", size(vsmall)) ytitle("
> MSA Paper-to-Patent Citations", size(vsmall)) legend(on order(- "N (MSAs) = `
> N'" ///
>                                                                              
>                                          "Slope = `coef'") pos(5) ring(0) reg
> ion(fcolor(none)) size(vsmall))
 70.    graph export ../output/figures/pat_prod_scatter_`samp'.pdf, replace
 71.    /*hashsort p -cite_affl_wt 
>    by p: egen mean_msa = mean(msa_size)
>    by p: egen mean_cite = mean(cite_affl_wt)
>    hashsort p -cite_affl_wt  
>    gduplicates drop p mean_msa mean_cite, force
>    drop msa_lab
>    gen msa_lab = msa_comb + " " + string(${time})  + "p"+string(p)
>    qui reg mean_cite mean_msa
>    local coef : dis %3.2f _b[mean_msa]
>    tw scatter mean_cite mean_msa, mcolor(ebblue) msize(vsmall) xlabel(#10, la
> bsize(vsmall)) ylab(#10, labsize(vsmall))  mlabel(msa_lab) mlabcolor(black) m
> labsize(tiny) xtitle("MSA Size in Year", size(vsmall)) ytitle("Average Effect
> ive Output", size(vsmall)) legend(on order(- "Slope = `coef'") pos(5) ring(0)
>  size(vsmall))
>    *graph export ../output/figures/binscatter_`samp'.pdf, replace
>    restore*/
.     
. /*    preserve
>     keep if inrange(year , 2015,2022)
>     gcollapse (mean) msa_size cluster_shr, by(msa_comb)
>     gsort - msa_size
>     mkmat msa_size in 1/30, mat(top_30clus_`samp')
>     li in 1/30
>     mkmat msa_size in 1/10, mat(top_10clus_`samp')
>     restore*/
. /*    gcollapse (mean) msa_size_field field_cluster_shr, by(msa_comb field)
>     forval i = 0/4 {
>         preserve
>         keep if field ==`i'
>         gsort -msa_size_field
>         li in 1/10
>         restore
>     }*/
. 
. end

. 
. program  maps
  1.     syntax, samp(str) 
  2.     spshape2dta ../external/geo/cb_2018_us_state_500k.shp, replace saving(
> usa_state)
  3.     use usa_state_shp, clear
  4.     merge m:1 _ID using usa_state
  5.     destring STATEFP, replace
  6.     drop if STATEFP > 56
  7.     // alaska
.     drop if _X > 0 & !mi(_X) & STATEFP == 2  
  8.     geo2xy _Y _X if STATEFP ==2, proj(mercator) replace
  9.     replace _Y = _Y / 5 +1200000 if STATEFP == 2 
 10.     replace _X = _X / 5 - 2000000  if STATEFP == 2 
 11.     drop if _X < -160 & !mi(_X) & _ID == 43  // small islands to the west
 12.     geo2xy _Y _X if _ID == 43, proj(mercator) replace
 13.     replace _Y = _Y  + 800000 if _ID == 43
 14.     replace _X = _X  - 1200000 if _ID == 43
 15.     geo2xy _Y _X if !inlist(_ID, 28,43), replace proj(mercator)
 16.     replace _X = _X + 53500 if !inlist(_ID, 28,43)
 17.     replace _Y = _Y - 3100 if !inlist(_ID, 28,43)
 18.     drop _CX- _merge
 19.     sort _ID shape_order
 20.     save usa_state_shp_clean.dta, replace
 21.     
.     spshape2dta ../external/geo/cb_2018_us_cbsa_500k.shp, replace saving(usa_
> msa)
 22.     use usa_msa_shp, clear
 23.     merge m:1 _ID using usa_msa, nogen
 24.     destring CBSAFP, replace
 25.     gen state = strtrim(substr(NAME, strpos(NAME, ",")+1, 3))
 26.     drop if inlist(state, "PR")
 27.     // alaska
.     drop if _X > 0 & !mi(_X) & state == "AK" 
 28.     geo2xy _Y _X if state == "AK" , proj(mercator) replace
 29.    replace _Y = _Y / 5 + 1200000 if state == "AK"
 30.     replace _X = _X / 5 - 1705000 if state == "AK" 
 31.     drop if _X < -160 & !mi(_X) & state == "HI"  // small islands to the w
> est
 32.     geo2xy _Y _X if state == "HI", proj(mercator) replace
 33.     replace _Y = _Y + 800000 if state == "HI" 
 34.     replace _X = _X  - 1200000 if state == "HI" 
 35.     geo2xy _Y _X if !inlist(state, "AK", "HI"), replace proj(mercator)
 36.     sort _ID shape_order
 37.     save usa_msa_shp_clean.dta, replace
 38. 
.     use if !mi(msa_comb) & inrange(year, 1945, 2022) using ../external/samp/a
> thr_panel_full_`samp', clear
 39.     bys msa_comb: egen mode = mode(msacode)
 40.     replace msacode = mode
 41.     merge m:1 msacode using ../external/geo/msas, assert(1 2 3) keep(1 3) 
> nogen
 42.     replace msa_comb = msatitle if !mi(msatitle)
 43.     replace msa_comb = "San Francisco-Oakland-Hayward, CA" if msa_comb == 
> "San Francisco-Oakland-Haywerd, CA"
 44.     replace msa_comb = "Macon-Bibb County, GA" if msa_comb == "Macon, GA"
 45.     bys athr_id msa_comb ${time} : gen count = _n == 1
 46.     keep if inrange(year , 1945,2022)
 47.     gcollapse (sum) affl_wt impact_cite_affl_wt body_adj_wt (mean) msa_siz
> e , by(msa_comb)
 48.     save ../temp/map_samp, replace
 49.     
.     use usa_msa, clear
 50.     rename NAME msa_comb
 51.     merge 1:m msa_comb using ../temp/map_samp, assert(1 2 3) keep(1 3) nog
> en
 52.     foreach var in impact_cite_affl_wt {
 53.         xtile `var'_5 = `var', nq(5)
 54.         qui sum `var' 
 55.         local min : dis %3.2f r(min)
 56.         local max : dis %3.2f r(max)
 57.         _pctile `var',percentiles(20 40 60 80)
 58.         local p20: dis %3.2f r(r1)
 59.         local p40: dis %3.2f r(r2)
 60.         local p60: dis %3.2f r(r3)
 61.         local p80: dis %3.2f r(r4)
 62.         colorpalette carto Teal, n(5) nograph 
 63.         spmap  `var'_5 using usa_msa_shp_clean,  id(_ID)  fcolor(`r(p)'%50
> ) clnumber(5) ///
>           ocolor(white ..) osize(0.15 ..) ndfcolor(gs13) ndocolor(white ..) n
> dsize(0.15 ..) ndlabel("No data") ///
>           polygon(data("usa_state_shp_clean") ocolor(gs2) osize(0.2) fcolor(e
> ggshell%20)) ///
>           legend(label(2 "Min-p20: `min'-`p20'") label(3 "p20-p40: `p20'-`p40
> '") label(4 "p40-p60: `p40'-`p60'") label(5 "p60-p80: `p60'-`p80'") label(6 "
> p80-Max: `p80'-`max'") pos(4) size(2)) legtitle("${`var'_name}")
 64.         graph export ../output/figures/`var'_map_`samp'.pdf, replace
 65.     }
 66. end

. 
. program raw_bs
  1.     syntax, samp(str) 
  2.     use if !mi(msa_comb) & inrange(year, 1945, 2022) using ../external/sam
> p/athr_panel_full_comb_`samp', clear
  3.     drop if mi(msa_comb) 
  4.     gegen msa = group(msa_comb)
  5.     gen ln_y = ln(impact_cite_affl_wt)
  6.     gen ln_x = ln(msa_size)
  7.     gen ln_pat = ln(body_adj_wt)
  8. 
.     // patented vs productivity
.     qui reg body_adj_wt impact_cite_affl_wt 
  9.     local coef : dis %3.2f _b[impact_cite_affl_wt]
 10.     local N = e(N)
 11.     binscatter2 body_adj_wt impact_cite_affl_wt, xtitle("Productivity", si
> ze(vsmall)) ytitle("Paper-to-Patent Citations", size(vsmall)) xlab(, labsize(
> vsmall)) ylab(, labsize(vsmall)) mcolor(gs5) lcolor(ebblue) legend(on order(-
>  "N (Author-years) = `N'" ///
>                                                                              
>                                          "Slope = `coef'") pos(5) ring(0) reg
> ion(fcolor(none)) size(vsmall))
 12.     *graph export ../output/figures/pat_prod_`samp'.pdf, replace
.     qui reg ln_pat ln_y 
 13.     local coef : dis %3.2f _b[ln_y]
 14.     local N = e(N)
 15.     binscatter2 ln_pat ln_y , xtitle("Log Productivity", size(vsmall)) yti
> tle("Log Paper-to-Patent Citations", size(vsmall)) xlab(, labsize(vsmall)) yl
> ab(, labsize(vsmall)) mcolor(gs5) lcolor(ebblue) legend(on order(- "N (Author
> -years) = `N'" ///
>                                                                              
>                                          "Slope = `coef'") pos(5) ring(0) reg
> ion(fcolor(none)) size(vsmall))
 16.     *graph export ../output/figures/log_pat_prod_`samp'.pdf, replace
. end

. 
. 
. program regression 
  1.     syntax, samp(str) 
  2.     use if !mi(msa_comb) & inrange(year, 1945, 2022) using ../external/sam
> p/athr_panel_full_comb_`samp', clear 
  3.     local reg_eq = cond("`samp'"=="year","ln_y ln_x avg_team_size","ln_y l
> n_x") 
  4.     local mat_est  = cond("`samp'"=="year","_b[ln_x] \ _se[ln_x] \ _b[avg_
> team_size] \ _se[ln_x]", "_b[ln_x] \ _se[ln_x]") 
  5.     bys athr_id msa_comb ${time} : gen count = _n == 1
  6.     replace msa_size = 0.0000000000001 if msa_size == 0
  7.     gegen msa = group(msa_comb)
  8.     rename inst inst_name
  9.     gegen inst = group(inst_name)
 10.     gegen msa_field = group(msa field)
 11.     gegen year_field = group(year field)
 12.     gen ln_y = ln(impact_cite_affl_wt)
 13.     gen ln_x = ln(msa_size)
 14.     gen ln_x_cluster = ln(cluster_shr)
 15.     reghdfe `reg_eq', noabsorb
 16.     local slope = _b[ln_x]
 17.     if "`samp'" == "year" {
 18.         binscatter2  ln_y ln_x ,controls(avg_team_size) ytitle("Log Output
> ") xtitle("Log Cluster Size") legend(on order(- "Slope = `slope'") pos(5) rin
> g(0) lwidth(none))
 19.         *graph export ../output/figures/bs_`samp'.pdf, replace
.     }
 20.     if "`samp'" == "year_firstlast" {
 21.         binscatter2  ln_y ln_x , ytitle("Log Output") xtitle("Log Cluster 
> Size") legend(on order(- "Slope = `slope'") pos(5) ring(0) lwidth(none))
 22.         *graph export ../output/figures/bs_`samp'.pdf, replace
.     }
 23.     foreach fe in "${time} msa field" "${time} msa field field#${time}" "$
> {time} msa field field#${time} msa#field" "${time} msa field field#${time} ms
> a#field inst" "${time} msa field field#${time} msa#field inst athr_id" {
 24.         reghdfe `reg_eq', absorb(`fe') vce(cluster msa)
 25.         mat coef_`samp' = nullmat(coef_`samp'), (`mat_est' \ e(N))
 26.         local slope : dis %3.2f _b[ln_x]
 27.         if "`samp'" == "year" {
 28.             binscatter2  ln_y ln_x ,controls(avg_team_size) absorb(year ms
> a field year_field msa_field athr_id) ytitle("Log Output") xtitle("Log Cluste
> r Size") legend(on order(- "Slope = `slope'") pos(5) ring(0) lwidth(none))
 29.             *graph export ../output/figures/final_bs_`samp'.pdf, replace
.         }
 30.         if "`samp'" == "year_firstlast" {
 31.             binscatter2  ln_y ln_x , absorb(year msa field year_field msa_
> field athr_id) ytitle("Log Output") xtitle("Log Cluster Size") legend(on orde
> r(- "Slope = `slope'") pos(5) ring(0) lwidth(none))
 32.             *graph export ../output/figures/final_bs_`samp'.pdf, replace
.         }
 33.     }
 34.     reghdfe `reg_eq', absorb(${time} field field#${time} field#msa inst#ye
> ar inst athr_id) vce(cluster msa)
 35.     mat instyr_`samp' = nullmat(instyr_`samp'), (`mat_est' \ e(N))
 36.     mat coef_`samp' = nullmat(coef_`samp') , instyr_`samp'
 37.     reghdfe `reg_eq', absorb(year msa athr_id field inst) vce(cluster msa)
 38.     mat field_`samp' = nullmat(field_`samp'), (`mat_est' \ e(N))
 39.     reghdfe `reg_eq', absorb(year msa athr_id gen_mesh1 gen_mesh2 inst) vc
> e(cluster msa)
 40.     mat field_`samp' = nullmat(field_`samp'), (`mat_est' \ e(N))
 41.     mat alt_spec_`samp' = instyr_`samp' , field_`samp'
 42. /*    reghdfe `reg_eq', absorb(year msa athr_id qualifier_name1 qualifier_
> name2 inst) vce(cluster msa)
>     mat field_`samp' = nullmat(field_`samp'), (`mat_est' \ e(N))
>     reghdfe `reg_eq', absorb(year msa athr_id term1 term2 inst) vce(cluster m
> sa)
>     mat field_`samp' = nullmat(field_`samp'), (`mat_est' \ e(N))*/
.         
. end

. 
. program output_tables
  1.     syntax, samp(str) 
  2.     foreach file in top_10clus top_30clus coef field { 
  3.          qui matrix_to_txt, saving("../output/tables/`file'_`samp'.txt") m
> atrix(`file'_`samp') ///
>            title(<tab:`file'_`samp'>) format(%20.4f) replace
  4.     }
  5. 
. end

. ** 
. main
  363,753
N = 363,753; 181,162 unbalanced groups of sizes 1 to 49
(2,272 missing values generated)
(2 missing values generated)
(278,852 missing values generated)
(291,246 observations deleted)

     +--------------------------------------------------------------------+
     |                                     msa_comb   msa_size   cluste~r |
     |--------------------------------------------------------------------|
  1. |        New York-Newark-Jersey City, NY-NJ-PA   32751.03   .0347883 |
  2. |               Boston-Cambridge-Newton, MA-NH   31212.24   .0331974 |
  3. | Washington-Arlington-Alexandria, DC-VA-MD-WV   27164.19   .0287835 |
  4. |                                 Bay Area, CA   22784.03   .0242985 |
  5. |           Los Angeles-Long Beach-Anaheim, CA   14375.95   .0152639 |
     |--------------------------------------------------------------------|
  6. |           Chicago-Naperville-Elgin, IL-IN-WI   10932.56   .0115966 |
  7. |  Philadelphia-Camden-Wilmington, PA-NJ-DE-MD   10853.16   .0115364 |
  8. |                       San Diego-Carlsbad, CA   10696.82   .0113209 |
  9. |         Houston-The Woodlands-Sugar Land, TX   9969.964   .0105397 |
 10. |                   Research Triangle Park, NC   9846.813   .0104402 |
     |--------------------------------------------------------------------|
 11. |                Baltimore-Columbia-Towson, MD   8815.715   .0093369 |
 12. |                  Seattle-Tacoma-Bellevue, WA   8103.646   .0086477 |
 13. |            Atlanta-Sandy Springs-Roswell, GA   6918.264   .0073379 |
 14. |                                Ann Arbor, MI   5311.898     .00565 |
 15. |                               Pittsburgh, PA   5242.954   .0055507 |
     |--------------------------------------------------------------------|
 16. |                        New Haven-Milford, CT   5039.776   .0053987 |
 17. |                             St. Louis, MO-IL   4763.687   .0050792 |
 18. |                                   Ithaca, NY   4335.285    .004616 |
 19. |                                  Madison, WI   4236.916   .0044961 |
 20. |      Minneapolis-St. Paul-Bloomington, MN-WI   4179.281   .0044334 |
     |--------------------------------------------------------------------|
 21. |              Dallas-Fort Worth-Arlington, TX   4093.582   .0043638 |
 22. |                         Cleveland-Elyria, OH   3881.805   .0040951 |
 23. |      Sacramento--Roseville--Arden-Arcade, CA   3865.795   .0041006 |
 24. |                                 Columbus, OH   3601.496   .0038466 |
 25. |                                Rochester, NY   3438.797   .0036456 |
     |--------------------------------------------------------------------|
 26. |                              Gainesville, FL   3137.715   .0033298 |
 27. |                   Denver-Aurora-Lakewood, CO   2961.064   .0031476 |
 28. |                         Cincinnati, OH-KY-IN   2903.041   .0030645 |
 29. |    Miami-Fort Lauderdale-West Palm Beach, FL   2806.823   .0029722 |
 30. |                           Salt Lake City, UT   2431.213   .0025846 |
     +--------------------------------------------------------------------+
(99 missing values generated)
(309 missing values generated)
variable msa_lab was str1 now str15
(1 real change made)
variable msa_lab was str15 now str22
(1 real change made)
(1 real change made)
(0 real changes made)
variable msa_lab was str22 now str37
(1 real change made)
(1 real change made)
(1 real change made)
(6 real changes made)
(1 real change made)
(1 real change made)
(1 real change made)
variable msa_lab was str37 now str39
(1 real change made)
variable msa_lab was str39 now str44
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(2 real changes made)
(5 real changes made)
file ../output/figures/pat_prod_scatter_year_firstlast.pdf saved as PDF
    format
  (importing .shp file)
  (importing .dbf file)
  (creating _ID spatial-unit id)
  (creating _CX coordinate)
  (creating _CY coordinate)

  file usa_state_shp.dta created
  file usa_state.dta     created

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           296,043  (_merge==3)
    -----------------------------------------
STATEFP: all characters numeric; replaced as byte
(9,030 observations deleted)
(344 observations deleted)
(116,302 real changes made)
(116,302 real changes made)
(310 observations deleted)
(2,373 real changes made)
(2,373 real changes made)
(166,263 real changes made)
(166,263 real changes made)
file usa_state_shp_clean.dta saved
  (importing .shp file)
  (importing .dbf file)
  (creating _ID spatial-unit id)
  (creating _CX coordinate)
  (creating _CY coordinate)

  file usa_msa_shp.dta created
  file usa_msa.dta     created

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           408,279  
    -----------------------------------------
CBSAFP: all characters numeric; replaced as long
(5,831 observations deleted)
(0 observations deleted)
(7,520 real changes made)
(7,520 real changes made)
(310 observations deleted)
(2,373 real changes made)
(2,373 real changes made)
file usa_msa_shp_clean.dta saved
warning: Multiple modes encountered in one or more groups.  Generating
         missing values for the modes in these groups.  Use option minmode,
         maxmode, or nummode() to select one of the modes.
(6 missing values generated)
(21,155 real changes made)
(variable msatitle was str46, now str50 to accommodate using data's values)
(variable city was str35, now str42 to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             6
        from master                         6  
        from using                          0  

    Matched                           363,747  
    -----------------------------------------
(41,143 real changes made)
(0 real changes made)
(1 real change made)
(0 observations deleted)
(file ../temp/map_samp.dta not found)
file ../temp/map_samp.dta saved

    Result                      Number of obs
    -----------------------------------------
    Not matched                           633
        from master                       633  
        from using                          0  

    Matched                               312  
    -----------------------------------------
file ../output/figures/impact_cite_affl_wt_map_year_firstlast.pdf saved as
    PDF format
(0 observations deleted)
(2,272 missing values generated)
(2 missing values generated)
(278,852 missing values generated)
(2 real changes made)
(2,272 missing values generated)
(2 missing values generated)
(MWFE estimator converged in 1 iterations)

HDFE Linear regression                            Number of obs   =    361,481
Absorbing 1 HDFE group                            F(   1, 361479) =   20714.46
                                                  Prob > F        =     0.0000
                                                  R-squared       =     0.0542
                                                  Adj R-squared   =     0.0542
                                                  Within R-sq.    =     0.0542
                                                  Root MSE        =     2.2880

------------------------------------------------------------------------------
        ln_y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .3755724   .0026095   143.93   0.000     .3704578    .3806869
       _cons |  -6.222929   .0219185  -283.91   0.000    -6.265889    -6.17997
------------------------------------------------------------------------------
(dropped 30 singleton observations)
(MWFE estimator converged in 7 iterations)

HDFE Linear regression                            Number of obs   =    361,451
Absorbing 3 HDFE groups                           F(   1,    278) =       2.43
Statistics robust to heteroskedasticity           Prob > F        =     0.1199
                                                  R-squared       =     0.1639
                                                  Adj R-squared   =     0.1630
                                                  Within R-sq.    =     0.0002
Number of clusters (msa)     =        279         Root MSE        =     2.1524

                                  (Std. err. adjusted for 279 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .2007638   .1287008     1.56   0.120    -.0525881    .4541158
       _cons |  -4.776926   1.064679    -4.49   0.000    -6.872782    -2.68107
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |        78           0          78     |
         msa |       279         279           0    *|
       field |         5           1           4     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 40 singleton observations)
(MWFE estimator converged in 5 iterations)

HDFE Linear regression                            Number of obs   =    361,441
Absorbing 4 HDFE groups                           F(   1,    278) =       2.88
Statistics robust to heteroskedasticity           Prob > F        =     0.0906
                                                  R-squared       =     0.2103
                                                  Adj R-squared   =     0.2089
                                                  Within R-sq.    =     0.0003
Number of clusters (msa)     =        279         Root MSE        =     2.0925

                                  (Std. err. adjusted for 279 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .2086091   .1228521     1.70   0.091    -.0332294    .4504476
       _cons |  -4.841822   1.016305    -4.76   0.000    -6.842453   -2.841191
------------------------------------------------------------------------------

Absorbed degrees of freedom:
------------------------------------------------------+
  Absorbed FE | Categories  - Redundant  = Num. Coefs |
--------------+---------------------------------------|
         year |        78           0          78     |
          msa |       279         279           0    *|
        field |         5           1           4     |
   field#year |       369          78         291    ?|
------------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 151 singleton observations)
(MWFE estimator converged in 7 iterations)

HDFE Linear regression                            Number of obs   =    361,330
Absorbing 5 HDFE groups                           F(   1,    270) =       2.65
Statistics robust to heteroskedasticity           Prob > F        =     0.1050
                                                  R-squared       =     0.2169
                                                  Adj R-squared   =     0.2134
                                                  Within R-sq.    =     0.0002
Number of clusters (msa)     =        271         Root MSE        =     2.0866

                                  (Std. err. adjusted for 271 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |    .195736    .120348     1.63   0.105    -.0412038    .4326758
       _cons |  -4.735323   .9957824    -4.76   0.000    -6.695808   -2.774837
------------------------------------------------------------------------------

Absorbed degrees of freedom:
------------------------------------------------------+
  Absorbed FE | Categories  - Redundant  = Num. Coefs |
--------------+---------------------------------------|
         year |        78           0          78     |
          msa |       271         271           0    *|
        field |         5           1           4     |
   field#year |       369          78         291    ?|
    msa#field |       963         963           0    *|
------------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 2098 singleton observations)
(MWFE estimator converged in 52 iterations)

HDFE Linear regression                            Number of obs   =    359,383
Absorbing 6 HDFE groups                           F(   1,    263) =       2.79
Statistics robust to heteroskedasticity           Prob > F        =     0.0962
                                                  R-squared       =     0.2707
                                                  Adj R-squared   =     0.2610
                                                  Within R-sq.    =     0.0002
Number of clusters (msa)     =        264         Root MSE        =     2.0228

                                  (Std. err. adjusted for 264 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |    .227583   .1363135     1.67   0.096    -.0408216    .4959876
       _cons |  -4.995395   1.128032    -4.43   0.000    -7.216518   -2.774271
------------------------------------------------------------------------------

Absorbed degrees of freedom:
------------------------------------------------------+
  Absorbed FE | Categories  - Redundant  = Num. Coefs |
--------------+---------------------------------------|
         year |        78           0          78     |
          msa |       264         264           0    *|
        field |         5           1           4     |
   field#year |       368          78         290    ?|
    msa#field |       946         946           0    *|
         inst |      3126           1        3125    ?|
------------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 120647 singleton observations)
(MWFE estimator converged in 113 iterations)

HDFE Linear regression                            Number of obs   =    240,834
Absorbing 7 HDFE groups                           F(   1,    230) =       4.84
Statistics robust to heteroskedasticity           Prob > F        =     0.0288
                                                  R-squared       =     0.6575
                                                  Adj R-squared   =     0.5349
                                                  Within R-sq.    =     0.0001
Number of clusters (msa)     =        231         Root MSE        =     1.6082

                                  (Std. err. adjusted for 231 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .1679455    .076332     2.20   0.029     .0175462    .3183448
       _cons |  -4.379817   .6327625    -6.92   0.000    -5.626569   -3.133065
------------------------------------------------------------------------------

Absorbed degrees of freedom:
------------------------------------------------------+
  Absorbed FE | Categories  - Redundant  = Num. Coefs |
--------------+---------------------------------------|
         year |        78           0          78     |
          msa |       231         231           0    *|
        field |         5           1           4     |
   field#year |       362          78         284    ?|
    msa#field |       838         838           0    *|
         inst |      2092           1        2091    ?|
      athr_id |     60198         265       59933    ?|
------------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 134124 singleton observations)
(MWFE estimator converged in 129 iterations)

HDFE Linear regression                            Number of obs   =    227,357
Absorbing 7 HDFE groups                           F(   1,    177) =       0.19
Statistics robust to heteroskedasticity           Prob > F        =     0.6642
                                                  R-squared       =     0.6902
                                                  Adj R-squared   =     0.5413
                                                  Within R-sq.    =     0.0000
Number of clusters (msa)     =        178         Root MSE        =     1.6032

                                  (Std. err. adjusted for 178 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .0812988   .1869631     0.43   0.664     -.287665    .4502625
       _cons |  -3.628178   1.557651    -2.33   0.021    -6.702135   -.5542215
------------------------------------------------------------------------------

Absorbed degrees of freedom:
------------------------------------------------------+
  Absorbed FE | Categories  - Redundant  = Num. Coefs |
--------------+---------------------------------------|
         year |        78           0          78     |
        field |         5           1           4     |
   field#year |       359          78         281    ?|
    field#msa |       723         723           0    *|
    inst#year |     16317          79       16238    ?|
         inst |      1068        1068           0    ?|
      athr_id |     56578          85       56493    ?|
------------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 120508 singleton observations)
(MWFE estimator converged in 139 iterations)

HDFE Linear regression                            Number of obs   =    240,973
Absorbing 5 HDFE groups                           F(   1,    238) =       4.80
Statistics robust to heteroskedasticity           Prob > F        =     0.0294
                                                  R-squared       =     0.6464
                                                  Adj R-squared   =     0.5228
                                                  Within R-sq.    =     0.0001
Number of clusters (msa)     =        239         Root MSE        =     1.6289

                                  (Std. err. adjusted for 239 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .1640704   .0748529     2.19   0.029     .0166116    .3115291
       _cons |  -4.347715   .6203371    -7.01   0.000    -5.569767   -3.125662
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |        78           0          78     |
         msa |       239         239           0    *|
     athr_id |     60239           1       60238     |
       field |         5           1           4    ?|
        inst |      2106         263        1843    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 80220 singleton observations)
(MWFE estimator converged in 217 iterations)

HDFE Linear regression                            Number of obs   =    156,608
Absorbing 6 HDFE groups                           F(   1,    210) =       3.13
Statistics robust to heteroskedasticity           Prob > F        =     0.0784
                                                  R-squared       =     0.6828
                                                  Adj R-squared   =     0.5191
                                                  Within R-sq.    =     0.0001
Number of clusters (msa)     =        211         Root MSE        =     1.7012

                                  (Std. err. adjusted for 211 clusters in msa)
------------------------------------------------------------------------------
             |               Robust
        ln_y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        ln_x |   .2201342   .1244513     1.77   0.078    -.0251997    .4654682
       _cons |  -4.275272   1.059268    -4.04   0.000    -6.363434    -2.18711
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |        78           0          78     |
         msa |       211         211           0    *|
     athr_id |     39136           1       39135     |
   gen_mesh1 |      6082         181        5901    ?|
   gen_mesh2 |      6897         265        6632    ?|
        inst |      1628         252        1376    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. 
end of do-file

--------------------------------------------------------------------------------
Makelog ended: 2023-12-20 23:57:41
Working directory: /export/home/dor/cxu/innovation_projs/analysis/science_geo/cluster_descriptives/code
--------------------------------------------------------------------------------
