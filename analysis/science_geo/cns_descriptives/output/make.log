--------------------------------------------------------------------------------
Makelog started: 2024-01-04 23:39:36
Working directory: /export/home/dor/cxu/innovation_projs/analysis/science_geo/cns_descriptives/code
--------------------------------------------------------------------------------
External links successfully created!

  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      17.0
___/   /   /___/   /   /___/       MP—Parallel Edition

 Statistics and Data Science       Copyright 1985-2021 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-STATA-PC        https://www.stata.com
                                   979-696-4600        stata@stata.com

Stata license: Unlimited-user 4-core network, expiring 17 Nov 2024
Serial number: 501809301897
  Licensed to: Harvard Business School
               Research Computing

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. More than 2 billion observations are allowed; see help obs_advice.
      4. Maximum number of variables is set to 120,000; see help set_maxvar.

. do "/export/home/dor/cxu/innovation_projs/analysis/science_geo/cns_descriptiv
> es/code/analysis.do" 

. set more off

. clear all

. capture log close

. program drop _all

. set scheme modern

. graph set window fontface "Arial Narrow"
not available in non-GUI version

. pause on

. set seed 8975

. here, set
/export/home/dor/cxu/innovation_projs/analysis/science_geo/cns_descriptives/cod
> e/

. 
. program main
  1.     global country_name "countries"
  2.     global us_state_name "US states"
  3.     global area_name "US cities"
  4.     global city_full_name "cities"
  5.     global inst_name "institutions"
  6.     global msatitle_name "MSAs"
  7.     global msa_comb_name "MSAs"
  8.     global msa_world_name "cities"
  9.     global msa_c_world_name "cities"
 10.     di "OUTPUT START"
 11.     foreach var in impact_cite_affl_wt body_adj_wt {
 12.         di "CNS: `var'"
 13.         athr_loc, data(newfund) samp(cns) wt_var(`var')
 14.         qui trends, data(newfund) samp(cns) wt_var(`var')
 15.         di "ALL: `var'"
 16.         athr_loc, data(all) samp(jrnls) wt_var(`var')
 17.         qui trends, data(all) samp(jrnls) wt_var(`var')
 18.     }
 19.     *calc_broad_hhmi, data(`data') samp(`samp') 
.     top_mesh_terms, data(all) samp(jrnls) 
 20.     qui output_tables, data(newfund) samp(cns) 
 21.     qui output_tables, data(all) samp(jrnls) 
 22. end

. 
. program athr_loc
  1.     syntax, data(str) samp(str)  wt_var(str)
  2.     local suf = ""
  3.     if "`wt_var'" == "cite_affl_wt" local suf "_wt"
  4.     if "`wt_var'" == "impact_affl_wt" local suf "_if"
  5.     if "`wt_var'" == "impact_cite_affl_wt" local suf "_if_wt"
  6.     if "`wt_var'" == "pat_adj_wt" local suf "_pat"
  7.     if "`wt_var'" == "frnt_adj_wt" local suf "_frnt"
  8.     if "`wt_var'" == "body_adj_wt" local suf "_body"
  9.     use ../external/openalex/cleaned_last5yrs_`data'_`samp', clear 
 10.     replace inst = "Mass General Brigham" if inlist(inst, "Massachusetts G
> eneral Hospital" , "Brigham and Women's Hospital")
 11.     local end 20
 12.     foreach loc in country msa_c_world inst {
 13.         if "`loc'" == "inst" & ("`wt_var'" != "pat_adj_wt" & "`wt_var'" !=
>  "body_adj_wt") {
 14.             local end 50
 15.         }
 16.         qui gunique pmid 
 17.         local articles = r(unique)
 18.         qui sum `wt_var'
 19.         local total = round(r(sum))
 20.         assert `total' == `articles'
 21.         qui sum `wt_var' if !mi(`loc') 
 22.         local denom = r(sum) 
 23.         preserve
 24.         if inlist("`loc'", "us_state", "area", "msatitle", "msa_comb") {
 25.             qui keep if country == "United States"
 26.         }
 27.         collapse (sum) `wt_var', by(`loc')
 28.         qui hashsort -`wt_var' 
 29.         qui gen perc = `wt_var' / `total' * 100
 30.         li if mi(`loc')
 31.         qui drop if mi(`loc')
 32.         qui gen cum_perc = sum(perc) 
 33.         gen rank = _n 
 34.         save ../temp/rankings_`loc'`suf', replace
 35.         drop rank
 36.         qui count
 37.         local rank_end = min(r(N),`end') 
 38.         li `loc' perc in 1/`rank_end'
 39.         di "Total articles: `total'"
 40.         mkmat perc cum_perc in 1/`rank_end', mat(top_`loc'_`samp'`suf')
 41. *        mat top_`loc'_`data'_`samp' = nullmat(top_`loc'_`data'_`samp') , 
> (top_`loc'_`samp'`suf')
.         qui levelsof `loc' in 1/2
 42.         global top2_`loc'_`data' "`r(levels)'"
 43.         if inlist("`loc'", "inst", "city_full", "msatitle","msa_comb", "ms
> aworld", "msa_c_world") {
 44.             qui levelsof `loc' in 1/`rank_end'
 45.             global `loc'_`data' "`r(levels)'"
 46.         }
 47.         qui gen rank_grp = "first" if _n == 1
 48.         replace `loc' = "harvard university" if `loc' == "university harva
> rd"
 49.         replace `loc' = "stanford university" if `loc' == "university stan
> ford"
 50.         qui levelsof `loc' if _n == 1 
 51.         global `loc'_first "`r(levels)'"
 52.         qui levelsof `loc' if _n == 2
 53. 
.         global `loc'_second "`r(levels)'"
 54.         qui replace rank_grp = "second" if _n == 2
 55.         qui replace rank_grp = "china" if `loc' == "China"
 56.         qui replace rank_grp = "uk" if `loc' == "United Kingdom"
 57.         qui replace rank_grp = "rest of top 10" if inrange(_n,3,10) & !inl
> ist(rank_grp,"china", "uk")
 58.         qui replace rank_grp = "remaining" if mi(rank_grp)
 59.         keep `loc' rank_grp
 60.         qui save ../temp/`loc'_rank_`data'_`samp'`suf', replace
 61.         restore
 62.     }
 63. end

. 
. program calc_broad_hhmi
  1.    syntax, data(str) samp(str) 
  2.    use if inrange(year, 1945, 2022) using ../external/openalex/cleaned_las
> t5yrs_`data'_`samp', clear
  3.    replace inst = "Mass General Brigham" if inlist(inst, "Massachusetts Ge
> neral Hospital" , "Brigham and Women's Hospital")
  4.    qui gunique pmid which_athr
  5.    local num_athrs = r(unique)
  6.    qui gunique pmid which_athr if country == "United States"
  7.    local num_athrs_US = r(unique)
  8.    foreach i in broad hhmi {
  9.        qui gunique pmid which_athr if has_`i'_affl == 1
 10.        local num_`i' = r(unique)
 11.        di `num_`i'' " authors of " `num_athrs' " are " "`i' affiliated or 
> " `num_`i''/`num_athrs'*100 " percent"
 12.        qui gunique pmid which_athr if has_`i'_affl == 1 & country == "Unit
> ed States"
 13.        local num_`i'_US = r(unique)
 14.        di `num_`i'_US' " US authors of " `num_athrs_US' " are " "`i' affil
> iated or " `num_`i'_US'/`num_athrs_US'*100 " percent"
 15.        // hhmi has to be us
.        preserve
 16.        keep if country == "United States"
 17.        qui gunique pmid which_athr if has_`i'_affl == 1 & inst == "Stanfor
> d University" 
 18.        local num_`i'_stanford = r(unique)
 19.        di `num_`i'_stanford' " stanford authors of " `num_`i'_US' " are " 
> "`i' affiliated or " `num_`i'_stanford'/`num_`i'_US'*100 " percent"
 20.        qui gunique pmid which_athr if has_`i'_affl == 1 & inst == "Harvard
>  University" 
 21.        local num_`i'_harvard = r(unique)
 22.        di `num_`i'_harvard' " harvard authors of " `num_`i'_US' " are " "`
> i' affiliated or " `num_`i'_harvard'/`num_`i'_US'*100 " percent"
 23.        restore
 24.        if "`i'" == "broad" {
 25.            qui count if  inlist(inst, "Harvard University", "Massachusetts
>  Institute of Technology", "Boston Children's Hospital", "Dana Farber Cancer 
> Institute", "Massachusetts General Hospital", "Brigham and Women's Hospital",
>  "Beth Israel Deaconess Medical Center")
 26.            if r(N) > 0 {
 27.                preserve
 28.                keep if inlist(inst, "Harvard University", "Massachusetts I
> nstitute of Technology", "Boston Children's Hospital", "Dana Farber Cancer In
> stitute", "Massachusetts General Hospital", "Brigham and Women's Hospital", "
> Beth Israel Deaconess Medical Center")
 29.                qui gunique pmid which_athr if has_`i'_affl == 1 
 30.                local num_athrs_broad = r(unique)
 31.                qui gunique pmid which_athr if has_`i'_affl == 1 & inst == 
> "Harvard University" 
 32.                local num_`i'_harvard = r(unique)
 33.                di `num_`i'_harvard' " harvard authors of " `num_athrs_broa
> d' " are " "`i' affiliated or " `num_`i'_harvard'/`num_athrs_broad'*100 " per
> cent"
 34.                qui gunique pmid which_athr if has_`i'_affl == 1 & inst == 
> "Massachusetts Institute of Technology" 
 35.                local num_`i'_mit= r(unique)
 36.                di `num_`i'_mit' " mit authors of " `num_athrs_broad' " are
>  " "`i' affiliated or " `num_`i'_mit'/`num_athrs_broad'*100 " percent"
 37.                restore 
 38.            }
 39.         }
 40.     }
 41. end

. 
. program trends
  1.     syntax, data(str) samp(str)  wt_var(str)
  2.     local suf = ""
  3.     if "`wt_var'" == "cite_affl_wt" local suf "_wt"
  4.     if "`wt_var'" == "impact_affl_wt" local suf "_if"
  5.     if "`wt_var'" == "impact_cite_affl_wt" local suf "_if_wt"
  6.     if "`wt_var'" == "pat_adj_wt" local suf "_pat"
  7.     if "`wt_var'" == "frnt_adj_wt" local suf "_frnt"
  8.     if "`wt_var'" == "body_adj_wt" local suf "_body"
  9.     use if inrange(year, 1945, 2022)  using ../external/openalex/cleaned_a
> ll_`data'_`samp', clear
 10.     replace inst = "Mass General Brigham" if inlist(inst, "Massachusetts G
> eneral Hospital" , "Brigham and Women's Hospital")
 11.     cap drop counter
 12. 
.     gen msa_world = msatitle
 13.     replace msa_world = city if country != "United States"
 14.     qui bys pmid year: gen counter = _n == 1
 15.     qui bys year: egen tot_in_yr = total(counter)
 16.     foreach loc in country  msa_c_world inst {
 17.         preserve
 18.         if inlist("`loc'", "us_state", "area", "msatitle", "msa_comb") {
 19.             qui keep if country == "United States"
 20.         }
 21.         replace `loc' = "harvard university" if `loc' == "university harva
> rd"
 22.         replace `loc' = "stanford university" if `loc' == "university stan
> ford"
 23.         qui merge m:1 `loc' using ../temp/`loc'_rank_`data'_`samp'`suf', a
> ssert(1 3) keep(1 3) nogen
 24.         if "`loc'" == "inst" {
 25.             replace `loc' = strproper(`loc')
 26.         }
 27.         qui sum year
 28.         local min_year = max(1945,r(min))
 29.         qui egen year_bin  = cut(year), at(1945(3)2023) 
 30.         keep if !mi(`loc')
 31.         local year_var year_bin
 32.         
.         /*qui bys pmid `year_var': replace counter = _n == 1
>         qui bys `year_var': egen tot_in_`year_var' = total(counter)
>         qui replace rank_grp = "remaining" if mi(rank_grp)
>         bys pmid: replace cite_count = . if _n !=1 
>         qui bys `year_var': egen tot_cites_in_`year_var' = total(cite_count)
>         replace cite_wt = cite_count/ tot_cites_in_`year_var' * tot_in_`year_
> var'
>         replace impact_wt = impact_wt * jrnl_N / tot_in_`year_var' 
>         hashsort pmid cite_wt
>         qui by pmid: replace cite_wt = cite_wt[_n-1] if mi(cite_wt)
>         replace cite_affl_wt = affl_wt * cite_wt 
>         replace impact_affl_wt = impact_wt * affl_wt*/
. 
.         collapse (sum) `wt_var'  (firstnm) `loc'  , by(rank_grp `year_var')
 33.         bys `year_var': egen tot_in_`year_var' = total(`wt_var')
 34.         qui gen perc = `wt_var'/tot_in_`year_var' * 100
 35.         qui bys `year_var': egen tot = sum(perc)
 36.         save ../temp/trends_`loc'`suf', replace
 37.         qui replace tot = round(tot)
 38.         assert tot==100
 39.         qui drop tot
 40.         if "`loc'" == "city_full" | "`loc'" == "msatitle" | "`loc'" == "ms
> a_world" |  "`loc'" == "msa_c_world" | "`loc'" == "msa_comb" {
 41.             label define rank_grp 1 ${`loc'_first} 2 ${`loc'_second} 3 "Re
> maining top 10" 4 "Remaining places" 
 42.         }
 43.         if "`loc'" == "inst" {
 44.             local proper_1 = strproper(${`loc'_first})
 45.             local proper_2 = strproper(${`loc'_second})
 46.             label define rank_grp 1 "`proper_1'" 2 "`proper_2'" 3 "Remaini
> ng top 10" 4 "Remaining places" 
 47.         }
 48.         if "`loc'" == "country" {
 49.             label define rank_grp 1 ${`loc'_first} 2 "United Kingdom" 3 "C
> hina" 4 "Remaining top 10" 5 "Remaining places" 
 50.         }
 51.         label var rank_grp rank_grp
 52.         qui gen group = 1 if rank_grp == "first"
 53.         qui replace group = 2 if rank_grp == "second"  & "`loc'"!= "countr
> y"
 54.         qui replace group = 2 if rank_grp == "uk" & "`loc'" == "country"
 55.         qui replace group = 3 if rank_grp == "china" & "`loc'" == "country
> "
 56.         local last = 2
 57.         if "`loc'" == "country" local last = 3 
 58.         qui replace group = `last'+1 if rank_grp == "rest of top 10" 
 59.         qui replace group = `last'+2 if rank_grp == "remaining"
 60.         *qui replace group = `last'+3 if rank_grp == "missing"
.         qui hashsort `year_var' -group
 61.         qui bys `year_var': gen stack_perc = sum(perc)
 62.         keep rank_grp `year_var' `loc' perc group stack_perc
 63.         local stacklines
 64.         qui xtset group `year_var' 
 65.         qui sum group 
 66.         local max_grp = r(max)
 67.         qui levelsof group, local(rank_grps)
 68.         local items = `r(r)'
 69.         foreach x of local rank_grps {
 70.            colorpalette carto Teal, intensify(0.85)  n(`items') nograph
 71.            local stacklines `stacklines' area stack_perc `year_var' if gro
> up == `x', fcolor("`r(p`x')'") lcolor(white) lwidth(*0.3) || 
 72. /*           if `x' == `max_grp' {
>                local stacklines `stacklines' area stack_perc `year_var' if gr
> oup == `x', fcolor("dimgray") lcolor(black) lwidth(*0.2) || 
>            }*/
.         }
 73.         qui gen labely = . 
 74.         qui gen rev_group = -group
 75.         if "`loc'"=="country" {
 76.             qui bys `year_var' (rev_group): replace labely = perc/2 if gro
> up == 5
 77.             qui bys `year_var' (rev_group): replace labely = perc/2 + perc
> [_n-1] if group == 4
 78.             qui bys `year_var' (rev_group): replace labely = perc/2 + perc
> [_n-1] + perc[_n-2] if group == 3
 79.             qui bys `year_var' (rev_group): replace labely = perc/2 + perc
> [_n-1] + perc[_n-2] + perc[_n-3] if group == 2
 80.             qui bys `year_var' (rev_group): replace labely = perc/2 + perc
> [_n-1] + perc[_n-2] + perc[_n-3] + perc[_n-4] if group == 1
 81.         }
 82.         if "`loc'"!="country" {
 83.             qui bys `year_var' (rev_group): replace labely = perc/2 if gro
> up == 4
 84.             qui bys `year_var' (rev_group): replace labely = perc/2 + perc
> [_n-1] if group == 3
 85.             qui bys `year_var' (rev_group): replace labely = perc/2 + perc
> [_n-1] + perc[_n-2] if group == 2
 86.             qui bys `year_var' (rev_group): replace labely = perc/2 + perc
> [_n-1] + perc[_n-2] + perc[_n-3] if group == 1
 87.         }
 88. *        qui gen labely_lab = "Missing Info" if group == `last'+3
.         qui gen labely_lab = "Everywhere else" if group == `last'+2
 89.         qui replace labely_lab = "Remaining top 10" if group == `last'+1
 90.         qui replace labely_lab = "China" if group == 3 & "`loc'"=="country
> "
 91.         qui replace labely_lab = ${`loc'_second} if group == 2
 92.         qui replace labely_lab = ${`loc'_second} if group == 2
 93.         qui replace labely_lab = ${`loc'_first} if group == 1
 94.         qui replace labely_lab = "United Kingdom" if group == 2 & "`loc'"=
> ="country"
 95.         qui replace labely_lab = strproper(${`loc'_second}) if group == 2 
> & "`loc'" == "inst"
 96.         qui replace labely_lab = strproper(${`loc'_first}) if group == 1 &
>  "`loc'" == "inst"
 97.         qui replace labely_lab = subinstr(labely_lab, "United States", "US
> ", .)
 98.         qui replace labely_lab = subinstr(labely_lab, "MA-NH", "US", .) if
>  strpos("`loc'" , "world")>0
 99.         qui replace labely_lab = subinstr(labely_lab, "NY-NJ-PA", "US", .)
>  if strpos("`loc'" , "world")>0
100.         qui replace labely_lab = subinstr(labely_lab, "CA", "US", .) if st
> rpos("`loc'" , "world")>0
101.         qui replace labely_lab = subinstr(labely_lab, "United Kingdom", "U
> K", .)
102.         qui sum `year_var'
103.         replace `year_var' = 2023 if `year_var' == r(max)
104.         if "`loc'" == "country" {
105.             graph tw `stacklines' (scatter labely `year_var' if `year_var'
>  ==2023, ms(smcircle) ///
>               msize(0.2) mcolor(black%40) mlabsize(vsmall) mlabcolor(black) m
> label(labely_lab)), ///
>               ytitle("Share of Worldwide Fundamental Science Research Output"
> , size(vsmall)) xtitle("Year", size(vsmall)) xlabel(`min_year'(3)2023, angle(
> 45) labsize(vsmall)) ylabel(0(10)100, labsize(vsmall)) ///
>               graphregion(margin(r+27)) plotregion(margin(zero)) ///
>               legend(off label(1 ${`loc'_first}) label(2 "United Kingdom") la
> bel(3 "China") label(4 "Remaining top 10") label(5 "Remaining places")  ring(
> 1) pos(6) rows(2))
106.             qui graph export ../output/figures/`loc'_stacked_`data'_`samp'
> `suf'.pdf , replace 
107.         }
108.         local w = 27 
109.         if ("`loc'" == "msatitle" | "`loc'" == "msa_world" | "`loc'" == "m
> sa_c_world" | "`loc'" == "msa_comb") local w = 27 
110.         if "`loc'" != "country" {
111.             graph tw `stacklines' (scatter labely `year_var' if `year_var'
>  ==2023, ms(smcircle) ///
>               msize(0.2) mcolor(black%40) mlabsize(vsmall) mlabcolor(black) m
> label(labely_lab)), ///
>               ytitle("Share of Worldwide Fundamental Science Research Output"
> , size(vsmall)) xtitle("Year", size(vsmall)) xlabel(`min_year'(3)2023, angle(
> 45) labsize(vsmall)) ylabel(0(10)100, labsize(vsmall)) ///
>               graphregion(margin(r+`w')) plotregion(margin(zero)) ///
>               legend(off label(1 ${`loc'_first}) label(2 ${`loc'_second}) lab
> el(3 "Remaining top 10") label(4 "Remaining places")  ring(1) pos(6) rows(2))
112.             qui graph export ../output/figures/`loc'_stacked_`data'_`samp'
> `suf'.pdf , replace 
113.         }
114.         restore
115.     }
116. end 

.     
. program top_mesh_terms
  1.     syntax, data(str) samp(str) 
  2.     foreach mesh in gen_mesh {
  3.         use ../external/mesh/contracted_`mesh'_`data'_`samp', clear
  4.         gunique pmid
  5.         local total_articles = r(unique)
  6.         qui bys pmid: gen wt = 1/_N
  7.         qui bys pmid: gen num_`mesh' = _N
  8.         sum num_`mesh'
  9.         cap drop _freq
 10.         collapse (sum) article_wt = wt , by(`mesh')
 11.         qui hashsort -article_wt
 12.         qui gen perc = article_wt/`total_articles'*100
 13.         qui gen cum_perc = sum(perc) 
 14.         qui sum article_wt
 15.         local total = round(r(sum))
 16.         qui count
 17.         local rank_end = min(20,r(N))
 18.         li in 1/`rank_end'
 19.         mkmat article_wt perc cum_perc in 1/`rank_end', mat(top_`mesh'_`sa
> mp')
 20.         mat top_`mesh'_`data'_`samp' = top_`mesh'_`samp' \ (.,`total', .)
 21.         qui levelsof `mesh' in 1/3, local(`mesh'_terms_`data')
 22.         qui gen rank = _n
 23.         qui replace rank = 4 if rank > 3
 24.         qui replace `mesh' = "other" if rank == 4
 25.         qui gen inst = "total"
 26.         collapse (sum) article_wt perc cum_perc, by(inst `mesh' rank)
 27.         drop rank
 28.         qui save ../temp/`mesh'_`data'_`samp', replace
 29.     }
 30. end

. 
. program output_tables
  1.     syntax, data(str) samp(str)
  2.     cap mat if_comb = top_country_jrnls_if_wt \ top_msa_c_world_jrnls_if_w
> t
  3.     cap matrix_to_txt, saving("../output/tables/if_comb.txt") matrix(if_co
> mb) title(<tab:if_comb>) format(%20.4f) replace
  4.     cap mat body_comb = top_country_jrnls_body \ top_msa_c_world_jrnls_bod
> y \ top_inst_jrnls_body
  5.     cap matrix_to_txt, saving("../output/tables/body_comb.txt") matrix(bod
> y_comb) title(<tab:body_comb>) format(%20.4f) replace
  6.     cap mat if_comb_cns = top_country_cns_if_wt \ top_msa_c_world_cns_if_w
> t
  7.     cap matrix_to_txt, saving("../output/tables/if_comb_cns.txt") matrix(i
> f_comb_cns) title(<tab:if_comb_cns>) format(%20.4f) replace
  8.     cap mat body_comb_cns = top_country_cns_body \ top_msa_c_world_cns_bod
> y \ top_inst_cns_body
  9.     cap matrix_to_txt, saving("../output/tables/body_comb_cns.txt") matrix
> (body_comb_cns) title(<tab:body_comb_cns>) format(%20.4f) replace
 10.     foreach file in top_country top_msa_c_world top_inst {
 11.         cap qui matrix_to_txt, saving("../output/tables/`file'_`samp'_wt.t
> xt") matrix(`file'_`samp'_wt) ///
>            title(<tab:`file'_`samp'_wt>) format(%20.4f) replace
 12.         cap qui matrix_to_txt, saving("../output/tables/`file'_`samp'.txt"
> ) matrix(`file'_`samp') ///
>            title(<tab:`file'_`samp'>) format(%20.4f) replace
 13.         cap qui matrix_to_txt, saving("../output/tables/`file'_`samp'_if.t
> xt") matrix(`file'_`samp'_if) ///
>            title(<tab:`file'_`samp'_if>) format(%20.4f) replace
 14.         cap qui matrix_to_txt, saving("../output/tables/`file'_`samp'_if_w
> t.txt") matrix(`file'_`samp'_if_wt) ///
>            title(<tab:`file'_`samp'_if_wt>) format(%20.4f) replace
 15.         cap qui matrix_to_txt, saving("../output/tables/`file'_`samp'_pat.
> txt") matrix(`file'_`samp'_pat) ///
>            title(<tab:`file'_`samp'_pat>) format(%20.4f) replace
 16.         cap qui matrix_to_txt, saving("../output/tables/`file'_`samp'_frnt
> .txt") matrix(`file'_`samp'_frnt) ///
>            title(<tab:`file'_`samp'_frnt>) format(%20.4f) replace
 17.         cap qui matrix_to_txt, saving("../output/tables/`file'_`samp'_body
> .txt") matrix(`file'_`samp'_body) ///
>            title(<tab:`file'_`samp'_body>) format(%20.4f) replace
 18.          }
 19.  end

. ** 
. main
OUTPUT START
CNS: impact_cite_affl_wt
(0 real changes made)

     +-------------------------------+
     | country   impact~t       perc |
     |-------------------------------|
 38. |           3.276711   .0272696 |
     +-------------------------------+
(file ../temp/rankings_country_if_wt.dta not found)
file ../temp/rankings_country_if_wt.dta saved

     +---------------------------+
     |        country       perc |
     |---------------------------|
  1. |  United States   53.74723 |
  2. |          China   9.574364 |
  3. | United Kingdom   9.508092 |
  4. |        Germany   7.179984 |
  5. |    Switzerland   2.241437 |
     |---------------------------|
  6. |         France   2.104558 |
  7. |         Canada   1.852044 |
  8. |          Japan   1.675193 |
  9. |         Sweden   1.490087 |
 10. |    Netherlands    1.44676 |
     |---------------------------|
 11. |      Australia   1.444235 |
 12. |         Israel   1.314401 |
 13. |    South Korea   .7080044 |
 14. |        Austria    .661643 |
 15. |          Spain   .5996491 |
     |---------------------------|
 16. |        Belgium   .5816133 |
 17. |   South Africa    .482648 |
 18. |          Italy   .4362539 |
 19. |      Singapore    .393538 |
 20. |        Denmark   .3839229 |
     +---------------------------+
Total articles: 12016
(0 real changes made)
(0 real changes made)

     +--------------------------------+
     | msa_c_~d   impact~t       perc |
     |--------------------------------|
 45. |             45.9031   .3820165 |
     +--------------------------------+
(file ../temp/rankings_msa_c_world_if_wt.dta not found)
file ../temp/rankings_msa_c_world_if_wt.dta saved

     +-------------------------------------------------+
     |                          msa_c_world       perc |
     |-------------------------------------------------|
  1. |          Boston-Cambridge-Newton, US   11.03132 |
  2. |                         Bay Area, US   7.466064 |
  3. |      New York-Newark-Jersey City, US   7.335039 |
  4. |                          Beijing, CN   4.828453 |
  5. |                           London, GB   4.069576 |
     |-------------------------------------------------|
  6. |  Washington-Arlington-Alexandria, US   3.188098 |
  7. |               San Diego-Carlsbad, US   2.932386 |
  8. |                           Berlin, DE   2.513546 |
  9. |                           Munich, DE    2.36359 |
 10. |          Seattle-Tacoma-Bellevue, US   2.314081 |
     |-------------------------------------------------|
 11. |                           Oxford, GB   1.946516 |
 12. |   Los Angeles-Long Beach-Anaheim, US   1.874109 |
 13. |                        Cambridge, GB   1.806659 |
 14. |                            Paris, FR    1.58431 |
 15. |   Philadelphia-Camden-Wilmington, US   1.320005 |
     |-------------------------------------------------|
 16. |           Research Triangle Park, US   1.196459 |
 17. |                New Haven-Milford, US    1.18294 |
 18. | Houston-The Woodlands-Sugar Land, US    1.14573 |
 19. |                        Stockholm, SE    1.03373 |
 20. |                        St. Louis, US   1.017452 |
     +-------------------------------------------------+
Total articles: 12016
(0 real changes made)
(0 real changes made)
(file ../temp/rankings_inst_if_wt.dta not found)
file ../temp/rankings_inst_if_wt.dta saved

     +----------------------------------------------------------------+
     |                                                inst       perc |
     |----------------------------------------------------------------|
  1. |                                  Harvard University   4.289211 |
  2. |                                 Stanford University   3.343019 |
  3. |                         Chinese Academy of Sciences   2.753593 |
  4. |               Massachusetts Institute of Technology   2.190429 |
  5. |             University of California, San Francisco   1.919433 |
     |----------------------------------------------------------------|
  6. |                                University of Oxford   1.795851 |
  7. |                                Mass General Brigham   1.751935 |
  8. |                                  Max Planck Society   1.701386 |
  9. |                       National Institutes of Health   1.691454 |
 10. |                            University of Washington   1.573256 |
     |----------------------------------------------------------------|
 11. |                                 Leibniz Association   1.565188 |
 12. |                                 Columbia University   1.311747 |
 13. |                              Rockefeller University   1.228573 |
 14. |                                     Yale University    1.16892 |
 15. |                           DeepMind (United Kingdom)   1.146986 |
     |----------------------------------------------------------------|
 16. |                          University of Pennsylvania   1.135337 |
 17. |              Memorial Sloan Kettering Cancer Center   1.123735 |
 18. |                  University of California, Berkeley   1.021765 |
 19. |                 University of California, San Diego   1.013633 |
 20. |                       Weizmann Institute of Science    .947648 |
     |----------------------------------------------------------------|
 21. |                  Washington University in St. Louis   .9458155 |
 22. |                                 New York University   .9398283 |
 23. |                  California Institute of Technology   .9140381 |
 24. |                                  Cornell University   .8669236 |
 25. |                             University of Cambridge   .8559662 |
     |----------------------------------------------------------------|
 26. |                        Dana-Farber Cancer Institute   .8380932 |
 27. |         La Jolla Institute For Allergy & Immunology   .7996332 |
 28. |             Icahn School of Medicine at Mount Sinai   .7937473 |
 29. |                           Wellcome Sanger Institute   .7914055 |
 30. |                            Medical Research Council    .766355 |
     |----------------------------------------------------------------|
 31. |                            Johns Hopkins University   .7485932 |
 32. | The University of Texas Southwestern Medical Center   .7344351 |
 33. |                                Princeton University   .7105997 |
 34. |                               Karolinska Institutet   .6318247 |
 35. |    Helmholtz Association of German Research Centres   .6245531 |
     |----------------------------------------------------------------|
 36. |                               University of Chicago    .607386 |
 37. |                                     Duke University   .5985077 |
 38. |                          Scripps Research Institute   .5909997 |
 39. |   The University of Texas MD Anderson Cancer Center   .5884047 |
 40. |                             Imperial College London   .5784256 |
     |----------------------------------------------------------------|
 41. |               University of California, Los Angeles   .5407188 |
 42. |         University of North Carolina at Chapel Hill   .5367089 |
 43. |                          Boston Children's Hospital   .5219193 |
 44. |                         The Francis Crick Institute   .5164906 |
 45. |                              New York Genome Center   .5103804 |
     |----------------------------------------------------------------|
 46. |                                 Tsinghua University   .4836924 |
 47. |               St. Jude Children's Research Hospital   .4832435 |
 48. |                                   Peking University   .4639399 |
 49. |      French National Centre for Scientific Research   .4607461 |
 50. |                    University of Michigan–Ann Arbor   .4498198 |
     +----------------------------------------------------------------+
Total articles: 12016
(0 real changes made)
(0 real changes made)
ALL: impact_cite_affl_wt
(0 real changes made)

     +-------------------------------+
     | country   impact~t       perc |
     |-------------------------------|
 48. |           23.52466   .0166164 |
     +-------------------------------+
file ../temp/rankings_country_if_wt.dta saved

     +---------------------------+
     |        country       perc |
     |---------------------------|
  1. |  United States   51.78651 |
  2. |          China   10.14379 |
  3. | United Kingdom   8.382897 |
  4. |        Germany   6.051418 |
  5. |         Canada   2.246084 |
     |---------------------------|
  6. |          Japan   2.147324 |
  7. |         France   2.044836 |
  8. |    Switzerland   1.970186 |
  9. |      Australia   1.894773 |
 10. |    Netherlands    1.79125 |
     |---------------------------|
 11. |         Sweden   1.268986 |
 12. |         Israel   1.151931 |
 13. |          Spain   .9829965 |
 14. |          Italy    .981216 |
 15. |        Denmark   .8761578 |
     |---------------------------|
 16. |    South Korea   .8400415 |
 17. |        Belgium   .7620048 |
 18. |        Austria   .6033919 |
 19. |      Singapore   .5880554 |
 20. |      Hong Kong   .4902435 |
     +---------------------------+
Total articles: 141575
(0 real changes made)
(0 real changes made)

      +--------------------------------+
      | msa_c_~d   impact~t       perc |
      |--------------------------------|
  50. |            533.5727   .3768834 |
      +--------------------------------+
file ../temp/rankings_msa_c_world_if_wt.dta saved

     +-------------------------------------------------+
     |                          msa_c_world       perc |
     |-------------------------------------------------|
  1. |          Boston-Cambridge-Newton, US   9.936212 |
  2. |                         Bay Area, US   7.838559 |
  3. |      New York-Newark-Jersey City, US   6.875523 |
  4. |                          Beijing, CN   3.943763 |
  5. |                           London, GB   3.451718 |
     |-------------------------------------------------|
  6. |               San Diego-Carlsbad, US   2.286009 |
  7. |  Washington-Arlington-Alexandria, US   2.248492 |
  8. |   Los Angeles-Long Beach-Anaheim, US   1.865075 |
  9. |                           Berlin, DE   1.823236 |
 10. |                        Cambridge, GB   1.729088 |
     |-------------------------------------------------|
 11. |          Seattle-Tacoma-Bellevue, US   1.655581 |
 12. |                           Munich, DE   1.623368 |
 13. | Houston-The Woodlands-Sugar Land, US   1.450128 |
 14. |                            Paris, FR   1.419781 |
 15. |                           Oxford, GB   1.390454 |
     |-------------------------------------------------|
 16. |        Baltimore-Columbia-Towson, US   1.364052 |
 17. |   Philadelphia-Camden-Wilmington, US   1.327415 |
 18. |                New Haven-Milford, US   1.306307 |
 19. |           Research Triangle Park, US   1.203255 |
 20. |                        St. Louis, US   1.138072 |
     +-------------------------------------------------+
Total articles: 141575
(0 real changes made)
(0 real changes made)
file ../temp/rankings_inst_if_wt.dta saved

     +----------------------------------------------------------------+
     |                                                inst       perc |
     |----------------------------------------------------------------|
  1. |                                  Harvard University   3.650596 |
  2. |                                 Stanford University   3.337418 |
  3. |                         Chinese Academy of Sciences   1.976653 |
  4. |             University of California, San Francisco   1.939162 |
  5. |               Massachusetts Institute of Technology   1.924289 |
     |----------------------------------------------------------------|
  6. |                                Mass General Brigham   1.637308 |
  7. |                       National Institutes of Health   1.338675 |
  8. |                                University of Oxford   1.329457 |
  9. |                                     Yale University   1.250089 |
 10. |                            Johns Hopkins University   1.242146 |
     |----------------------------------------------------------------|
 11. |              Memorial Sloan Kettering Cancer Center   1.219771 |
 12. |                                  Max Planck Society   1.198454 |
 13. |                 University of California, San Diego   1.183239 |
 14. |                                 Columbia University   1.169581 |
 15. |                                 New York University   1.085032 |
     |----------------------------------------------------------------|
 16. |                  University of California, Berkeley   1.033513 |
 17. |                          University of Pennsylvania   1.017712 |
 18. |                        Dana-Farber Cancer Institute   .9917283 |
 19. |                            University of Washington   .9675289 |
 20. |                                  Cornell University   .9398183 |
     |----------------------------------------------------------------|
 21. |             Icahn School of Medicine at Mount Sinai   .9378434 |
 22. |                  Washington University in St. Louis   .9163785 |
 23. |                             University of Cambridge   .7947736 |
 24. |    Helmholtz Association of German Research Centres    .792034 |
 25. |   The University of Texas MD Anderson Cancer Center   .7489877 |
     |----------------------------------------------------------------|
 26. |                                 Leibniz Association    .692737 |
 27. |                            Medical Research Council   .6854892 |
 28. |                               Karolinska Institutet   .6743323 |
 29. |                           Wellcome Sanger Institute   .6657345 |
 30. |                       Weizmann Institute of Science   .6602542 |
     |----------------------------------------------------------------|
 31. |                              Rockefeller University   .6482343 |
 32. | The University of Texas Southwestern Medical Center   .6074806 |
 33. |                                   Peking University   .5810136 |
 34. |                                Princeton University   .5773758 |
 35. |                                     Duke University    .577098 |
     |----------------------------------------------------------------|
 36. |               University of California, Los Angeles   .5561543 |
 37. |                  California Institute of Technology   .5555534 |
 38. |         University of North Carolina at Chapel Hill   .5396642 |
 39. |                    University of Michigan–Ann Arbor   .5205523 |
 40. |                             Imperial College London   .5192969 |
     |----------------------------------------------------------------|
 41. |                             University of Hong Kong   .4861943 |
 42. |                           University College London    .486165 |
 43. |                              New York Genome Center   .4594898 |
 44. |                            University of Queensland   .4546462 |
 45. |                               University of Toronto    .448817 |
     |----------------------------------------------------------------|
 46. |                          Boston Children's Hospital   .4486663 |
 47. |                           DeepMind (United Kingdom)   .4375783 |
 48. |      French National Centre for Scientific Research    .421384 |
 49. |                          Baylor College of Medicine   .4113339 |
 50. |            École Polytechnique Fédérale de Lausanne   .3923966 |
     +----------------------------------------------------------------+
Total articles: 141575
(0 real changes made)
(0 real changes made)
CNS: body_adj_wt
(0 real changes made)

     +---------------------------+
     | country   body_a~t   perc |
     |---------------------------|
 43. |                  0      0 |
     +---------------------------+
(file ../temp/rankings_country_body.dta not found)
file ../temp/rankings_country_body.dta saved

     +---------------------------+
     |        country       perc |
     |---------------------------|
  1. |  United States   64.08055 |
  2. |          China    11.7639 |
  3. | United Kingdom   5.647819 |
  4. |        Germany   4.886014 |
  5. |    Switzerland   2.298273 |
     |---------------------------|
  6. |          Japan   1.917235 |
  7. |         Sweden   1.729841 |
  8. |    Netherlands   1.263393 |
  9. |         Canada   1.059334 |
 10. |         France   .9807171 |
     |---------------------------|
 11. |      Australia   .8050974 |
 12. |         Israel   .6442409 |
 13. |      Singapore   .4435327 |
 14. |        Austria   .3496092 |
 15. |          Italy   .2468096 |
     |---------------------------|
 16. |          Spain   .2402884 |
 17. |    South Korea   .1911076 |
 18. |      Hong Kong   .1521615 |
 19. |        Belgium   .1209141 |
 20. |        Denmark   .1136683 |
     +---------------------------+
Total articles: 12016
(0 real changes made)
(0 real changes made)

     +-------------------------------+
     | msa_c_~d   body_a~t      perc |
     |-------------------------------|
 55. |            26.26109   .218551 |
     +-------------------------------+
(file ../temp/rankings_msa_c_world_body.dta not found)
file ../temp/rankings_msa_c_world_body.dta saved

     +-------------------------------------------------+
     |                          msa_c_world       perc |
     |-------------------------------------------------|
  1. |          Boston-Cambridge-Newton, US   21.16884 |
  2. |                         Bay Area, US   10.11639 |
  3. |      New York-Newark-Jersey City, US   9.115199 |
  4. |                          Beijing, CN   4.355714 |
  5. |               San Diego-Carlsbad, US   3.576429 |
     |-------------------------------------------------|
  6. |                           London, GB   2.739813 |
  7. |  Washington-Arlington-Alexandria, US    2.37535 |
  8. |                           Berlin, DE   2.274633 |
  9. |                          Chengdu, CN   2.245016 |
 10. |      Dallas-Fort Worth-Arlington, US   1.819507 |
     |-------------------------------------------------|
 11. |   Los Angeles-Long Beach-Anaheim, US   1.731381 |
 12. |           Research Triangle Park, US   1.352607 |
 13. |          Seattle-Tacoma-Bellevue, US   1.325164 |
 14. |                        Stockholm, SE   1.300075 |
 15. | Houston-The Woodlands-Sugar Land, US   1.284859 |
     |-------------------------------------------------|
 16. |   Philadelphia-Camden-Wilmington, US   1.103896 |
 17. |                        Cambridge, GB   1.037325 |
 18. |                           Munich, DE   1.035242 |
 19. |                New Haven-Milford, US   .9396879 |
 20. |                         Shenzhen, CN   .8622485 |
     +-------------------------------------------------+
Total articles: 12016
(0 real changes made)
(0 real changes made)
(file ../temp/rankings_inst_body.dta not found)
file ../temp/rankings_inst_body.dta saved

     +------------------------------------------------------------------------+
     |                                                        inst       perc |
     |------------------------------------------------------------------------|
  1. |                       Massachusetts Institute of Technology   6.964921 |
  2. |                                          Harvard University   6.882229 |
  3. |                          University of California, Berkeley   3.682942 |
  4. |                                        Mass General Brigham   3.498084 |
  5. |                                         Stanford University    2.95456 |
     |------------------------------------------------------------------------|
  6. |                                 Chinese Academy of Sciences   2.671068 |
  7. |                     University of California, San Francisco   2.368919 |
  8. |                      Memorial Sloan Kettering Cancer Center   2.010434 |
  9. | West China Second University Hospital of Sichuan University   1.930549 |
 10. |                               National Institutes of Health   1.716527 |
     |------------------------------------------------------------------------|
 11. |                                   Regeneron (United States)   1.711817 |
 12. |                                Dana-Farber Cancer Institute    1.53982 |
 13. |         The University of Texas Southwestern Medical Center   1.333134 |
 14. |                          California Institute of Technology   1.304966 |
 15. |                                         Leibniz Association   1.228885 |
     |------------------------------------------------------------------------|
 16. |                                         Columbia University   1.216296 |
 17. |                                      Rockefeller University   1.187584 |
 18. |                                    University of Washington    1.13306 |
 19. |                                  Scripps Research Institute   1.065583 |
 20. |                                       Karolinska Institutet   .9672219 |
     +------------------------------------------------------------------------+
Total articles: 12016
(0 real changes made)
(0 real changes made)
ALL: body_adj_wt
(0 real changes made)

     +---------------------------+
     | country   body_a~t   perc |
     |---------------------------|
 56. |                  0      0 |
     +---------------------------+
file ../temp/rankings_country_body.dta saved

     +---------------------------+
     |        country       perc |
     |---------------------------|
  1. |  United States    59.5914 |
  2. |          China   10.50862 |
  3. | United Kingdom    5.20568 |
  4. |        Germany   4.697792 |
  5. |          Japan   3.572648 |
     |---------------------------|
  6. |    Switzerland   2.085821 |
  7. |         Canada   1.710066 |
  8. |    Netherlands   1.443731 |
  9. |         Sweden   1.434626 |
 10. |    South Korea   1.199798 |
     |---------------------------|
 11. |         France   1.105588 |
 12. |      Australia   1.065027 |
 13. |         Israel   .8454101 |
 14. |          Italy   .6492808 |
 15. |        Denmark   .5436369 |
     |---------------------------|
 16. |      Singapore      .4859 |
 17. |          Spain   .4306982 |
 18. |         Taiwan   .3821703 |
 19. |        Austria   .3647354 |
 20. |   South Africa    .353871 |
     +---------------------------+
Total articles: 141575
(0 real changes made)
(0 real changes made)

      +-------------------------------+
      | msa_c_~d   body_a~t      perc |
      |-------------------------------|
  45. |            527.2876   .372444 |
      +-------------------------------+
file ../temp/rankings_msa_c_world_body.dta saved

     +-------------------------------------------------+
     |                          msa_c_world       perc |
     |-------------------------------------------------|
  1. |          Boston-Cambridge-Newton, US   16.49561 |
  2. |                         Bay Area, US   9.153049 |
  3. |      New York-Newark-Jersey City, US   7.437033 |
  4. |                          Beijing, CN   3.761379 |
  5. |               San Diego-Carlsbad, US   2.698783 |
     |-------------------------------------------------|
  6. |                           London, GB   2.357174 |
  7. |   Los Angeles-Long Beach-Anaheim, US   2.206779 |
  8. |  Washington-Arlington-Alexandria, US   2.169581 |
  9. | Houston-The Woodlands-Sugar Land, US   1.707996 |
 10. |                           Berlin, DE   1.641827 |
     |-------------------------------------------------|
 11. |                          Chengdu, CN   1.486206 |
 12. |   Philadelphia-Camden-Wilmington, US   1.476273 |
 13. |          Seattle-Tacoma-Bellevue, US   1.444973 |
 14. |           Research Triangle Park, US    1.16586 |
 15. |        Baltimore-Columbia-Towson, US   1.152098 |
     |-------------------------------------------------|
 16. |      Dallas-Fort Worth-Arlington, US   1.118263 |
 17. |                        Stockholm, SE   .9805951 |
 18. |                        Cambridge, GB   .9213061 |
 19. |                          Toronto, CA   .8598961 |
 20. |         Chicago-Naperville-Elgin, US   .8356321 |
     +-------------------------------------------------+
Total articles: 141575
(0 real changes made)
(0 real changes made)
file ../temp/rankings_inst_body.dta saved

     +------------------------------------------------------------------------+
     |                                                        inst       perc |
     |------------------------------------------------------------------------|
  1. |                                          Harvard University   5.163412 |
  2. |                       Massachusetts Institute of Technology   4.978095 |
  3. |                                         Stanford University   3.012559 |
  4. |                          University of California, Berkeley   2.824863 |
  5. |                                        Mass General Brigham   2.674726 |
     |------------------------------------------------------------------------|
  6. |                                 Chinese Academy of Sciences   2.171961 |
  7. |                     University of California, San Francisco   1.977125 |
  8. |                      Memorial Sloan Kettering Cancer Center   1.656933 |
  9. |                               National Institutes of Health   1.543167 |
 10. |                                Dana-Farber Cancer Institute   1.473479 |
     |------------------------------------------------------------------------|
 11. |                          California Institute of Technology   1.443318 |
 12. | West China Second University Hospital of Sichuan University   1.243981 |
 13. |                                    University of Washington   1.136629 |
 14. |                                         Columbia University   1.060785 |
 15. |                                   Regeneron (United States)   .9778013 |
     |------------------------------------------------------------------------|
 16. |                                  University of Pennsylvania   .9338779 |
 17. |                                    Johns Hopkins University   .8422543 |
 18. |         The University of Texas Southwestern Medical Center    .812196 |
 19. |                                             Yale University   .8116786 |
 20. |                                       Karolinska Institutet    .790467 |
     +------------------------------------------------------------------------+
Total articles: 141575
(0 real changes made)
(0 real changes made)
N = 1,120,348; 324,957 unbalanced groups of sizes 1 to 18

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
num_gen_mesh |  1,120,348    4.316869    1.764038          1         18

     +-----------------------------------------------------------+
     |                 gen_mesh   articl~t       perc   cum_perc |
     |-----------------------------------------------------------|
  1. |                Receptors   4335.183   1.334079   1.334079 |
  2. |                      DNA   2893.005   .8902733   2.224352 |
  3. |                      RNA   2797.986   .8610327   3.085385 |
  4. |                  Neurons   2280.934   .7019186   3.787303 |
  5. |                    Brain   2173.548   .6688725   4.456176 |
     |-----------------------------------------------------------|
  6. |                Neoplasms   1888.862   .5812652   5.037441 |
  7. |                 Proteins    1866.58   .5744083    5.61185 |
  8. |    Transcription Factors   1749.244      .5383   6.150149 |
  9. |     DNA-Binding Proteins   1412.177   .4345735   6.584723 |
 10. |         Breast Neoplasms   1408.975    .433588   7.018311 |
     |-----------------------------------------------------------|
 11. |       Bacterial Proteins   1376.878   .4237107   7.442022 |
 12. |           HIV Infections   1361.522   .4189854   7.861007 |
 13. |                Carcinoma   1320.636   .4064034    8.26741 |
 14. |         Escherichia coli   1313.117   .4040895     8.6715 |
 15. | Saccharomyces cerevisiae   1304.971   .4015825   9.073083 |
     |-----------------------------------------------------------|
 16. |        Membrane Proteins   1282.378     .39463   9.467712 |
 17. |                MicroRNAs   1230.796   .3787565   9.846469 |
 18. |            T-Lymphocytes   1214.863   .3738535   10.22032 |
 19. |                    Liver   1084.779   .3338223   10.55414 |
 20. |        Diabetes Mellitus   1014.214   .3121072   10.86625 |
     +-----------------------------------------------------------+

. 
end of do-file

--------------------------------------------------------------------------------
Makelog ended: 2024-01-04 23:40:56
Working directory: /export/home/dor/cxu/innovation_projs/analysis/science_geo/cns_descriptives/code
--------------------------------------------------------------------------------
